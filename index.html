
<!DOCTYPE html>
<html lang="en" data-theme="dark" data-car-mode="false">
<head>
	<meta charset="utf-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1" />
	<meta http-equiv="X-UA-Compatible" content="IE=edge" />
	<meta http-equiv="Content-Language" content="en" />
	<meta name="robots" content="index, follow" />
	<meta name="referrer" content="no-referrer-when-downgrade" />

	<title>Amped AI — 100% AI-Generated Radio</title>
	<meta name="description" content="Amped AI is a fully AI-generated radio station. Music, hosts, and shows — all powered by artificial intelligence." />
	<meta name="keywords" content="AI radio, AI music, artificial intelligence, Amped AI, online radio, 24/7 AI stream" />
	<meta name="author" content="Amped AI / TGNZ Networks" />
	
	<!-- Performance: resolve DNS + warm TLS to AzuraCast host -->
	<link rel="dns-prefetch" href="https://amped-ai1.azuracast.tgnz.net">
	<link rel="preconnect" href="https://amped-ai1.azuracast.tgnz.net" crossorigin>
	
	<!-- Canonical -->
	<link rel="canonical" href="https://amped-ai.tgnz.net/" />

	<!-- Open Graph -->
	<meta property="og:type" content="website" />
	<meta property="og:url" content="https://amped-ai.tgnz.net/" />
	<meta property="og:site_name" content="Amped AI" />
	<meta property="og:title" content="Amped AI — 100% AI-Generated Radio" />
	<meta property="og:description" content="Listen to the world’s first fully AI-generated radio station. Music, voices, and shows created by AI — live 24/7." />
	<meta property="og:image" content="https://amped-ai.tgnz.net/GroupPhoto.jpg" />
	<meta property="og:locale" content="en_NZ">
	<meta property="og:image:alt" content="Amped AI on-air hosts">

	<!-- Twitter Card -->
	<meta name="twitter:card" content="summary_large_image" />
	<meta name="twitter:url" content="https://amped-ai.tgnz.net/" />
	<meta name="twitter:title" content="Amped AI — 100% AI-Generated Radio" />
	<meta name="twitter:description" content="Streaming 24/7: fully AI-generated music, hosts, and shows." />
	<meta name="twitter:image" content="https://amped-ai.tgnz.net/GroupPhoto.jpg" />

	<!-- Theme color for mobile browsers -->
	<meta name="theme-color" content="#ff4db8" />
	<meta name="color-scheme" content="dark light">

        <style>
          :root {
                --brand-h: 330;
                --brand-s: 100%;
                --brand-l: 60%;
                --brand: hsl(var(--brand-h) var(--brand-s) var(--brand-l));
                --brand-700: hsl(var(--brand-h) var(--brand-s) 45%);
                --brand-300: hsl(var(--brand-h) 95% 72%);
                --bg: #0a0b0f;
                --surface: #101218;
                --surface-2: #141823;
                --text: #f5f7fb;
                --muted: #97a1b3;
                --border: #283042;
                --shadow: 0 10px 30px rgba(0, 0, 0, .35);
                --r-lg: 16px;
                --r-md: 12px;
                --r-sm: 10px;
                --max: 1100px;
                --promo-texture: none;
                --layer-card-bg: linear-gradient(145deg,
                      color-mix(in oklab, var(--surface-2) 92%, transparent),
                      color-mix(in oklab, var(--surface) 88%, transparent)
                );
                --layer-card-overlay: radial-gradient(120% 120% at 22% 12%, hsl(var(--brand-h) 92% 58% / .45), transparent 65%);
                --layer-border: color-mix(in oklab, var(--border) 70%, transparent);
                --layer-glass: color-mix(in oklab, var(--surface) 82%, transparent);
                --layer-hover-bg: color-mix(in oklab, var(--surface-2) 88%, transparent);
                --layer-chip-bg: color-mix(in oklab, var(--surface) 75%, transparent);
          }

          @keyframes heroFadeUp {
                from {
                  opacity: 0;
                  transform: translateY(20px);
                }

                to {
                  opacity: 1;
                  transform: translateY(0);
                }
          }

          @keyframes spin {
                from { transform: rotate(0deg); }
                to   { transform: rotate(360deg); }
          }

          [data-theme="light"] {
                --bg: #fbf7fb;
                --surface: #fff;
                --surface-2: #f5f0f6;
                --text: #0d1117;
                --muted: #505b6d;
                --border: #e2cfe2;
                --shadow: 0 10px 30px rgba(10, 20, 40, .08);
                --layer-card-bg: linear-gradient(145deg,
                      color-mix(in oklab, var(--surface-2) 90%, rgba(255, 255, 255, .6)),
                      color-mix(in oklab, var(--surface) 98%, transparent)
                );
                --layer-card-overlay: radial-gradient(120% 120% at 22% 12%, hsl(var(--brand-h) 95% 72% / .35), transparent 70%);
                --layer-border: color-mix(in oklab, var(--border) 55%, transparent);
                --layer-glass: color-mix(in oklab, var(--surface) 94%, rgba(255, 255, 255, .25));
                --layer-hover-bg: color-mix(in oklab, var(--surface-2) 95%, rgba(255, 255, 255, .3));
                --layer-chip-bg: color-mix(in oklab, var(--surface) 92%, rgba(255, 255, 255, .25));
          }

	  * {
		box-sizing: border-box;
	  }

	  html,
	  body {
		height: 100%;
	  }

          body {
                margin: 0;
                font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial,
                  "Apple Color Emoji", "Segoe UI Emoji";
                color: var(--text);
                background-color: var(--bg);
                background-image:
                  radial-gradient(1200px 600px at 20% -10%, hsl(var(--brand-h) 85% 20% / .45), transparent 60%),
                  radial-gradient(1000px 500px at 100% -20%, hsl(var(--brand-h) 85% 18% / .35), transparent 60%);
                background-repeat: no-repeat;
                line-height: 1.55;
                -webkit-font-smoothing: antialiased;
                -moz-osx-font-smoothing: grayscale;
          }

	  a {
		color: var(--brand-300);
		text-decoration: none;
	  }

	  a:hover {
		text-decoration: underline;
	  }

	  .container {
		width: 100%;
		max-width: var(--max);
		margin-inline: auto;
		padding-inline: 20px;
	  }

	  .btn {
		display: inline-flex;
		align-items: center;
		gap: .6rem;
		border-radius: 999px;
		padding: .7rem 1.05rem;
		font-weight: 600;
		text-decoration: none;
		border: 1px solid transparent;
		transition: transform .08s ease, box-shadow .2s ease, background .2s ease;
	  }

	  .btn:focus {
		outline: 2px solid var(--brand-300);
		outline-offset: 2px;
	  }

          .btn:hover {
                transform: translateY(-1px);
          }

          .btn[aria-busy="true"] {
                cursor: progress;
                opacity: .7;
          }

          .btn[aria-busy="true"] svg {
                animation: spin 1s linear infinite;
          }

	  .btn-primary {
		background: linear-gradient(135deg, var(--brand), var(--brand-700));
		color: #fff;
		box-shadow:
		  0 0 18px hsl(var(--brand-h) 100% 60% / .55),
		  0 12px 24px hsl(var(--brand-h) 90% 50% / .25);
	  }

	  .btn-ghost {
		background: transparent;
		color: var(--text);
		border-color: var(--border);
	  }

	  .btn-ghost:hover {
		background: var(--surface-2);
	  }

	  .chip {
		display: inline-flex;
		align-items: center;
		gap: .45rem;
		padding: .3rem .6rem;
		border: 1px solid var(--border);
		border-radius: 999px;
		color: var(--muted);
		font-size: .81rem;
	  }

	  .neon {
		text-shadow:
		  0 0 10px hsl(var(--brand-h) 100% 60% / .6),
		  0 0 24px hsl(var(--brand-h) 100% 60% / .35);
	  }

	  .header {
		position: sticky;
		top: 0;
		z-index: 20;
		backdrop-filter: saturate(1.2) blur(8px);
		background: color-mix(in oklab, var(--bg) 70%, transparent);
		border-bottom: 1px solid var(--border);
	  }

          .header .row {
                display: flex;
                align-items: center;
                justify-content: space-between;
                padding: .7rem 0;
          }

	  .logo {
		display: inline-flex;
		align-items: center;
		gap: .6rem;
		font-weight: 800;
		letter-spacing: .2px;
	  }

	  .logo-img {
		width: 160px;
		height: auto;
		filter: drop-shadow(0 0 18px hsl(var(--brand-h) 100% 60% / .55));
	  }

	  nav ul {
		list-style: none;
		padding: 0;
		margin: 0;
		display: flex;
		gap: 1rem;
	  }

	  nav a {
		color: var(--muted);
		padding: .55rem .75rem;
		border-radius: 999px;
	  }

	  nav a:hover,
	  nav a[aria-current="page"] {
		background: var(--surface-2);
		color: var(--text);
		text-decoration: none;
	  }

          .header-actions {
                display: flex;
                align-items: center;
                gap: .6rem;
          }

	  .icon-btn {
		display: inline-grid;
		place-items: center;
		width: 38px;
		height: 38px;
		border-radius: 999px;
		border: 1px solid var(--border);
		background: var(--surface-2);
	  }

          .icon-btn svg {
                width: 18px;
                height: 18px;
          }

          .sr-only {
                position: absolute;
                width: 1px;
                height: 1px;
                padding: 0;
                margin: -1px;
                overflow: hidden;
                clip: rect(0, 0, 0, 0);
                white-space: nowrap;
                border: 0;
          }

          .menu-toggle {
                display: none;
          }

          [data-car-mode="true"] #site-nav,
          [data-car-mode="true"] .header-actions {
                display: none;
          }

          [data-car-mode="true"] .header .row {
                justify-content: center;
          }

          [data-car-mode="true"] .logo-img {
                width: 190px;
          }

	  .hero {
		padding: 48px 0 26px;
	  }

          .hero .wrap {
                display: grid;
                grid-template-columns: 1.2fr .8fr;
                gap: 28px;
                align-items: center;
          }

          .hero .eyebrow,
          .hero h1,
          .hero p,
          .hero .cta,
          .promo-card,
          .up-next-card {
                opacity: 0;
                transform: translateY(20px);
                animation: heroFadeUp .8s ease forwards;
          }

          .eyebrow {
                display: inline-flex;
                align-items: center;
                gap: .5rem;
                font-weight: 600;
                color: var(--brand-300);
                letter-spacing: .3px;
          }

          .hero .eyebrow {
                animation-delay: .1s;
          }

          .hero h1 {
                font-size: clamp(2rem, 1.2rem + 3vw, 3.2rem);
                margin: .4rem 0 .75rem;
                line-height: 1.1;
                animation-delay: .2s;
          }

          .hero h1 span {
                color: var(--brand-300);
          }

          .hero p {
                color: var(--muted);
                max-width: 48ch;
                animation-delay: .3s;
          }

          .hero .cta {
                display: flex;
                gap: .6rem;
                margin-top: 1rem;
                flex-wrap: wrap;
                animation-delay: .4s;
          }

          .player-controls {
                display: inline-flex;
                align-items: center;
                gap: .6rem;
                flex-wrap: wrap;
          }

          .player-volume {
                display: flex;
                align-items: center;
                gap: .5rem;
                padding: .5rem .75rem;
                border: 1px solid var(--border);
                border-radius: var(--r-md);
                background: var(--surface-2);
                flex-wrap: wrap;
          }

          .player-volume label {
                font-size: .82rem;
                font-weight: 600;
                color: var(--muted);
          }

          .player-volume-controls {
                display: flex;
                align-items: center;
                gap: .5rem;
                flex: 1;
          }

          .player-volume input[type="range"] {
                flex: 1;
                min-width: 120px;
                accent-color: var(--brand);
                background: transparent;
          }

          .player-volume input[type="range"][disabled] {
                opacity: .6;
                cursor: not-allowed;
          }

          .player-volume .icon-btn {
                width: 36px;
                height: 36px;
          }

          .promo-card .player-volume {
                margin-top: 1.2rem;
                width: 100%;
          }

          [data-car-mode="true"] .hero .wrap {
                grid-template-columns: 1fr;
          }

          [data-car-mode="true"] .player-controls {
                flex-direction: column;
                align-items: stretch;
                gap: 1rem;
                max-width: 360px;
          }

          [data-car-mode="true"] .player-controls .btn {
                font-size: 1.15rem;
                padding: 1rem 1.35rem;
                justify-content: center;
                width: 100%;
          }

          [data-car-mode="true"] .player-controls .btn svg {
                width: 26px;
                height: 26px;
          }

          #carModeToggle svg {
                width: 20px;
                height: 20px;
          }

          [data-car-mode="true"] #carModeToggle {
                font-size: 1.15rem;
          }

          [data-car-mode="true"] #carModeToggle svg {
                width: 28px;
                height: 28px;
          }

          [data-car-mode="true"] .player-volume {
                flex-direction: column;
                align-items: stretch;
                gap: 0.9rem;
                font-size: 1.05rem;
                padding: 1.1rem 1.35rem;
          }

          [data-car-mode="true"] .player-volume label {
                font-size: 1rem;
          }

          [data-car-mode="true"] .player-volume-controls {
                flex-direction: column;
                align-items: center;
                gap: 0.9rem;
          }

          [data-car-mode="true"] .player-volume input[type="range"] {
                width: 100%;
                flex: 1;
                min-width: 0;
          }

          [data-car-mode="true"] .player-volume .icon-btn {
                width: 52px;
                height: 52px;
          }

          [data-car-mode="true"] .promo-card h3#trackTitle {
                font-size: clamp(1.6rem, 1.3rem + 1vw, 2.2rem);
          }

          [data-car-mode="true"] #trackMeta {
                font-size: 1.1rem;
          }

          [data-car-mode="true"] .progress {
                height: 12px;
          }

          [data-car-mode="true"] #upNextCard {
                display: none;
          }

          .promo-card {
                position: relative;
                overflow: hidden;
                background-image:
                  var(--promo-texture),
                  linear-gradient(180deg, color-mix(in oklab, var(--surface) 85%, transparent), var(--surface));
                background-repeat: no-repeat;
                background-size: cover, auto;
                border: 1px solid var(--border);
                border-radius: var(--r-lg);
                padding: 18px;
                box-shadow: var(--shadow);
                animation-delay: .25s;
          }

          .promo-card .promo-accent {
                position: absolute;
                top: -30px;
                right: -20px;
                width: clamp(160px, 22vw, 220px);
                opacity: .55;
                pointer-events: none;
                filter: drop-shadow(0 18px 28px rgba(0, 0, 0, .35));
                transition: opacity .3s ease;
                z-index: 0;
          }

          .promo-card .promo-accent[hidden] {
                opacity: 0;
          }

          .promo-card .now {
                position: relative;
                z-index: 1;
          }

          .promo-card h3 {
                margin: .4rem 0;
          }

          .up-next-card {
                --card-bg: var(--layer-card-bg);
                --card-border: var(--layer-border);
                --card-shadow: 0 26px 60px color-mix(in srgb, #000 40%, transparent);
                --card-body-bg: transparent;
                --card-body-padding: clamp(24px, 5vw, 32px);
                --card-body-gap: clamp(22px, 4vw, 28px);
                margin-top: 18px;
                grid-column: 1 / -1;
                position: relative;
                isolation: isolate;
                animation-delay: .35s;
          }

          .up-next-card::before {
                content: "";
                position: absolute;
                inset: -40% -30% 40% -30%;
                background: var(--layer-card-overlay);
                filter: blur(28px);
                opacity: .85;
                z-index: 0;
                pointer-events: none;
          }

          .up-next-card .body {
                position: relative;
                z-index: 1;
                display: grid;
          }

          .current-show {
                position: relative;
                display: grid;
                grid-template-columns: minmax(0, 1fr);
                grid-template-rows: auto auto;
                gap: clamp(18px, 4vw, 24px);
                padding: clamp(22px, 5vw, 30px);
                border-radius: calc(var(--r-lg) - 2px);
                background: var(--layer-glass);
                border: 1px solid color-mix(in oklab, var(--layer-border) 85%, transparent);
                box-shadow: 0 20px 48px color-mix(in srgb, #000 35%, transparent);
                backdrop-filter: blur(18px) saturate(1.3);
                overflow: hidden;
                isolation: isolate;
          }

          .current-show::before {
                content: "";
                position: absolute;
                inset: -55% -35% 15% -35%;
                background: radial-gradient(120% 120% at 20% 18%, hsl(var(--brand-h) 96% 66% / .55), transparent 65%);
                filter: blur(32px);
                opacity: .9;
                z-index: 0;
          }

          .current-show > * {
                position: relative;
                z-index: 1;
          }

          .current-show-badge {
                justify-self: start;
                padding: .45rem 1.05rem;
                border-radius: 999px;
                font-size: .8rem;
                letter-spacing: .14em;
                text-transform: uppercase;
                font-weight: 700;
                background: linear-gradient(135deg, var(--brand-300), var(--brand));
                color: #0a030f;
                box-shadow:
                  0 0 0 1px color-mix(in oklab, #fff 65%, transparent),
                  0 0 22px hsl(var(--brand-h) 95% 65% / .45);
          }

          .current-show-text {
                display: grid;
                gap: clamp(8px, 2vw, 12px);
                max-width: 48ch;
          }

          .current-show-title {
                margin: 0;
                font-size: clamp(1.55rem, 1.5vw + 1.1rem, 2.2rem);
                font-weight: 700;
                letter-spacing: -.01em;
                line-height: 1.2;
                text-wrap: balance;
          }

          .current-show-time {
                color: color-mix(in oklab, var(--text) 70%, var(--muted) 30%);
                font-size: clamp(1.05rem, 1vw + .9rem, 1.25rem);
                font-weight: 600;
                line-height: 1.35;
                text-wrap: balance;
          }

          .up-next-head {
                display: flex;
                flex-wrap: wrap;
                align-items: center;
                justify-content: space-between;
                gap: 1rem;
                padding-bottom: 12px;
                border-bottom: 1px solid color-mix(in oklab, var(--layer-border) 55%, transparent);
          }

          .up-next-list {
                list-style: none;
                padding: 0;
                margin: 0;
                display: grid;
                gap: 16px;
                counter-reset: upnext;
          }

          .up-next-item {
                counter-increment: upnext;
                position: relative;
                display: flex;
                align-items: center;
                gap: 16px;
                padding: 16px 18px;
                border-radius: var(--r-md);
                background: color-mix(in oklab, var(--layer-glass) 90%, transparent);
                border: 1px solid color-mix(in oklab, var(--layer-border) 60%, transparent);
                box-shadow: 0 10px 28px color-mix(in srgb, #000 22%, transparent);
                backdrop-filter: blur(12px) saturate(1.15);
                transition: transform .2s ease, box-shadow .25s ease, border-color .2s ease, background .2s ease;
                flex-wrap: wrap;
          }

          .up-next-item:hover,
          .up-next-item:focus-within {
                transform: translateY(-2px);
                border-color: color-mix(in oklab, var(--layer-border) 40%, var(--brand) 20%);
                background: color-mix(in oklab, var(--layer-hover-bg) 85%, transparent);
                box-shadow:
                  0 16px 34px color-mix(in srgb, #000 28%, transparent),
                  0 0 18px hsl(var(--brand-h) 92% 60% / .2);
          }

          .up-next-item:focus-within {
                outline: 2px solid color-mix(in oklab, var(--brand) 55%, transparent);
                outline-offset: 4px;
          }

          .recent-item {
                display: flex;
                justify-content: space-between;
                align-items: center;
                gap: .75rem;
                padding: .65rem .9rem;
                border: 1px solid color-mix(in oklab, var(--border) 80%, transparent);
                border-radius: var(--r-sm);
                background: var(--surface-2);
          }

          .recent-item .meta {
                margin-left: auto;
                color: var(--muted);
                text-align: right;
                white-space: nowrap;
          }

          .up-next-item::before {
                content: counter(upnext);
                display: inline-flex;
                align-items: center;
                justify-content: center;
                width: 34px;
                height: 34px;
                border-radius: 999px;
                background: linear-gradient(140deg, var(--brand-300), var(--brand));
                color: #0b040f;
                font-weight: 700;
                font-variant-numeric: tabular-nums;
                box-shadow: 0 0 0 1px color-mix(in oklab, #fff 60%, transparent);
                flex-shrink: 0;
          }

          .up-next-text {
                display: grid;
                gap: 6px;
                flex: 1 1 220px;
                min-width: 0;
          }

          .up-next-title {
                margin: 0;
                font-size: 1.02rem;
                font-weight: 600;
          }

          .up-next-meta {
                color: color-mix(in oklab, var(--muted) 70%, var(--text) 30%);
                font-size: .88rem;
          }

          .up-next-chip {
                background: var(--layer-chip-bg);
                border-color: color-mix(in oklab, var(--layer-border) 55%, transparent);
                color: var(--text);
                font-weight: 600;
                backdrop-filter: blur(10px) saturate(1.1);
                flex-shrink: 0;
          }

	  .now {
		display: grid;
		grid-template-columns: auto 1fr auto;
		gap: 14px;
		align-items: center;
	  }

	  .art {
		width: 68px;
		height: 68px;
		border-radius: 10px;
		overflow: hidden;
		background: linear-gradient(135deg, var(--brand-300), var(--brand));
		display: grid;
		place-items: center;
	  }

	  .art img {
		width: 100%;
		height: 100%;
		object-fit: cover;
		display: none;
	  }

	  .art span {
		font-weight: 800;
		letter-spacing: .5px;
		color: #000;
	  }

	  .track h3 {
		margin: 0;
		font-size: 1.05rem;
	  }

	  .track p {
		margin: .2rem 0 0;
		color: var(--muted);
		font-size: .9rem;
	  }

          @keyframes livePulse {
                0% {
                      transform: scale(1);
                      opacity: 1;
                      box-shadow: 0 0 0 0 rgba(255, 77, 154, .28), 0 0 12px rgba(255, 77, 154, .5);
                }

                55% {
                      transform: scale(1.45);
                      opacity: .35;
                      box-shadow: 0 0 0 8px rgba(255, 77, 154, 0), 0 0 18px rgba(255, 77, 154, .28);
                }

                100% {
                      transform: scale(1);
                      opacity: 1;
                      box-shadow: 0 0 0 0 rgba(255, 77, 154, 0), 0 0 12px rgba(255, 77, 154, .4);
                }
          }

          .live-dot {
                width: 10px;
                height: 10px;
                border-radius: 50%;
                background: #ff4d9a;
                box-shadow: 0 0 0 0 rgba(255, 77, 154, .28), 0 0 10px rgba(255, 77, 154, .32);
                display: inline-block;
                animation: livePulse 1.8s ease-in-out infinite;
                will-change: transform, opacity;
          }

          @media (prefers-reduced-motion: reduce) {
                .live-dot {
                      animation: none;
                      transform: none;
                      opacity: 1;
                      box-shadow: 0 0 0 6px rgba(255, 77, 154, .12);
                }
          }

	  .progress {
		height: 6px;
		background: var(--surface-2);
		border-radius: 999px;
		overflow: hidden;
		margin-top: .6rem;
	  }

	  .bar {
		height: 100%;
		width: 0%;
		background: linear-gradient(90deg, var(--brand-300), var(--brand));
		box-shadow: 0 0 12px hsl(var(--brand-h) 100% 60% / .5) inset;
	  }

	  section {
		padding: 34px 0;
	  }

	  section h2 {
		font-size: clamp(1.4rem, 1.1rem + 1.5vw, 2rem);
		margin: 0 0 .6rem;
	  }

	  .sub {
		color: var(--muted);
		margin: 0 0 1rem;
	  }

	  .grid {
		display: grid;
		grid-template-columns: repeat(12, 1fr);
		gap: 16px;
	  }

	  .col-4 {
		grid-column: span 4;
	  }

	  .col-6 {
		grid-column: span 6;
	  }

	  .col-8 {
		grid-column: span 8;
	  }

	  .tabs {
		display: flex;
		gap: 8px;
		border-bottom: 1px solid var(--border);
		margin-bottom: 12px;
	  }

	  .tab {
		padding: .5rem .8rem;
		border: 1px solid var(--border);
		border-bottom: none;
		background: var(--surface);
		border-radius: var(--r-sm) var(--r-sm) 0 0;
		color: var(--muted);
		cursor: pointer;
	  }

	  .tab[aria-selected="true"] {
		color: var(--text);
		background: var(--surface-2);
	  }

	  table {
		width: 100%;
		border-collapse: collapse;
		border: 1px solid var(--border);
		border-radius: var(--r-md);
		overflow: hidden;
		background: var(--surface);
	  }

	  th,
	  td {
		text-align: left;
		padding: 12px 14px;
		border-bottom: 1px solid var(--border);
	  }

	  tr:hover td {
		background: var(--surface-2);
	  }

	  th {
		color: var(--muted);
		font-weight: 600;
	  }

          footer {
                border-top: 1px solid var(--border);
                padding: 28px 0 40px;
                color: var(--muted);
          }

          .footer-grid {
                display: grid;
                grid-template-columns: 1fr auto;
                gap: 16px;
                align-items: center;
          }

          .footer-brand {
                display: flex;
                align-items: center;
                gap: 12px;
                flex-wrap: wrap;
          }

          .footer-logo {
                height: 42px;
                width: auto;
                display: block;
                filter: drop-shadow(0 0 12px hsl(var(--brand-h) 90% 60% / .45));
          }

          .socials {
                display: flex;
                gap: 10px;
          }

          @media (max-width: 900px) {
                .hero .wrap {
                  grid-template-columns: 1fr;
                }

                .up-next-card {
                  grid-column: auto;
                  --card-body-gap: clamp(20px, 6vw, 28px);
                  --card-body-padding: clamp(22px, 7vw, 30px);
                }

                .current-show {
                  padding: clamp(20px, 7vw, 30px);
                }

                .current-show-title {
                  font-size: clamp(1.45rem, 4vw + 1rem, 2.05rem);
                }

                .grid {
                  grid-template-columns: repeat(6, 1fr);
                }

                .col-4,
                .col-6,
                .col-8 {
                  grid-column: span 6;
                }

                .up-next-head {
                  align-items: flex-start;
                  gap: .75rem;
                }

                .up-next-item {
                  align-items: flex-start;
                }

                .logo-img {
                  width: 130px;
                }

                .footer-grid {
                  grid-template-columns: 1fr;
                  justify-items: center;
                  text-align: center;
                }

                .footer-brand {
                  justify-content: center;
                }

                .socials {
                  justify-content: center;
                }
          }

          @media (max-width: 760px) {
                nav {
                  display: none;
                  position: absolute;
                  top: 64px;
                  left: 0;
                  right: 0;
                  background: var(--surface);
                  border-bottom: 1px solid var(--border);
                  padding: 10px 0;
                }

                nav.open {
                  display: block;
                }

                nav ul {
                  flex-direction: column;
                }

                .menu-toggle {
                  display: inline-grid;
                }
          }

          @media (max-width: 600px) {
                .player-controls {
                  width: 100%;
                }

                .player-volume {
                  flex: 1 1 100%;
                  flex-wrap: wrap;
                }

                .player-volume label {
                  width: 100%;
                }

                .player-volume-controls {
                  width: 100%;
                }

                .player-volume input[type="range"] {
                  width: 100%;
                }

                .up-next-item {
                  flex-direction: column;
                  align-items: flex-start;
                  gap: 12px;
                }

                .up-next-item::before {
                  margin-bottom: 4px;
                }

                .up-next-chip {
                  font-size: .78rem;
                }

                .up-next-text {
                  width: 100%;
                }

                .current-show {
                  padding: clamp(18px, 8vw, 28px);
                }
          }

	  .skip {
		position: absolute;
		left: -9999px;
		top: auto;
		width: 1px;
		height: 1px;
		overflow: hidden;
	  }

	  .skip:focus {
		left: 10px;
		top: 10px;
		width: auto;
		height: auto;
		padding: .6rem .8rem;
		background: var(--surface);
		border: 1px solid var(--border);
		border-radius: var(--r-sm);
		z-index: 50;
	  }

          /* Card stays solid on all themes */
          .card {
                background: var(--card-bg, var(--surface));
                border: 1px solid var(--card-border, var(--border));
                border-radius: var(--card-radius, var(--r-lg));
                box-shadow: var(--card-shadow, var(--shadow));
                overflow: clip;
                display: flex;
                flex-direction: column;
                transition: transform .25s ease, box-shadow .3s ease;
          }

          .card:hover,
          .card:focus-within {
                transform: translateY(-6px);
                box-shadow:
                  var(--card-shadow, var(--shadow)),
                  0 20px 40px hsl(var(--brand-h) 95% 55% / .25);
          }

	  /* Square thumbnail area */
	  .card .media {
		aspect-ratio: 1 / 1;
		background: var(--surface-2);
		display: grid;
		place-items: center;
		overflow: hidden;
	  }

	  /* Text area */
          .card .body {
                background: var(--card-body-bg, var(--surface));
                padding: var(--card-body-padding, 14px);
                display: grid;
                gap: var(--card-body-gap, 8px);
          }

	  /* Image + placeholder */
	  .card .media img {
		width: 100%;
		height: 100%;
		display: block;
		object-fit: cover;
		transition: transform .25s ease;
	  }

	  .card .media .placeholder {
		width: 100%;
		height: 100%;
		display: grid;
		place-items: center;
		font-weight: 800;
		font-size: 1.2rem;
		letter-spacing: .3px;
		color: #000;
		background: linear-gradient(135deg, var(--brand-300), var(--brand));
	  }

          /* Hover polish */
          .card:hover .media img {
                transform: scale(1.03);
          }

          @media (prefers-reduced-motion: reduce) {
                .card {
                      transition: none;
                }

                .card:hover,
                .card:focus-within {
                      transform: none;
                      box-shadow: var(--shadow);
                }

                .card .media img { transition: none; }

                .card:hover .media img {
                      transform: none;
                }
          }
	</style>
</head>
<body>
  <a class="skip" href="#main">Skip to content</a>
  <header class="header" role="banner">
    <div class="container row">
      <div class="row" style="gap:12px; align-items:center;">
        <button class="icon-btn menu-toggle" aria-label="Toggle menu" aria-expanded="false">
          <svg viewBox="0 0 24 24" fill="currentColor" aria-hidden="true"><path d="M3 6h18v2H3V6Zm0 5h18v2H3v-2Zm0 5h18v2H3v-2Z"/></svg>
        </button>
        <a class="logo" href="#" aria-label="Amped AI home">
          <img class="logo-img" src="logo.png" alt="Amped AI" />
        </a>
      </div>
      <nav id="site-nav" aria-label="Primary">
        <ul>
          <li><a href="#shows">Shows</a></li>
          <li><a href="#schedule">Schedule</a></li>
          <li><a href="#listen">Listen</a></li>
          <li><a href="#about">About</a></li>
        </ul>
      </nav>
      <div class="header-actions">
        <button id="themeBtn" class="icon-btn" aria-label="Toggle theme" title="Toggle light/dark">
          <svg id="themeIcon" viewBox="0 0 24 24" fill="currentColor" aria-hidden><path fill-rule="evenodd" clip-rule="evenodd" d="M12 3a1 1 0 0 1 1 1v2a1 1 0 1 1-2 0V4a1 1 0 0 1 1-1Zm7 9a7 7 0 1 1-7-7 5 5 0 0 0 0 10 7 7 0 0 1 7-3Z"/></svg>
        </button>
        <a class="btn btn-primary neon" href="#listen">Listen Live</a>
      </div>
    </div>
  </header>

  <main id="main">
    <section class="hero" id="listen">
      <div class="container">
        <div class="wrap">
          <div>
            <div class="eyebrow">
              <span class="chip"><span class="live-dot" aria-hidden></span> Live 24/7</span>
              <span class="neon">100% AI Radio</span>
            </div>

            <h1><span>Amped AI</span> — Always on. Always different.</h1>

            <p>
              A new kind of station: AI-generated music, shows, and voices.
              Streaming non-stop with real programming, real hosts, and zero humans behind the mic.
            </p>

            <div class="cta">
              <div class="player-controls" role="group" aria-label="Player controls">
                <button id="playBtn" class="btn btn-primary" aria-pressed="false">
                  <svg id="playIcon" viewBox="0 0 24 24" fill="currentColor" width="18" height="18" aria-hidden>
                    <path d="m8 5 12 7-12 7V5Z"/>
                  </svg>
                  <span>Play Stream</span>
                </button>
                <button id="carModeToggle" class="btn btn-ghost" type="button" aria-pressed="false" aria-label="Enable car mode" title="Enable car mode">
                  <svg viewBox="0 0 24 24" fill="currentColor" aria-hidden>
                    <path d="M5.2 11.3 6.4 7.8A2 2 0 0 1 8.3 6.5h7.4a2 2 0 0 1 1.9 1.3l1.3 3.5A3 3 0 0 1 22 14v3a1 1 0 0 1-1 1h-1.1a2 2 0 0 1-3.8 0H7.9a2 2 0 0 1-3.8 0H3a1 1 0 0 1-1-1v-3a3 3 0 0 1 3.2-2.7ZM6.6 11h10.8l-.9-2.7a1 1 0 0 0-1-.7H8.5a1 1 0 0 0-1 .7L6.6 11ZM6.5 17a1 1 0 1 0 0-.01V17Zm11 0a1 1 0 1 0 0-.01V17Z"/>
                  </svg>
                  <span>Car Mode</span>
                </button>
                <span id="carModeHint" class="sr-only">Car mode enlarges the player controls, hides secondary content for easier in-car use, and may immediately resume playback when enabled.</span>
              </div>
              <a class="btn btn-ghost" href="#schedule">View Schedule</a>
              <a class="btn btn-ghost" href="#recent">Recently Played</a>
            </div>
          </div>

          <aside class="promo-card" aria-label="Now playing">
            <img id="hostAccent" class="promo-accent" alt="" aria-hidden="true" hidden>
            <div class="now">
              <div class="art">
                <img id="artImg" alt="Album art" src="">
                <span id="artFallback">AMP</span>
              </div>
              <div class="track" aria-live="polite" aria-atomic="true">
                <h3 id="trackTitle">Track Title</h3>
                <p id="trackMeta">Artist • with <strong id="trackHost">Host</strong></p>
                <div class="progress" aria-label="Progress">
                  <div class="bar" id="progressBar" style="width:0%"></div>
                </div>
              </div>
              <div>
                <span class="chip" title="Live">
                  <span class="live-dot" aria-hidden></span>
                  <span id="liveLabel">Live</span>
                </span>
              </div>
            </div>
            <div class="player-volume" role="group" aria-label="Volume controls">
              <label for="volumeControl">Volume</label>
              <div class="player-volume-controls">
                <input id="volumeControl" name="volume" type="range" min="0" max="100" step="1" value="100" aria-valuemin="0" aria-valuemax="100" />
                <button type="button" id="muteBtn" class="icon-btn" aria-pressed="false" aria-label="Mute audio" title="Mute audio">
                  <svg id="muteIcon" viewBox="0 0 24 24" fill="currentColor" aria-hidden>
                    <path d="M4 9v6h4l5 5V4L8 9H4Z"/>
                    <path d="M16 12a4 4 0 0 0-2.3-3.6l.8-1.8A6 6 0 0 1 18 12a6 6 0 0 1-3.5 5.4l-.8-1.8A4 4 0 0 0 16 12Z"/>
                  </svg>
                  <span id="muteText" class="sr-only">Mute audio</span>
                </button>
              </div>
            </div>
            <audio id="player" preload="none" crossorigin="anonymous"></audio>
          </aside>
          <div class="card up-next-card" id="upNextCard" aria-live="polite">
            <div class="body">
              <div class="current-show" id="currentShow" aria-live="polite">
                <span class="chip up-next-chip current-show-badge">On Air</span>
                <div class="current-show-text">
                  <h3 class="current-show-title" id="currentShowTitle">Loading current show…</h3>
                  <span class="current-show-time" id="currentShowTime">—</span>
                </div>
              </div>
              <div class="up-next-head">
                <span class="chip">Up Next</span>
                <span class="meta" id="upNextTzLabel"></span>
              </div>
              <ol id="upNextList" class="up-next-list">
                <li class="meta">Loading schedule…</li>
              </ol>
            </div>
          </div>
        </div>
      </div>
    </section>

    <section id="shows">
      <div class="container">
        <h2 class="neon">Featured Shows</h2>
        <div class="grid" id="showsGrid" aria-live="polite"></div>
      </div>
    </section>

    <section id="schedule">
      <div class="container">
        <h2 class="neon">Schedule</h2>
        <div class="tabs" role="tablist">
          <button class="tab" role="tab" aria-controls="weekdayPanel" aria-selected="true" id="weekdayTab">Weekdays</button>
          <button class="tab" role="tab" aria-controls="weekendPanel" aria-selected="false" id="weekendTab">Weekend</button>
        </div>
        <div id="weekdayPanel" role="tabpanel" aria-labelledby="weekdayTab"></div>
        <div id="weekendPanel" role="tabpanel" aria-labelledby="weekendTab" hidden></div>
      </div>
    </section>

    <section id="recent">
      <div class="container">
        <h2 class="neon">Recently Played</h2>
        <div class="card"><div class="body">
          <ul id="recentList" style="list-style:none;padding:0;margin:0;display:grid;gap:10px"></ul>
        </div></div>
      </div>
    </section>

    <section id="about">
      <div class="container">
        <h2 class="neon">About Amped AI</h2>
        <div class="grid" style="align-items:center">

          <!-- Group photo -->
          <div class="col-6">
            <div class="card">
              <div class="media" style="aspect-ratio:3/2; overflow:hidden; background:var(--surface-2);">
                <img src="GroupPhoto.jpg" alt="Amped AI on-air hosts" width="1200" height="800" loading="lazy" style="width:100%; height:100%; object-fit:cover;">
              </div>
            </div>
          </div>

          <!-- Station Info -->
          <div class="col-6">
            <div class="card">
              <div class="body">
                <p>
                  Amped AI is a fully automated radio station running around the clock.
                  Shows are written by large language models, voiced using advanced text-to-speech,
                  and scheduled with AzuraCast. Every track played is AI-generated music, making the
                  station a complete end-to-end experiment in machine-driven broadcasting.
                </p>
                <p>
                  The goal is simple: see how close AI can get to creating the energy and flow of
                  traditional radio, while opening the door to new kinds of programming that wouldn’t
                  be possible with a fixed human schedule.
                </p>
                <div style="display:flex; gap:8px; flex-wrap:wrap; margin-top:6px;">
                  <span class="chip">Live 24/7</span>
                  <span class="chip">Powered by AzuraCast</span>
                  <span class="chip">AI Hosts</span>
                  <span class="chip">100% AI Music</span>
                </div>
              </div>
            </div>
          </div>

        </div>
      </div>
    </section>

    <section id="ethics" style="margin-top:4rem;">
      <div class="container">
        <div class="card">
          <div class="body" style="text-align:center;">
            <h3 class="neon">Ethics & Transparency</h3>
            <p style="max-width:720px; margin:0 auto;">
              Amped AI is an experiment — a side project, not a full-time job for anyone involved.
              If people enjoy it, great; if not, that’s fine too. The goal isn’t to replace radio DJs or take work away.
              Every show you hear is fully generated using a mix of large language models and ElevenLabs text-to-speech,
              with light human curation to keep things sensible and safe.
            </p>
            <br>
          </div>
        </div>
      </div>
    </section>

  </main>

  <footer>
    <div class="container footer-grid">
      <div class="footer-brand">
        <img src="AmpedMediaLogo.png" alt="Amped Media logo" class="footer-logo" width="220" height="80" loading="lazy">
        <span>© <span id="year"></span> Amped Media a TGNZ Networks Project • V0.4</span>
      </div>
      <div class="socials" aria-label="Social links">
        <a class="icon-btn" href="#" aria-label="X / Twitter"><svg viewBox="0 0 24 24" fill="currentColor"><path d="M3 3h3l6.5 8.2L18.5 3H21l-7.4 9.5L21 21h-3l-6.8-8.6L6 21H3l8-10.3L3 3Z"/></svg></a>
        <a class="icon-btn" href="#" aria-label="YouTube"><svg viewBox="0 0 24 24" fill="currentColor"><path d="M23 12s0-3.3-.4-4.9c-.2-.9-.9-1.6-1.8-1.8C18.9 4.8 12 4.8 12 4.8s-6.9 0-8.8.5c-.9.2-1.6.9-1.8 1.8C1 8.7 1 12 1 12s0 3.3.4 4.9c.2.9.9 1.6 1.8 1.8 1.9.5 8.8.5 8.8.5s6.9 0 8.8-.5c.9-.2 1.6-.9 1.8-1.8.4-1.6.4-4.9.4-4.9Zm-13 3.3V8.7l5.8 3.3-5.8 3.3Z"/></svg></a>
        <a class="icon-btn" href="#" aria-label="Instagram"><svg viewBox="0 0 24 24" fill="currentColor"><path d="M7 2h10a5 5 0 0 1 5 5v10a5 5 0 0 1-5 5H7a5 5 0 0 1-5-5V7a5 5 0 0 1 5-5Zm0 2a3 3 0 0 0-3 3v10a3 3 0 0 0 3 3h10a3 3 0 0 0 3-3V7a3 3 0 0 0-3-3H7Zm11 2a1 1 0 1 1 0 2 1 1 0 0 1 0-2ZM12 7a5 5 0 1 1-.001 10.001A5 5 0 0 1 12 7Zm0 2a3 3 0 1 0 0 6 3 3 0 0 0 0-6Z"/></svg></a>
      </div>
    </div>
  </footer>

<script>
/* =========================================================================
   Amped AI — Frontend Script
   ======================================================================= */

/* ----------------------------- CONFIG ---------------------------------- */
const CONFIG = {
  streamURL: "https://amped-ai1.azuracast.tgnz.net/listen/amped_ai/radio.mp3",
  apiBase:   "https://amped-ai1.azuracast.tgnz.net/api",
  station:   "amped_ai",
  stationId: 1,
  timeZone:  "Pacific/Auckland",
  liveLabel: "Live"
};

// Visible shows on the homepage grid
const SHOWS = [
  { title: "Amped Mornings with Miki",      time: "Weekdays 5–9 AM",   image: "AMWM.png", imageText: "MIKI", desc: "Wake-ups, headlines, and feel-good anthems." },
  { title: "The Amped Drive Home with Jax", time: "Weekdays 3–7 PM",   image: "ADHJ.png", imageText: "JAX",  desc: "Commutes with momentum — throwbacks + new drops." },
  { title: "Midnight Flow with Sam Carter", time: "Nightly 11 PM–2 AM", image: "MFSC.png", imageText: "SAM", desc: "Late-night downtempo and calm talk." }
];

const HOST_THEMES = {
  autodj: {
    label: 'AutoDJ',
    aliases: ['auto', 'automation', 'radio-bot', 'amp'],
    darkVars: {
      '--brand-h': '330',
      '--brand-s': '100%',
      '--brand-l': '60%',
      '--bg': '#0a0b0f',
      '--surface': '#101218',
      '--surface-2': '#141823',
      '--text': '#f5f7fb',
      '--muted': '#97a1b3',
      '--border': '#283042'
    },
    lightVars: {
      '--brand-h': '330',
      '--brand-s': '92%',
      '--brand-l': '58%',
      '--bg': '#fff5fb',
      '--surface': '#ffeefd',
      '--surface-2': '#f9e0f2',
      '--text': '#1a0b17',
      '--muted': '#815a78',
      '--border': '#f4c7e6'
    },
    accentSvg: 'data:image/svg+xml;utf8,<svg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%20280%20220%22><defs><linearGradient%20id=%22g%22%20x1=%220%%22%20y1=%220%%22%20x2=%22100%%22%20y2=%22100%%22><stop%20offset=%220%%22%20stop-color=%22%23ff4db8%22/><stop%20offset=%22100%%22%20stop-color=%22%23ff8a1f%22/></linearGradient></defs><path%20fill=%22url(%23g)%22%20d=%22M30%200h190l60%20120-80%20100H40L0%20120z%22/></svg>',
    texture: 'radial-gradient(circle at 18% 18%, rgba(255, 77, 184, 0.22), transparent 62%)'
  },
  miki: {
    label: 'Miki',
    aliases: ['miki-rivers', 'miki-show', 'amped-mornings-with-miki'],
    darkVars: {
      '--brand-h': '195',
      '--brand-s': '100%',
      '--brand-l': '58%',
      '--bg': '#04141f',
      '--surface': '#0a1f2b',
      '--surface-2': '#0f2936',
      '--text': '#f2f9ff',
      '--muted': '#8eb5d0',
      '--border': '#103347'
    },
    lightVars: {
      '--brand-h': '195',
      '--brand-s': '96%',
      '--brand-l': '52%',
      '--bg': '#f1fbff',
      '--surface': '#e4f5ff',
      '--surface-2': '#d6ecfb',
      '--text': '#041621',
      '--muted': '#48738c',
      '--border': '#b0d9ef'
    },
    accentSvg: 'data:image/svg+xml;utf8,<svg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%20260%20200%22><defs><linearGradient%20id=%22g%22%20x1=%2220%%22%20y1=%220%%22%20x2=%22100%%22%20y2=%2280%%22><stop%20offset=%220%%22%20stop-color=%22%2325d6ff%22/><stop%20offset=%22100%%22%20stop-color=%22%238c4dff%22/></linearGradient></defs><path%20fill=%22url(%23g)%22%20d=%22M0%2040%20120%200l140%2080-80%20120H40z%22/><circle%20cx=%2270%22%20cy=%22110%22%20r=%2226%22%20fill=%22rgba(255,255,255,0.45)%22/><circle%20cx=%22170%22%20cy=%2270%22%20r=%2218%22%20fill=%22rgba(255,255,255,0.36)%22/></svg>',
    texture: 'radial-gradient(circle at 75% 20%, rgba(37, 214, 255, 0.18), transparent 58%)'
  },
  jax: {
    label: 'Jax',
    aliases: ['jax-drive', 'jax-miki', 'the-amped-drive-home-with-jax', 'amped-ai-with-jax-miki'],
    darkVars: {
      '--brand-h': '25',
      '--brand-s': '100%',
      '--brand-l': '64%',
      '--bg': '#18090f',
      '--surface': '#201016',
      '--surface-2': '#2b151d',
      '--text': '#fff6f9',
      '--muted': '#d1a1ac',
      '--border': '#3c1d27'
    },
    lightVars: {
      '--brand-h': '25',
      '--brand-s': '98%',
      '--brand-l': '58%',
      '--bg': '#fff8f5',
      '--surface': '#ffefe9',
      '--surface-2': '#ffe3d9',
      '--text': '#32110d',
      '--muted': '#a87062',
      '--border': '#f5c6b5'
    },
    accentSvg: 'data:image/svg+xml;utf8,<svg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%20260%20200%22><defs><linearGradient%20id=%22g%22%20x1=%220%%22%20y1=%220%%22%20x2=%22100%%22%20y2=%22100%%22><stop%20offset=%220%%22%20stop-color=%22%23ffd166%22/><stop%20offset=%22100%%22%20stop-color=%22%23ff006e%22/></linearGradient></defs><path%20fill=%22url(%23g)%22%20d=%22M30%2020h170l60%2090-120%2090L0%20140z%22/><path%20fill=%22rgba(255,255,255,0.35)%22%20d=%22m80%2040%20120%2040-50%2080-130-40z%22/></svg>',
    texture: 'radial-gradient(circle at 82% 22%, rgba(255, 0, 110, 0.18), transparent 60%)'
  },
  sam: {
    label: 'Sam',
    aliases: ['sam-carter', 'midnight-flow', 'midnight-flow-with-sam-carter'],
    darkVars: {
      '--brand-h': '250',
      '--brand-s': '88%',
      '--brand-l': '60%',
      '--bg': '#060716',
      '--surface': '#0b0d1f',
      '--surface-2': '#101329',
      '--text': '#eef1ff',
      '--muted': '#9aa2cc',
      '--border': '#171c3a'
    },
    lightVars: {
      '--brand-h': '250',
      '--brand-s': '82%',
      '--brand-l': '58%',
      '--bg': '#f4f6ff',
      '--surface': '#e9ecff',
      '--surface-2': '#dde2ff',
      '--text': '#11163a',
      '--muted': '#5f6ba3',
      '--border': '#c3caf1'
    },
    accentSvg: 'data:image/svg+xml;utf8,<svg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%20260%20200%22><defs><linearGradient%20id=%22g%22%20x1=%2220%%22%20y1=%220%%22%20x2=%22100%%22%20y2=%22100%%22><stop%20offset=%220%%22%20stop-color=%22%233a86ff%22/><stop%20offset=%22100%%22%20stop-color=%22%238338ec%22/></linearGradient></defs><path%20fill=%22url(%23g)%22%20d=%22M0%2060%20140%200l120%20120-100%2080H40z%22/><path%20fill=%22rgba(255,255,255,0.4)%22%20d=%22M40%20120c40-30%2090-40%20140-10l-20%2060-120%2020z%22/></svg>',
    texture: 'radial-gradient(circle at 20% 30%, rgba(58, 134, 255, 0.18), transparent 55%)'
  },
  live: {
    label: 'Live',
    aliases: ['live', 'special-guest', 'guest'],
    darkVars: {
      '--brand-h': '335',
      '--brand-s': '100%',
      '--brand-l': '58%',
      '--bg': '#160510',
      '--surface': '#220614',
      '--surface-2': '#2c0819',
      '--text': '#ffe8f2',
      '--muted': '#f28cb6',
      '--border': '#3d0c23'
    },
    lightVars: {
      '--brand-h': '335',
      '--brand-s': '96%',
      '--brand-l': '56%',
      '--bg': '#fff4f8',
      '--surface': '#ffe6ef',
      '--surface-2': '#ffd7e5',
      '--text': '#35101f',
      '--muted': '#b35a7e',
      '--border': '#f5b7cd'
    },
    accentSvg: 'data:image/svg+xml;utf8,<svg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%20260%20200%22><defs><radialGradient%20id=%22g%22%20cx=%2250%%22%20cy=%2240%%22%20r=%2275%%22><stop%20offset=%220%%22%20stop-color=%22%23ff006e%22/><stop%20offset=%22100%%22%20stop-color=%22%23f72585%22/></radialGradient></defs><path%20fill=%22url(%23g)%22%20d=%22M20%200h200l40%20120-120%2080L0%20140z%22/><circle%20cx=%2290%22%20cy=%2280%22%20r=%2224%22%20fill=%22rgba(255,255,255,0.35)%22/></svg>',
    texture: 'radial-gradient(circle at 12% 25%, rgba(247, 37, 133, 0.22), transparent 60%)'
  }
};

const HOST_THEME_STORAGE_KEY = 'amped-active-host';
const DEFAULT_HOST_SLUG = 'autodj';
let lastScheduleSlug = DEFAULT_HOST_SLUG;

const STATION_TZ = CONFIG.timeZone || 'Pacific/Auckland';
const UP_NEXT_LIMIT = 4;
const MINUTE_MS = 60 * 1000;
const DAY_MS = 24 * 60 * MINUTE_MS;

const WEEKDAY_SHELL_SLOTS = [
  { title: 'Amped Mornings with Miki',      startMinutes:  5 * 60,      endMinutes:  9 * 60 },
  { title: 'Amped AI with Jax & Miki',      startMinutes:  9 * 60,      endMinutes: 16 * 60 + 45 },
  { title: 'The Amped Drive Home with Jax', startMinutes: 16 * 60 + 45, endMinutes: 22 * 60 },
  { title: 'Midnight Flow with Sam Carter', startMinutes: 22 * 60,      endMinutes: 29 * 60 }
];

/* ------------------------------ HELPERS -------------------------------- */
const $  = (sel, root = document) => root.querySelector(sel);
const $$ = (sel, root = document) => [...root.querySelectorAll(sel)];
const setText = (el, txt) => { if (el) el.textContent = txt; };
const show   = (el, display = "") => { if (el) el.style.display = display; };
const hide   = el => { if (el) el.style.display = "none"; };
const debounce = (fn, wait = 120) => {
  let timer;
  return (...args) => {
    clearTimeout(timer);
    timer = setTimeout(() => fn.apply(undefined, args), wait);
  };
};

/* --------------------------- HOST TAKEOVERS --------------------------- */
const slugifyHost = (value = '') => {
  return String(value)
    .toLowerCase()
    .replace(/[^a-z0-9]+/g, '-')
    .replace(/^-+|-+$/g, '')
    || DEFAULT_HOST_SLUG;
};

const resolveHostThemeSlug = (hostName, { asSlug = false } = {}) => {
  if (!hostName) return DEFAULT_HOST_SLUG;
  if (asSlug) return HOST_THEMES[hostName] ? hostName : DEFAULT_HOST_SLUG;

  const slug = slugifyHost(hostName);
  if (HOST_THEMES[slug]) return slug;

  for (const [key, theme] of Object.entries(HOST_THEMES)) {
    if (key === slug) return key;
    const aliases = theme.aliases || [];
    if (aliases.includes(slug)) return key;
  }

  for (const [key, theme] of Object.entries(HOST_THEMES)) {
    const aliases = theme.aliases || [];
    if (slug.includes(key)) return key;
    if (aliases.some(alias => slug.includes(alias))) return key;
  }

  for (const part of slug.split('-')) {
    if (HOST_THEMES[part]) return part;
  }

  return DEFAULT_HOST_SLUG;
};

const applyHostSkin = (() => {
  let lastSlug = '';

  const setRootVars = (theme = {}) => {
    const root = document.documentElement;
    const rootStyle = root.style;
    const mode = root.getAttribute('data-theme') === 'light' ? 'light' : 'dark';
    const variantKey = mode === 'light' ? 'lightVars' : 'darkVars';

    const defaultTheme = HOST_THEMES[DEFAULT_HOST_SLUG] || {};
    const baseVars = defaultTheme[variantKey]
      || defaultTheme.darkVars
      || defaultTheme.lightVars
      || {};
    const activeVars = theme[variantKey]
      || theme.darkVars
      || theme.lightVars
      || {};

    const merged = { ...baseVars, ...activeVars };
    for (const [prop, value] of Object.entries(merged)) {
      if (value == null) rootStyle.removeProperty(prop);
      else rootStyle.setProperty(prop, value);
    }
  };

  const setAccentAssets = (slug, { accentSvg, texture }) => {
    const accentEl = document.getElementById('hostAccent');
    const promoCard = document.querySelector('.promo-card');

    document.documentElement.dataset.hostTheme = slug;

    const textureValue = texture || HOST_THEMES[DEFAULT_HOST_SLUG]?.texture || 'none';
    document.documentElement.style.setProperty('--promo-texture', textureValue || 'none');

    if (promoCard) promoCard.setAttribute('data-host', slug);
    if (!accentEl) return;

    if (accentSvg) {
      accentEl.src = accentSvg;
      accentEl.hidden = false;
    } else {
      accentEl.hidden = true;
      accentEl.removeAttribute('src');
    }
  };

  return (hostName, opts = {}) => {
    const slug = resolveHostThemeSlug(hostName, { asSlug: opts.asSlug });
    if (!slug) return;
    if (slug === lastSlug && !opts.force) return;

    const theme = HOST_THEMES[slug] || HOST_THEMES[DEFAULT_HOST_SLUG];
    setRootVars(theme);
    setAccentAssets(slug, {
      accentSvg: theme?.accentSvg ?? HOST_THEMES[DEFAULT_HOST_SLUG]?.accentSvg,
      texture: theme?.texture ?? HOST_THEMES[DEFAULT_HOST_SLUG]?.texture
    });

    lastSlug = slug;

    if (!opts.skipPersist) {
      try {
        localStorage.setItem(HOST_THEME_STORAGE_KEY, slug);
      } catch (err) {
        console.warn('Unable to persist host theme', err);
      }
    }
  };
})();

const applyHostSkinDebounced = debounce((host) => applyHostSkin(host), 180);

function hydrateHostSkinFromStorage() {
  let stored;
  try {
    stored = localStorage.getItem(HOST_THEME_STORAGE_KEY);
  } catch (err) {
    console.warn('Unable to read stored host theme', err);
  }

  if (stored && HOST_THEMES[stored]) {
    applyHostSkin(stored, { asSlug: true, skipPersist: true, force: true });
    return;
  }

  applyHostSkin(DEFAULT_HOST_SLUG, { asSlug: true, skipPersist: true, force: true });
}

hydrateHostSkinFromStorage();

const toDate = (value) => {
  if (!value && value !== 0) return null;
  if (value instanceof Date) return Number.isNaN(value.getTime()) ? null : value;
  if (typeof value === 'number') {
    const ms = value > 1e12 ? value : value * 1000;
    const d = new Date(ms);
    return Number.isNaN(d.getTime()) ? null : d;
  }
  const d = new Date(value);
  return Number.isNaN(d.getTime()) ? null : d;
};

const getTimeZoneShortName = (tz) => {
  const parts = new Intl.DateTimeFormat('en-US', { timeZone: tz, timeZoneName: 'short' })
    .formatToParts(new Date());
  return parts.find(p => p.type === 'timeZoneName')?.value || tz;
};

const getOffsetPart = (date, tz) => {
  const parts = new Intl.DateTimeFormat('en-US', { timeZone: tz, timeZoneName: 'shortOffset' }).formatToParts(date);
  const value = parts.find(p => p.type === 'timeZoneName')?.value || 'GMT+00';
  const match = value.match(/GMT([+\-])(\d{1,2})(?::?(\d{2}))?/);
  return match ? `${match[1]}${match[2].padStart(2, '0')}:${(match[3] || '00').padStart(2, '0')}` : '+00:00';
};

const getOffsetInfo = (date, tz) => {
  const offset = getOffsetPart(date, tz);
  const match = offset.match(/([+\-])(\d{2}):(\d{2})/);
  const sign = (match?.[1] === '-') ? -1 : 1;
  const minutes = match ? sign * ((Number(match[2]) || 0) * 60 + (Number(match[3]) || 0)) : 0;
  return { offset, minutes };
};

const getStationStartOfDay = (tz, referenceDate = new Date()) => {
  const dayParts = new Intl.DateTimeFormat('en-GB', { timeZone: tz, year: 'numeric', month: '2-digit', day: '2-digit' })
    .formatToParts(referenceDate)
    .reduce((acc, part) => (acc[part.type] = part.value, acc), {});
  const baseUTC = Date.UTC(Number(dayParts.year), Number(dayParts.month) - 1, Number(dayParts.day));
  const midnightUTC = new Date(baseUTC);
  const offset = getOffsetInfo(midnightUTC, tz);
  const startLocal = new Date(baseUTC - offset.minutes * MINUTE_MS);
  return { startLocal, parts: dayParts, offset };
};

const formatZonedISO = (date, tz) => {
  const { offset } = getOffsetInfo(date, tz);
  const parts = new Intl.DateTimeFormat('en-GB', {
    timeZone: tz,
    year: 'numeric',
    month: '2-digit',
    day: '2-digit',
    hour: '2-digit',
    minute: '2-digit',
    second: '2-digit',
    hour12: false
  }).formatToParts(date).reduce((acc, part) => (acc[part.type] = part.value, acc), {});
  return `${parts.year}-${parts.month}-${parts.day}T${parts.hour}:${parts.minute}:${parts.second || '00'}${offset}`;
};

const updateUpNextTimeZoneLabel = (tz) => {
  const label = $('#upNextTzLabel');
  if (label) label.textContent = `Station time • ${getTimeZoneShortName(tz)}`;
};

const renderUpNextList = (items, tz) => {
  const list = $('#upNextList');
  if (!list) return false;

  updateUpNextTimeZoneLabel(tz);

  if (!Array.isArray(items) || !items.length) {
    list.innerHTML = '<li class="meta">Schedule unavailable.</li>';
    return false;
  }

  list.innerHTML = '';
  for (const item of items) {
    const li = document.createElement('li');
    li.className = 'up-next-item';

    const badge = document.createElement('span');
    badge.className = 'chip up-next-chip';
    badge.textContent = `${fmt.dayShort(item.start, tz)} ${fmt.hm(item.start, tz)}`;

    const textWrap = document.createElement('div');
    textWrap.className = 'up-next-text';

    const title = document.createElement('p');
    title.className = 'up-next-title';
    title.textContent = item.title;

    const meta = document.createElement('span');
    meta.className = 'up-next-meta';
    meta.textContent = `${fmt.hm(item.start, tz)} – ${fmt.hm(item.end, tz)}`;

    textWrap.append(title, meta);
    li.append(badge, textWrap);
    list.appendChild(li);
  }
  return true;
};

const normalizeScheduleEvent = (ev) => {
  if (!ev) return null;

  const startDate = toDate(ev?.start ?? ev?.start_at ?? ev?.start_timestamp ?? ev?.start_time ?? ev?.startDate);
  if (!startDate) return null;

  let endDate = toDate(ev?.end ?? ev?.end_at ?? ev?.end_timestamp ?? ev?.end_time ?? ev?.endDate);
  if (!endDate || endDate <= startDate) {
    const duration = Number(ev?.duration ?? ev?.length ?? ev?.length_seconds ?? ev?.playout_duration ?? ev?.duration_seconds ?? ev?.minutes ?? 0);
    const fallback = Number.isFinite(duration) && duration > 0 ? duration * 1000 : 60 * MINUTE_MS;
    endDate = new Date(startDate.getTime() + fallback);
  }

  return {
    title: String(ev?.title || ev?.name || 'Show'),
    start: startDate,
    end: endDate
  };
};

const getUpcomingEventsFromSchedule = (events, tz, limit = UP_NEXT_LIMIT) => {
  const now = Date.now();
  const upcoming = [];

  for (const ev of events || []) {
    const item = normalizeScheduleEvent(ev);
    if (!item) continue;
    if (item.start.getTime() <= now) continue;
    upcoming.push(item);
  }

  upcoming.sort((a, b) => a.start - b.start);
  return upcoming.slice(0, limit);
};

const getCurrentEventFromSchedule = (events) => {
  const now = Date.now();
  let current = null;

  for (const ev of events || []) {
    const item = normalizeScheduleEvent(ev);
    if (!item) continue;
    if (item.start.getTime() <= now && item.end.getTime() > now) {
      if (!current || item.start > current.start) {
        current = item;
      }
    }
  }

  return current;
};

const buildShellFallbackEvents = (tz, limit = UP_NEXT_LIMIT) => {
  const { startLocal } = getStationStartOfDay(tz);
  const now = Date.now();
  const events = [];

  for (let day = 0; day < 5 && events.length < limit * 2; day++) {
    for (const slot of WEEKDAY_SHELL_SLOTS) {
      const start = new Date(startLocal.getTime() + day * DAY_MS + slot.startMinutes * MINUTE_MS);
      const end = new Date(startLocal.getTime() + day * DAY_MS + slot.endMinutes * MINUTE_MS);
      if (start.getTime() > now) {
        events.push({ title: slot.title, start, end });
      }
    }
  }

  events.sort((a, b) => a.start - b.start);
  return events.slice(0, limit);
};

const getCurrentShellSlot = (tz) => {
  const { startLocal } = getStationStartOfDay(tz);
  const now = Date.now();
  const dayOffsets = [0, -1];

  for (const dayOffset of dayOffsets) {
    const dayStart = new Date(startLocal.getTime() + dayOffset * DAY_MS);
    for (const slot of WEEKDAY_SHELL_SLOTS) {
      const start = new Date(dayStart.getTime() + slot.startMinutes * MINUTE_MS);
      const end = new Date(dayStart.getTime() + slot.endMinutes * MINUTE_MS);
      if (start.getTime() <= now && end.getTime() > now) {
        return { title: slot.title, start, end };
      }
    }
  }

  return null;
};

const updateCurrentShowUI = (event, tz) => {
  const titleEl = $('#currentShowTitle');
  const timeEl = $('#currentShowTime');
  if (!titleEl || !timeEl) return false;

  if (!event) {
    setText(titleEl, 'Schedule unavailable');
    setText(timeEl, '—');
    return false;
  }

  setText(titleEl, event.title || 'On Air');

  if (event.start && event.end) {
    setText(timeEl, `${fmt.hm(event.start, tz)} – ${fmt.hm(event.end, tz)}`);
  } else {
    setText(timeEl, '—');
  }

  return true;
};

const updateCurrentShowFromEvents = (events, tz) => {
  const current = getCurrentEventFromSchedule(events);
  if (current) {
    const slug = resolveHostThemeSlug(current.title);
    lastScheduleSlug = slug;
    applyHostSkin(slug, { asSlug: true, force: true });
    updateCurrentShowUI(current, tz);
    return true;
  }

  const shellSlot = getCurrentShellSlot(tz);
  if (shellSlot) {
    const slug = resolveHostThemeSlug(shellSlot.title);
    lastScheduleSlug = slug;
    applyHostSkin(slug, { asSlug: true, force: true });
  }
  updateCurrentShowUI(shellSlot, tz);
  return Boolean(shellSlot);
};

const updateUpNextFromSchedule = (events, tz) => {
  updateCurrentShowFromEvents(events, tz);

  const upcoming = getUpcomingEventsFromSchedule(events, tz);
  if (!upcoming.length) return false;
  return renderUpNextList(upcoming, tz);
};

const renderUpNextFallback = (tz) => {
  const fallbackEvents = buildShellFallbackEvents(tz);
  renderUpNextList(fallbackEvents, tz);
  updateCurrentShowFromEvents(fallbackEvents, tz);
};

/** Format helpers with target TZ */
const fmt = {
  dayShort(d, tz) { return new Intl.DateTimeFormat('en-US', { timeZone: tz, weekday: 'short' }).format(new Date(d)); },
  hm(d, tz)       { return new Intl.DateTimeFormat(undefined, { timeZone: tz, hour: '2-digit', minute: '2-digit' }).format(new Date(d)); },
  time(t)         { return isNaN(+t) ? "" : new Date(t * 1000).toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' }); },
};

/* ------------------------------ HEADER/UI ------------------------------ */
function initHeaderUI() {
  const nav = $('#site-nav');
  const menuBtn = $('.menu-toggle');

  menuBtn?.addEventListener('click', () => {
    const open = nav.classList.toggle('open');
    menuBtn.setAttribute('aria-expanded', String(open));
    menuBtn.setAttribute('aria-controls', 'site-nav');
  });

  const themeBtn  = $('#themeBtn');
  const themeIcon = $('#themeIcon');

  const setTheme = (mode) => {
    document.documentElement.setAttribute('data-theme', mode);
    localStorage.setItem('amped-theme', mode);
    themeBtn?.setAttribute('aria-pressed', mode === 'dark' ? 'true' : 'false');
    if (themeIcon) {
      themeIcon.innerHTML = mode === 'dark'
        ? '<path fill-rule="evenodd" clip-rule="evenodd" d="M12 3a1 1 0 0 1 1 1v2a1 1 0 1 1-2 0V4a1 1 0 0 1 1-1Zm7 9a7 7 0 1 1-7-7 5 5 0 0 0 0 10 7 7 0 0 1 7-3Z"/>'
        : '<path d="M17.6 15.6A7 7 0 0 1 8.4 6.4 7 7 0 1 0 17.6 15.6Z"/>';
    }

    const activeHost = document.documentElement.dataset.hostTheme || DEFAULT_HOST_SLUG;
    applyHostSkin(activeHost, { asSlug: true, force: true, skipPersist: true });
  };

  themeBtn?.addEventListener('click', () => {
    const cur = document.documentElement.getAttribute('data-theme') || 'dark';
    setTheme(cur === 'dark' ? 'light' : 'dark');
  });

  const initialTheme = localStorage.getItem('amped-theme')
    || (matchMedia('(prefers-color-scheme: light)').matches ? 'light' : 'dark');
  setTheme(initialTheme);

  setText($('#year'), new Date().getFullYear());

  // Smooth in-page scrolling + close nav on navigate
  document.addEventListener('click', (e) => {
    const a = e.target.closest('a[href^="#"]');
    if (!a) return;
    const id = a.getAttribute('href').slice(1);
    const el = document.getElementById(id);
    if (el) {
      e.preventDefault();
      const reduce = matchMedia('(prefers-reduced-motion: reduce)').matches;
      el.scrollIntoView({ behavior: reduce ? 'auto' : 'smooth', block: 'start' });
      nav?.classList.remove('open');
      menuBtn?.setAttribute('aria-expanded', 'false');
    }
  });
}

/* ---------------------------- CAR MODE -------------------------------- */
function initCarModeToggle() {
  const toggleBtn = $('#carModeToggle');
  const root = document.documentElement;
  if (!toggleBtn || !root) return;

  const STORAGE_KEY = 'amped-car-mode';
  const textSpan = toggleBtn.querySelector('span');

  const setState = (active, { emit = true } = {}) => {
    const next = active ? 'true' : 'false';
    root.setAttribute('data-car-mode', next);
    toggleBtn.setAttribute('aria-pressed', active ? 'true' : 'false');
    const label = active ? 'Disable car mode' : 'Enable car mode';
    toggleBtn.setAttribute('aria-label', label);
    toggleBtn.setAttribute('title', label);
    if (textSpan) {
      textSpan.textContent = active ? 'Car Mode On' : 'Car Mode';
    }
    try {
      localStorage.setItem(STORAGE_KEY, next);
    } catch (err) {
      /* ignore */
    }
    if (emit) {
      document.dispatchEvent(new CustomEvent('car-mode-change', { detail: { active } }));
    }
  };

  toggleBtn.addEventListener('click', () => {
    const current = root.getAttribute('data-car-mode') === 'true';
    setState(!current);
  });

  const stored = (() => {
    try {
      return localStorage.getItem(STORAGE_KEY) === 'true';
    } catch (err) {
      return false;
    }
  })();

  setState(stored, { emit: false });
}

/* ------------------------------ SHOW GRID ------------------------------ */
function renderShows() {
  const grid = document.getElementById('showsGrid');
  if (!grid) return;
  grid.innerHTML = '';

  for (const show of SHOWS) {
    const card = document.createElement('article');
    card.className = 'card col-4';

    const hasImg = Boolean(show.image);
    const media = hasImg
      ? `<img src="${show.image}" alt="${show.title} artwork" loading="lazy" />`
      : `<div class="placeholder">${(show.imageText || show.title.slice(0, 3)).toUpperCase()}</div>`;

    card.innerHTML = `
      <div class="media">${media}</div>
      <div class="body">
        <h3>${show.title}</h3>
        <div class="meta">${show.time}</div>
        <p>${show.desc || ''}</p>
      </div>
    `;
    grid.appendChild(card);
  }
}

/* ------------------------------ SCHEDULE ------------------------------- */
function renderScheduleShell() {
  const weekdayPanel = document.getElementById('weekdayPanel');
  const weekendPanel = document.getElementById('weekendPanel');
  const weekdayTab   = $('#weekdayTab');
  const weekendTab   = $('#weekendTab');

  if (weekdayPanel) {
    weekdayPanel.innerHTML = `
      <table>
        <thead><tr><th>Day</th><th style="width:180px">Time</th><th>Program</th></tr></thead>
        <tbody>
          <tr><td>Mon–Fri</td><td>05:00–09:00</td><td>Amped Mornings with Miki</td></tr>
          <tr><td>Mon–Fri</td><td>09:00–16:45</td><td>Amped AI with Jax & Miki</td></tr>
          <tr><td>Mon–Fri</td><td>16:45–22:00</td><td>The Amped Drive Home with Jax</td></tr>
          <tr><td>Mon–Fri</td><td>22:00–05:00</td><td>Midnight Flow with Sam Carter</td></tr>
        </tbody>
      </table>`;
  }
  if (weekendPanel) weekendPanel.innerHTML = `<div class="meta">Weekend view loads from API.</div>`;

  function setTab(isWeekend) {
    weekdayTab?.setAttribute('aria-selected', String(!isWeekend));
    weekendTab?.setAttribute('aria-selected', String(isWeekend));
    if (weekdayPanel) weekdayPanel.hidden = isWeekend;
    if (weekendPanel) weekendPanel.hidden = !isWeekend;
  }
  weekdayTab?.addEventListener('click', () => setTab(false));
  weekendTab?.addEventListener('click', () => setTab(true));
  setTab(false);
}

async function tryPopulateScheduleFromScheduleAPI() {
  const tz = STATION_TZ;
  const daysOrder = ['Sun','Mon','Tue','Wed','Thu','Fri','Sat'];

  const { startLocal } = getStationStartOfDay(tz);
  const endLocal = new Date(startLocal.getTime() + 7 * DAY_MS);

  const url = `${CONFIG.apiBase}/station/${CONFIG.stationId}/schedule`
    + `?start=${encodeURIComponent(formatZonedISO(startLocal, tz))}`
    + `&end=${encodeURIComponent(formatZonedISO(endLocal, tz))}`
    + `&timeZone=${encodeURIComponent(tz)}`;

  try {
    const res = await fetch(url);
    if (!res.ok) throw new Error(`Schedule request failed: ${res.status}`);

    const items = await res.json();
    if (!Array.isArray(items) || !items.length) {
      console.warn('schedule API returned no items');
      return [];
    }

    const buckets = new Map(); // key: "title__HH:MM–HH:MM" -> { title, time, days:Set }
    for (const ev of items) {
      const title  = ev.title || ev.name || 'Show';
      const startT = fmt.hm(ev.start, tz);
      const endT   = fmt.hm(ev.end,   tz);
      const key    = `${title}__${startT}–${endT}`;

      if (!buckets.has(key)) buckets.set(key, { title, time: `${startT}–${endT}`, days: new Set() });
      buckets.get(key).days.add(fmt.dayShort(ev.start, tz));
    }

    const compressDays = (set) => {
      const arr = daysOrder.filter(d => set.has(d));
      if (!arr.length) return '';
      const idx = arr.map(d => daysOrder.indexOf(d)).sort((a,b)=>a-b);
      const ranges = [];
      let s = idx[0], prev = idx[0];
      for (let i = 1; i < idx.length; i++) {
        if (idx[i] === prev + 1) { prev = idx[i]; continue; }
        ranges.push([s, prev]); s = prev = idx[i];
      }
      ranges.push([s, prev]);
      const toLabel = ([a,b]) => a === b ? daysOrder[a] : `${daysOrder[a]}–${daysOrder[b]}`;
      return ranges.map(toLabel).join(', ');
    };

    const rowsWeekday = [];
    const rowsWeekend = [];
    for (const b of buckets.values()) {
      const label = compressDays(b.days);
      const row = `<tr><td>${label}</td><td style="width:180px">${b.time}</td><td>${b.title}</td></tr>`;
      const hasWeekend = b.days.has('Sat') || b.days.has('Sun');
      const hasWeekday = ['Mon','Tue','Wed','Thu','Fri'].some(d => b.days.has(d));
      if (hasWeekday) rowsWeekday.push(row);
      if (hasWeekend) rowsWeekend.push(row);
    }

    const mkTable = (rows) => `
      <table>
        <thead><tr><th>Day</th><th style="width:180px">Time</th><th>Program</th></tr></thead>
        <tbody>${rows.sort().join('')}</tbody>
      </table>`;

    if (rowsWeekday.length) $('#weekdayPanel').innerHTML = mkTable(rowsWeekday);
    if (rowsWeekend.length) $('#weekendPanel').innerHTML  = mkTable(rowsWeekend);
    return items;
  } catch (e) {
    console.warn('schedule fetch failed', e);
    throw e;
  }
}

/* ------------------------------ PLAYER --------------------------------- */
function initPlayer() {
  const player   = $('#player');
  const playBtn  = $('#playBtn');
  const playIcon = $('#playIcon');
  const playLabel = playBtn?.querySelector('span');
  const volumeSlider = $('#volumeControl');
  const muteBtn      = $('#muteBtn');
  const muteIcon     = $('#muteIcon');
  const muteText     = $('#muteText');
  const upNextCard   = $('#upNextCard');
  const carModeHint  = $('#carModeHint');
  const carModeHintId = carModeHint?.id || null;
  const CAR_MODE_AUTOPLAY_KEY = 'amped-car-mode-autoplay';
  const isCarModeActive = () => document.documentElement.getAttribute('data-car-mode') === 'true';
  let carModeAutoPlayOptIn = (() => {
    try {
      return localStorage.getItem(CAR_MODE_AUTOPLAY_KEY) === 'true';
    } catch (err) {
      return false;
    }
  })();
  let carModeAutoPlaySuppressed = false;

  if (!player || !playBtn || !playIcon || !playLabel) return;

  const ICON_PLAY  = '<path d="m8 5 12 7-12 7V5Z"/>';
  const ICON_PAUSE = '<path d="M7 5h5v14H7V5Zm7 0h5v14h-5V5Z"/>';
  const ICON_VOLUME = '<path d="M4 9v6h4l5 5V4L8 9H4Z"/><path d="M16 12a4 4 0 0 0-2.3-3.6l.8-1.8A6 6 0 0 1 18 12a6 6 0 0 1-3.5 5.4l-.8-1.8A4 4 0 0 0 16 12Z"/>';
  const ICON_MUTED  = '<path d="M4 9v6h4l5 5V4L8 9H4Z"/><path d="m19 9-1.4-1.4-2.1 2.1-2.1-2.1-1.4 1.4 2.1 2.1-2.1 2.1 1.4 1.4 2.1-2.1 2.1 2.1 1.4-1.4-2.1-2.1L19 9Z"/>';

  const VOLUME_STORAGE_KEY = 'amped-volume';
  const MUTE_STORAGE_KEY   = 'amped-muted';
  const DEFAULT_VOLUME     = 1;
  const clamp = (val, min, max) => Math.min(max, Math.max(min, val));

  player.preload = 'none';

  let storedVolume = Number(localStorage.getItem(VOLUME_STORAGE_KEY));
  if (!Number.isFinite(storedVolume)) storedVolume = DEFAULT_VOLUME;
  storedVolume = clamp(storedVolume, 0, 1);
  player.volume = storedVolume;

  let lastNonZeroVolume = storedVolume > 0 ? storedVolume : DEFAULT_VOLUME;

  player.muted = localStorage.getItem(MUTE_STORAGE_KEY) === 'true';

  const applyVolumeUI = () => {
    const volPercent = Math.round(player.volume * 100);
    if (volumeSlider) {
      volumeSlider.value = String(volPercent);
      volumeSlider.setAttribute('aria-valuenow', String(volPercent));
      const valueText = player.muted ? `Muted, ${volPercent}% volume` : `${volPercent}% volume`;
      volumeSlider.setAttribute('aria-valuetext', valueText);
      if (player.muted) {
        volumeSlider.disabled = true;
        volumeSlider.setAttribute('aria-disabled', 'true');
      } else {
        volumeSlider.disabled = false;
        volumeSlider.removeAttribute('aria-disabled');
      }
    }

    const label = player.muted ? 'Unmute audio' : 'Mute audio';
    muteBtn?.setAttribute('aria-pressed', player.muted ? 'true' : 'false');
    muteBtn?.setAttribute('aria-label', label);
    muteBtn?.setAttribute('title', label);
    if (muteText) muteText.textContent = label;
    if (muteIcon) muteIcon.innerHTML = player.muted ? ICON_MUTED : ICON_VOLUME;
  };

  applyVolumeUI();

  volumeSlider?.addEventListener('input', () => {
    const value = clamp(Number(volumeSlider.value) / 100, 0, 1);
    player.volume = value;
  });

  muteBtn?.addEventListener('click', () => {
    const shouldMute = !player.muted;
    if (shouldMute) {
      if (player.volume > 0) {
        lastNonZeroVolume = player.volume;
      }
      player.muted = true;
    } else {
      const restoreVolume = lastNonZeroVolume > 0 ? lastNonZeroVolume : DEFAULT_VOLUME;
      if (player.volume === 0) {
        player.volume = restoreVolume;
      }
      player.muted = false;
    }
  });

  player.addEventListener('volumechange', () => {
    if (player.volume > 0) {
      lastNonZeroVolume = player.volume;
    }
    try {
      localStorage.setItem(VOLUME_STORAGE_KEY, player.volume.toString());
      localStorage.setItem(MUTE_STORAGE_KEY, player.muted ? 'true' : 'false');
    } catch (err) {
      /* ignore */
    }
    applyVolumeUI();
  });

  const setLiveSrc = () => {
    player.src = `${CONFIG.streamURL}?ts=${Date.now()}`; // cache-bust to avoid old buffer
    player.load();
  };
  const ICON_SPINNER = '<path fill="none" stroke="currentColor" stroke-linecap="round" stroke-width="2" d="M12 4a8 8 0 1 1-5.657 13.657"/>';

  const resetPlayBtn = (label) => {
    playBtn.disabled = false;
    playBtn.removeAttribute('aria-busy');
    playBtn.removeAttribute('aria-disabled');
    playBtn.setAttribute('title', label);
    playBtn.setAttribute('aria-label', label);
    playLabel.textContent = label;
  };

  const toPlayUI = () => {
    resetPlayBtn('Play Stream');
    playBtn.setAttribute('aria-pressed', 'false');
    playIcon.innerHTML = ICON_PLAY;
  };

  const toPauseUI = () => {
    resetPlayBtn('Pause Stream');
    playBtn.setAttribute('aria-pressed', 'true');
    playIcon.innerHTML = ICON_PAUSE;
  };

  const toConnectingUI = () => {
    playBtn.setAttribute('aria-pressed', 'false');
    playBtn.setAttribute('aria-busy', 'true');
    playBtn.setAttribute('aria-disabled', 'true');
    playBtn.disabled = true;
    playBtn.setAttribute('title', 'Connecting…');
    playBtn.setAttribute('aria-label', 'Connecting…');
    playLabel.textContent = 'Connecting…';
    playIcon.innerHTML = ICON_SPINNER;
  };

  const mediaSession = ('mediaSession' in navigator) ? navigator.mediaSession : null;
  const setMediaSessionPlaybackState = (state) => {
    if (!mediaSession) return;
    try { mediaSession.playbackState = state; }
    catch (err) { /* ignore */ }
  };

  const startPlayback = async ({ showAlert = true } = {}) => {
    if (!CONFIG.streamURL) {
      if (showAlert) alert('Add your stream URL in CONFIG.streamURL first.');
      setMediaSessionPlaybackState('none');
      return false;
    }

    toConnectingUI();
    setLiveSrc();
    try {
      await player.play();
      toPauseUI();
      setMediaSessionPlaybackState('playing');
      if (isCarModeActive()) {
        carModeAutoPlayOptIn = true;
        carModeAutoPlaySuppressed = false;
        try {
          localStorage.setItem(CAR_MODE_AUTOPLAY_KEY, 'true');
        } catch (err) {
          /* ignore */
        }
      }
      return true;
    } catch (e) {
      console.warn(e);
      toPlayUI();
      setMediaSessionPlaybackState('paused');
      return false;
    }
  };

  const stopPlayback = ({ manual = false } = {}) => {
    player.pause();
    player.removeAttribute('src');
    player.load();
    toPlayUI();
    setMediaSessionPlaybackState('paused');
    if (manual && isCarModeActive()) {
      carModeAutoPlaySuppressed = true;
    }
  };

  const attemptCarModeAutoStart = (active, { requireOptIn = true } = {}) => {
    if (!active) return;
    if (!CONFIG.streamURL) return;
    if (carModeAutoPlaySuppressed) return;
    if (requireOptIn && !carModeAutoPlayOptIn) return;
    if (!player.paused && player.src) return;
    void startPlayback({ showAlert: false });
  };

  playBtn.addEventListener('click', async () => {
    if (player.paused || !player.src) {
      await startPlayback();
    } else {
      stopPlayback({ manual: true });
    }
  });

  if (mediaSession) {
    const safeActionHandler = (action, handler) => {
      try { mediaSession.setActionHandler(action, handler); }
      catch (err) { /* ignore unsupported */ }
    };

    const updateMediaSessionMetadata = ({ title, artist, host, artwork }) => {
      const metaInit = {
        title: title || 'Unknown Title',
        artist: artist || '',
        album: host ? `with ${host}` : '',
        artwork: artwork ? [{ src: artwork, sizes: '512x512' }] : []
      };
      try { mediaSession.metadata = new MediaMetadata(metaInit); }
      catch (err) { /* ignore */ }
    };

    window.__updateMediaSessionMetadata = updateMediaSessionMetadata;

    safeActionHandler('play', () => {
      if (player.paused || !player.src) {
        void startPlayback({ showAlert: false });
      } else {
        setMediaSessionPlaybackState('playing');
      }
    });
    safeActionHandler('pause', () => {
      if (!player.paused || player.readyState > 0) {
        stopPlayback({ manual: true });
      } else {
        setMediaSessionPlaybackState('paused');
      }
    });
    safeActionHandler('stop', () => { stopPlayback({ manual: true }); });
    safeActionHandler('seekto', () => { /* Live stream: no seeking supported */ });

    setMediaSessionPlaybackState(player.paused ? 'paused' : 'playing');
  } else {
    window.__updateMediaSessionMetadata = null;
  }

  // Debounced auto-recover to prevent repeat/stutter loops
  let waitingTimer = null;
  let recovering = false;
  let lastRecoverAt = 0;
  const RECOVER_COOLDOWN = 30000; // ms

  const scheduleRecover = (reason, delay = 1500) => {
    if (player.paused) return; // only recover if user expects playback
    const now = Date.now();
    if (recovering || (now - lastRecoverAt) < RECOVER_COOLDOWN) return;
    recovering = true;
    setTimeout(() => {
      lastRecoverAt = Date.now();
      const wasPlaying = !player.paused;
      player.src = `${CONFIG.streamURL}?ts=${Date.now()}`;
      player.load();
      if (wasPlaying) player.play().catch(()=>{});
      recovering = false;
    }, delay);
  };

  player.addEventListener('playing', () => {
    toPauseUI();
    setMediaSessionPlaybackState('playing');
  });

  player.addEventListener('error', () => {
    toPlayUI();
    setMediaSessionPlaybackState('paused');
    scheduleRecover('error', 1200);
  });

  player.addEventListener('stalled', () => scheduleRecover('stalled', 1200));

  // If we sit in "waiting" for a few seconds, try a gentle recover
  player.addEventListener('waiting', () => {
    clearTimeout(waitingTimer);
    waitingTimer = setTimeout(() => scheduleRecover('waiting', 1500), 4000);
  });
  player.addEventListener('playing', () => { clearTimeout(waitingTimer); });
  player.addEventListener('timeupdate', () => { clearTimeout(waitingTimer); });

  const applyCarModeAccessibility = (active, { focusControl = false } = {}) => {
    const controls = [playBtn, volumeSlider, muteBtn];
    controls.forEach(ctrl => {
      if (!ctrl) return;
      if (active && carModeHintId) {
        ctrl.setAttribute('aria-describedby', carModeHintId);
      } else if (carModeHintId && ctrl.getAttribute('aria-describedby') === carModeHintId) {
        ctrl.removeAttribute('aria-describedby');
      }
    });
    if (upNextCard) {
      upNextCard.setAttribute('aria-hidden', active ? 'true' : 'false');
    }
    if (focusControl && active) {
      try {
        playBtn.focus({ preventScroll: true });
      } catch (err) {
        /* ignore */
      }
    }
  };

  document.addEventListener('car-mode-change', (event) => {
    const active = Boolean(event?.detail?.active);
    applyCarModeAccessibility(active, { focusControl: true });
    if (active) {
      attemptCarModeAutoStart(active, { requireOptIn: false });
    }
  });

  const initialCarMode = document.documentElement.getAttribute('data-car-mode') === 'true';
  applyCarModeAccessibility(initialCarMode);
  if (initialCarMode && carModeAutoPlayOptIn) {
    attemptCarModeAutoStart(initialCarMode, { requireOptIn: true });
  }
}

/* ----------------------- NOW PLAYING / RECENTS ------------------------- */
function initNowPlaying() {
  const titleEl     = $('#trackTitle');
  const metaEl      = $('#trackMeta');
  const barEl       = $('#progressBar');
  const artImg      = $('#artImg');
  const artFallback = $('#artFallback');
  const recentList  = $('#recentList');
  const liveLabelEl = $('#liveLabel');

  if (!titleEl || !metaEl || !barEl) return;

  // Smooth progress (respect reduced motion)
  const reduce = matchMedia('(prefers-reduced-motion: reduce)').matches;
  if (!reduce) barEl.style.transition = 'width 0.9s linear';

  let elapsed = 0, duration = 1;

  const pushMediaSessionMetadata = (info) => {
    if (typeof window.__updateMediaSessionMetadata === 'function') {
      window.__updateMediaSessionMetadata(info);
    }
  };

  const updateProgress = () => {
    const pct = Math.min(100, Math.round((elapsed / Math.max(1, duration)) * 100));
    barEl.style.width = pct + '%';
  };

  async function fetchNowPlaying() {
    try {
      let data;
      const r1 = await fetch(`${CONFIG.apiBase}/nowplaying/${CONFIG.station}`);
      if (r1.ok) {
        data = await r1.json();
      } else {
        const r2 = await fetch(`${CONFIG.apiBase}/nowplaying`);
        const list = await r2.json();
        data = Array.isArray(list) ? list.find(s => (s.station?.shortcode || '') === CONFIG.station) : null;
      }
      if (!data) throw new Error('No station data');

      const np     = data.now_playing || {};
      const song   = np.song || {};
      const isLive = (data.live && data.live.is_live) || false;
      const host   = isLive ? (data.live.streamer_name || 'Live') : (data.playing_next?.artist || 'AutoDJ');
      const hostSlug = resolveHostThemeSlug(host);
      const isAutomation = hostSlug === DEFAULT_HOST_SLUG;
      const liveChip = liveLabelEl?.closest('.chip');

      if (!isAutomation) {
        applyHostSkinDebounced(host || 'AutoDJ');
      } else {
        applyHostSkin(lastScheduleSlug, { asSlug: true });
      }

      setText(titleEl, song.title || 'Unknown Title');

      // Build meta safely (no HTML injection)
      metaEl.replaceChildren();
      const artistSpan = document.createElement('span');
      artistSpan.textContent = song.artist || 'Unknown Artist';
      metaEl.append(artistSpan);
      if (!isAutomation) {
        const sep = document.createTextNode(' • ');
        const withText = document.createTextNode(isLive ? 'live with ' : 'with ');
        const hostStrong = document.createElement('strong');
        hostStrong.textContent = host;
        metaEl.append(sep, withText, hostStrong);
      }

      const showLiveChip = isLive && !isAutomation;
      if (liveChip) liveChip.hidden = !showLiveChip;
      setText(liveLabelEl, showLiveChip ? CONFIG.liveLabel : '');

      // Artwork
      const artUrl = song.art || song.artwork || '';
      if (artUrl) { artImg.src = artUrl; show(artImg, 'block'); hide(artFallback); }
      else { artImg.removeAttribute('src'); hide(artImg); show(artFallback); }

      pushMediaSessionMetadata({
        title: song.title || 'Unknown Title',
        artist: song.artist || 'Unknown Artist',
        host,
        artwork: artUrl
      });

      // Recently played — prepend a NBSP before the time so it never sticks to text
      if (Array.isArray(data.song_history) && recentList) {
        recentList.innerHTML = data.song_history.slice(0, 8).map(h => {
          const ti = h.song?.title  || 'Unknown';
          const ar = h.song?.artist || '—';
          const time = fmt.time(h.played_at);
          const timeText = time ? `&nbsp;${time}` : '';
          return `<li class="recent-item"><span><strong>${ti}</strong> — ${ar}</span><span class="meta">${timeText}</span></li>`;
        }).join('') || '<li class="meta">No history yet.</li>';
      }

      elapsed  = Number(np.elapsed ?? 0);
      duration = Number(np.duration ?? 1) || 1;
      updateProgress();
    } catch (err) {
      // gentle fallback
      const dummy = [
        { title: 'Signal Test', artist: 'Amped AI', host: 'AutoDJ', seconds: 180 },
        { title: 'Neon City',   artist: 'Amped AI', host: 'AutoDJ', seconds: 200 }
      ][Math.floor(Math.random() * 2)];

      const hostSlug = resolveHostThemeSlug(dummy.host);
      const isAutomation = hostSlug === DEFAULT_HOST_SLUG;
      const liveChip = liveLabelEl?.closest('.chip');
      const isLive = false;

      setText(titleEl, dummy.title);
      metaEl.replaceChildren();
      metaEl.append(document.createTextNode(dummy.artist));
      if (!isAutomation) {
        metaEl.append(
          document.createTextNode(' • with '),
          Object.assign(document.createElement('strong'), { textContent: dummy.host })
        );
      }
      const showLiveChip = isLive && !isAutomation;
      if (liveChip) liveChip.hidden = !showLiveChip;
      setText(liveLabelEl, showLiveChip ? CONFIG.liveLabel : '');
      pushMediaSessionMetadata({
        title: dummy.title,
        artist: dummy.artist,
        host: dummy.host,
        artwork: ''
      });
      if (!isAutomation) {
        applyHostSkinDebounced(dummy.host);
      } else {
        applyHostSkin(lastScheduleSlug, { asSlug: true });
      }
      elapsed = 0; duration = dummy.seconds;
      updateProgress();
    }
  }

  // Timers
  setInterval(() => {
    if (duration > 0) {
      elapsed = Math.min(duration, elapsed + 1);
      updateProgress();
    }
  }, 1000);

  setInterval(fetchNowPlaying, 15000);
  fetchNowPlaying();
}

/* ------------------------------ INIT ----------------------------------- */
function init() {
  initHeaderUI();
  initCarModeToggle();
  renderShows();
  renderScheduleShell();
  const tz = STATION_TZ;
  updateUpNextTimeZoneLabel(tz);
  tryPopulateScheduleFromScheduleAPI()
    .then(items => {
      if (!Array.isArray(items) || !items.length || !updateUpNextFromSchedule(items, tz)) {
        renderUpNextFallback(tz);
      }
    })
    .catch(() => renderUpNextFallback(tz));
  initPlayer();
  initNowPlaying();
}

document.readyState !== 'loading'
  ? init()
  : document.addEventListener('DOMContentLoaded', init);
</script>


</body>
</html>
