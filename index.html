
<!DOCTYPE html>
<html lang="en" data-theme="dark" data-car-mode="false">
<head>
	<meta charset="utf-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1" />
	<meta http-equiv="X-UA-Compatible" content="IE=edge" />
	<meta http-equiv="Content-Language" content="en" />
	<meta name="robots" content="index, follow" />
	<meta name="referrer" content="no-referrer-when-downgrade" />

	<title>Amped AI — 100% AI-Generated Radio</title>
	<meta name="description" content="Amped AI is a fully AI-generated radio station. Music, hosts, and shows — all powered by artificial intelligence." />
	<meta name="keywords" content="AI radio, AI music, artificial intelligence, Amped AI, online radio, 24/7 AI stream" />
	<meta name="author" content="Amped AI / TGNZ Networks" />
	
	<!-- Performance: resolve DNS + warm TLS to AzuraCast host -->
	<link rel="dns-prefetch" href="https://amped-ai1.azuracast.tgnz.net">
	<link rel="preconnect" href="https://amped-ai1.azuracast.tgnz.net" crossorigin>
	
	<!-- Canonical -->
	<link rel="canonical" href="https://amped-ai.tgnz.net/" />

	<!-- Open Graph -->
	<meta property="og:type" content="website" />
	<meta property="og:url" content="https://amped-ai.tgnz.net/" />
	<meta property="og:site_name" content="Amped AI" />
	<meta property="og:title" content="Amped AI — 100% AI-Generated Radio" />
	<meta property="og:description" content="Listen to the world’s first fully AI-generated radio station. Music, voices, and shows created by AI — live 24/7." />
	<meta property="og:image" content="https://amped-ai.tgnz.net/GroupPhoto.jpg" />
	<meta property="og:locale" content="en_NZ">
	<meta property="og:image:alt" content="Amped AI on-air hosts">

	<!-- Twitter Card -->
	<meta name="twitter:card" content="summary_large_image" />
	<meta name="twitter:url" content="https://amped-ai.tgnz.net/" />
	<meta name="twitter:title" content="Amped AI — 100% AI-Generated Radio" />
	<meta name="twitter:description" content="Streaming 24/7: fully AI-generated music, hosts, and shows." />
	<meta name="twitter:image" content="https://amped-ai.tgnz.net/GroupPhoto.jpg" />

	<!-- Theme color for mobile browsers -->
	<meta name="theme-color" content="#ff4db8" />
	<meta name="color-scheme" content="dark light">

        <style>
          :root {
                --brand-h: 330;
                --brand-s: 100%;
                --brand-l: 60%;
                --brand: hsl(var(--brand-h) var(--brand-s) var(--brand-l));
                --brand-700: hsl(var(--brand-h) var(--brand-s) 45%);
                --brand-300: hsl(var(--brand-h) 95% 72%);
                --bg: #08090d;
                --surface: #11141c;
                --surface-2: #181d28;
                --text: #f7f9fe;
                --muted: #aab4c8;
                --border: #323c50;
                --shadow: 0 10px 30px rgba(0, 0, 0, .35);
                --r-lg: 16px;
                --r-md: 12px;
                --r-sm: 10px;
                --max: 1100px;
                --promo-texture: none;
                --focus-ring: hsl(var(--brand-h) 92% 68%);
                --focus-ring-width: 2px;
                --focus-ring-offset: 2px;
                --car-mode-transition-duration: .45s;
                --car-mode-transition-ease: cubic-bezier(.4, 0, .2, 1);
                --layer-card-bg: linear-gradient(145deg,
                      color-mix(in oklab, var(--surface-2) 92%, transparent),
                      color-mix(in oklab, var(--surface) 88%, transparent)
                );
                --layer-card-overlay: radial-gradient(120% 120% at 22% 12%, hsl(var(--brand-h) 92% 58% / .45), transparent 65%);
                --layer-border: color-mix(in oklab, var(--border) 70%, transparent);
                --layer-glass: color-mix(in oklab, var(--surface) 82%, transparent);
                --layer-hover-bg: color-mix(in oklab, var(--surface-2) 88%, transparent);
                --layer-chip-bg: color-mix(in oklab, var(--surface) 75%, transparent);
          }

          @keyframes heroFadeUp {
                from {
                  opacity: 0;
                  transform: translateY(20px);
                }

                to {
                  opacity: 1;
                  transform: translateY(0);
                }
          }

          @keyframes spin {
                from { transform: rotate(0deg); }
                to   { transform: rotate(360deg); }
          }

          @keyframes secretBoothPulse {
                0% {
                  transform: rotate(0deg) scale(1);
                  opacity: .55;
                }

                50% {
                  opacity: .85;
                }

                100% {
                  transform: rotate(360deg) scale(1.08);
                  opacity: .55;
                }
          }

          @keyframes secretBoothScan {
                0% {
                  transform: translateY(-100%);
                  opacity: 0;
                }

                35% {
                  opacity: .4;
                }

                100% {
                  transform: translateY(120%);
                  opacity: 0;
                }
          }

          [data-theme="light"] {
                --bg: #fbf4fb;
                --surface: #fff0f8;
                --surface-2: #f4e3f1;
                --text: #111017;
                --muted: #4a3b59;
                --border: #e1c6df;
                --shadow: 0 10px 30px rgba(10, 20, 40, .08);
                --focus-ring: color-mix(in oklab, hsl(var(--brand-h) var(--brand-s) var(--brand-l)) 68%, black 28%);
                --layer-card-bg: linear-gradient(145deg,
                      color-mix(in oklab, var(--surface-2) 90%, rgba(255, 255, 255, .6)),
                      color-mix(in oklab, var(--surface) 98%, transparent)
                );
                --layer-card-overlay: radial-gradient(120% 120% at 22% 12%, hsl(var(--brand-h) 95% 72% / .35), transparent 70%);
                --layer-border: color-mix(in oklab, var(--border) 55%, transparent);
                --layer-glass: color-mix(in oklab, var(--surface) 94%, rgba(255, 255, 255, .25));
                --layer-hover-bg: color-mix(in oklab, var(--surface-2) 95%, rgba(255, 255, 255, .3));
                --layer-chip-bg: color-mix(in oklab, var(--surface) 92%, rgba(255, 255, 255, .25));
          }

	  * {
		box-sizing: border-box;
	  }

	  html,
	  body {
		height: 100%;
	  }

          body {
                margin: 0;
                padding-bottom: calc(var(--mini-player-safe-area, 0px) + env(safe-area-inset-bottom, 0px));
                font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial,
                  "Apple Color Emoji", "Segoe UI Emoji";
                color: var(--text);
                background-color: var(--bg);
                background-image:
                  radial-gradient(1200px 600px at 20% -10%, hsl(var(--brand-h) 85% 20% / .45), transparent 60%),
                  radial-gradient(1000px 500px at 100% -20%, hsl(var(--brand-h) 85% 18% / .35), transparent 60%);
                background-repeat: no-repeat;
                line-height: 1.55;
                -webkit-font-smoothing: antialiased;
                -moz-osx-font-smoothing: grayscale;
          }

          body.secret-booth-active {
                background-image:
                  radial-gradient(1400px 680px at 18% -10%, hsl(var(--brand-h) 92% 30% / .52), transparent 70%),
                  radial-gradient(1200px 560px at 92% -18%, hsl(var(--brand-h) 98% 32% / .45), transparent 68%),
                  radial-gradient(1600px 880px at 50% 120%, hsl(var(--brand-h) 85% 22% / .4), transparent 78%);
                transition: background-image .6s ease;
          }

          .secret-booth-overlay {
                position: fixed;
                inset: 0;
                z-index: 9999;
                pointer-events: none;
                display: grid;
                place-items: center;
                mix-blend-mode: screen;
                opacity: 0;
                transition: opacity .6s ease;
          }

          .secret-booth-overlay::before {
                content: '';
                position: absolute;
                inset: -12%;
                background:
                  radial-gradient(circle at 40% 20%, hsl(var(--brand-h) 95% 80% / .4), transparent 62%),
                  conic-gradient(from 180deg, hsl(var(--brand-h) 100% 70% / .22), transparent 240deg, hsl(var(--brand-h) 85% 60% / .28) 300deg, transparent);
                filter: blur(12px) saturate(130%);
                animation: secretBoothPulse 18s linear infinite;
          }

          .secret-booth-overlay::after {
                content: '';
                position: absolute;
                inset: 0;
                background: linear-gradient(0deg, transparent 35%, hsl(var(--brand-h) 95% 82% / .22) 48%, transparent 65%);
                mix-blend-mode: screen;
                opacity: 0;
          }

          .secret-booth-overlay__badge {
                position: relative;
                padding: 1.6rem 2.3rem;
                border-radius: 28px;
                border: 1px solid color-mix(in oklab, var(--brand-300) 50%, transparent);
                box-shadow: 0 0 40px rgba(255, 77, 184, .35);
                backdrop-filter: blur(18px) saturate(160%);
                background: color-mix(in oklab, var(--surface-2) 65%, transparent);
                display: grid;
                gap: .35rem;
                text-align: center;
                text-transform: uppercase;
                letter-spacing: .24em;
                font-weight: 600;
          }

          .secret-booth-overlay__label {
                font-size: .78rem;
                color: color-mix(in oklab, var(--text) 78%, white 12%);
                opacity: .9;
          }

          .secret-booth-overlay__status {
                font-size: 1.08rem;
                color: color-mix(in oklab, var(--brand-300) 85%, white 10%);
                text-shadow: 0 0 18px rgba(255, 77, 184, .52);
          }

          .secret-booth-overlay__story {
                margin: .35rem 0 0;
                padding-top: .35rem;
                border-top: 1px solid color-mix(in oklab, var(--brand-300) 35%, transparent);
                text-transform: none;
                letter-spacing: .06em;
                font-size: .75rem;
                line-height: 1.4;
                color: color-mix(in oklab, var(--text) 82%, var(--brand-300) 12%);
          }

          body.secret-booth-active .secret-booth-overlay {
                opacity: 1;
          }

          body.secret-booth-active .secret-booth-overlay::after {
                opacity: 1;
                animation: secretBoothScan 3.4s ease-in-out infinite;
          }

	  a {
		color: var(--brand-300);
		text-decoration: none;
	  }

	  a:hover {
		text-decoration: underline;
	  }

	  .container {
		width: 100%;
		max-width: var(--max);
		margin-inline: auto;
		padding-inline: 20px;
	  }

          .btn {
                display: inline-flex;
                align-items: center;
                gap: .6rem;
                border-radius: 999px;
                padding: .7rem 1.05rem;
                font-weight: 600;
                text-decoration: none;
                border: 1px solid transparent;
                transition:
                  transform .08s ease,
                  box-shadow .2s ease,
                  background .2s ease,
                  padding var(--car-mode-transition-duration) var(--car-mode-transition-ease),
                  font-size var(--car-mode-transition-duration) var(--car-mode-transition-ease),
                  gap var(--car-mode-transition-duration) var(--car-mode-transition-ease);
          }

          .btn:focus-visible {
                outline: var(--focus-ring-width) solid var(--focus-ring);
                outline-offset: var(--focus-ring-offset);
          }

          .btn:hover {
                transform: translateY(-1px);
          }

          .btn[aria-busy="true"] {
                cursor: progress;
                opacity: .7;
          }

          .btn[aria-busy="true"] svg {
                animation: spin 1s linear infinite;
          }

          :where(a[href], button, [role="button"], [role="tab"], input, select, textarea, summary, [tabindex]):focus-visible {
                outline: var(--focus-ring-width) solid var(--focus-ring);
                outline-offset: var(--focus-ring-offset);
          }

          .icon-btn:focus-visible,
          nav a:focus-visible,
          .tab:focus-visible,
          .player-controls button:focus-visible,
          .player-volume input[type="range"]:focus-visible,
          .player-volume .icon-btn:focus-visible,
          .socials a:focus-visible {
                outline: var(--focus-ring-width) solid var(--focus-ring);
                outline-offset: var(--focus-ring-offset);
          }

          .btn-primary {
                background: linear-gradient(135deg, var(--brand), var(--brand-700));
                color: #fff;
                box-shadow:
                  0 0 18px hsl(var(--brand-h) 100% 60% / .55),
		  0 12px 24px hsl(var(--brand-h) 90% 50% / .25);
	  }

	  .btn-ghost {
		background: transparent;
		color: var(--text);
		border-color: var(--border);
	  }

	  .btn-ghost:hover {
		background: var(--surface-2);
	  }

	  .chip {
		display: inline-flex;
		align-items: center;
		gap: .45rem;
		padding: .3rem .6rem;
		border: 1px solid var(--border);
		border-radius: 999px;
		color: var(--muted);
		font-size: .81rem;
	  }

	  .neon {
		text-shadow:
		  0 0 10px hsl(var(--brand-h) 100% 60% / .6),
		  0 0 24px hsl(var(--brand-h) 100% 60% / .35);
	  }

	  .header {
		position: sticky;
		top: 0;
		z-index: 20;
		backdrop-filter: saturate(1.2) blur(8px);
		background: color-mix(in oklab, var(--bg) 70%, transparent);
		border-bottom: 1px solid var(--border);
	  }

          .header .row {
                display: flex;
                align-items: center;
                justify-content: space-between;
                padding: .7rem 0;
          }

          .logo {
                display: inline-flex;
                align-items: center;
                gap: .6rem;
                font-weight: 800;
                letter-spacing: .2px;
                position: relative;
          }

          .logo-img {
                width: 160px;
                height: auto;
                filter: drop-shadow(0 0 18px hsl(var(--brand-h) 100% 60% / .55));
                transition: width var(--car-mode-transition-duration) var(--car-mode-transition-ease);
          }

          nav {
                position: relative;
          }

          nav ul {
                list-style: none;
                padding: 0;
                margin: 0;
                display: flex;
                gap: 1rem;
          }

          nav a {
                color: var(--muted);
                padding: .55rem .75rem;
                border-radius: 999px;
          }

          nav a:hover,
          nav a:focus-visible,
          nav a[aria-current="page"] {
                background: var(--surface-2);
                color: var(--text);
                text-decoration: none;
          }

          #site-nav {
                max-width: 100%;
                transition: opacity var(--car-mode-transition-duration) var(--car-mode-transition-ease),
                          max-width var(--car-mode-transition-duration) var(--car-mode-transition-ease),
                          transform var(--car-mode-transition-duration) var(--car-mode-transition-ease);
                overflow: hidden;
                min-width: 0;
          }

          .header-actions {
                display: flex;
                align-items: center;
                gap: .6rem;
                transition: opacity var(--car-mode-transition-duration) var(--car-mode-transition-ease),
                          max-width var(--car-mode-transition-duration) var(--car-mode-transition-ease),
                          transform var(--car-mode-transition-duration) var(--car-mode-transition-ease),
                          gap var(--car-mode-transition-duration) var(--car-mode-transition-ease);
                min-width: 0;
          }

	  .icon-btn {
		display: inline-grid;
		place-items: center;
		width: 38px;
		height: 38px;
		border-radius: 999px;
		border: 1px solid var(--border);
		background: var(--surface-2);
	  }

          .icon-btn svg {
                width: 18px;
                height: 18px;
          }

          .sr-only {
                position: absolute;
                width: 1px;
                height: 1px;
                padding: 0;
                margin: -1px;
                overflow: hidden;
                clip: rect(0, 0, 0, 0);
                white-space: nowrap;
                border: 0;
          }

          .menu-toggle {
                display: none;
          }

          [data-car-mode="true"] #site-nav,
          [data-car-mode="true"] .header-actions {
                opacity: 0;
                max-width: 0;
                transform: translateY(-8px);
                pointer-events: none;
                flex-basis: 0;
          }

          [data-car-mode="true"] #site-nav {
                overflow: hidden;
          }

          [data-car-mode="true"] .header-actions {
                gap: 0;
                overflow: hidden;
          }

          [data-car-mode="true"] .header .row {
                justify-content: center;
          }

          [data-car-mode="true"] .logo-img {
                width: 190px;
          }

          .hero {
                padding: 48px 0 26px;
                position: relative;
                z-index: 0;
                overflow: hidden;
          }

          .hero .wrap {
                display: grid;
                grid-template-columns: 1.2fr .8fr;
                gap: 28px;
                align-items: center;
                position: relative;
                z-index: 2;
          }

          .hero .eyebrow,
          .hero h1,
          .hero p,
          .hero .cta,
          .promo-card,
          .up-next-card {
                opacity: 0;
                transform: translateY(20px);
                animation: heroFadeUp .8s ease forwards;
                position: relative;
                z-index: 2;
          }

          .eyebrow {
                display: inline-flex;
                align-items: center;
                gap: .5rem;
                font-weight: 600;
                color: var(--brand-300);
                letter-spacing: .3px;
          }

          .hero .eyebrow {
                animation-delay: .1s;
          }

          .hero h1 {
                font-size: clamp(2rem, 1.2rem + 3vw, 3.2rem);
                margin: .4rem 0 .75rem;
                line-height: 1.1;
                animation-delay: .2s;
          }

          .hero h1 span {
                color: var(--brand-300);
          }

          .hero p {
                color: var(--muted);
                max-width: 48ch;
                animation-delay: .3s;
          }

          .hero .cta {
                display: flex;
                gap: .6rem;
                margin-top: 1rem;
                flex-wrap: wrap;
                animation-delay: .4s;
          }

          .hero .eyebrow,
          .hero h1,
          .hero p {
                transition: opacity var(--car-mode-transition-duration) var(--car-mode-transition-ease),
                          transform var(--car-mode-transition-duration) var(--car-mode-transition-ease),
                          max-height var(--car-mode-transition-duration) var(--car-mode-transition-ease),
                          margin var(--car-mode-transition-duration) var(--car-mode-transition-ease);
          }

          .hero .eyebrow {
                max-height: 120px;
          }

          .hero h1,
          .hero p {
                max-height: 420px;
          }

          .player-controls {
                display: inline-flex;
                align-items: center;
                gap: .6rem;
                flex-wrap: wrap;
                transition: gap var(--car-mode-transition-duration) var(--car-mode-transition-ease),
                          max-width var(--car-mode-transition-duration) var(--car-mode-transition-ease);
          }

          .player-volume {
                display: flex;
                align-items: center;
                gap: .5rem;
                padding: .5rem .75rem;
                border: 1px solid var(--border);
                border-radius: var(--r-md);
                background: var(--surface-2);
                flex-wrap: wrap;
                transition: gap var(--car-mode-transition-duration) var(--car-mode-transition-ease),
                          padding var(--car-mode-transition-duration) var(--car-mode-transition-ease),
                          font-size var(--car-mode-transition-duration) var(--car-mode-transition-ease);
          }

          .player-volume label {
                font-size: .82rem;
                font-weight: 600;
                color: var(--muted);
                transition: font-size var(--car-mode-transition-duration) var(--car-mode-transition-ease);
          }

          .player-volume-controls {
                display: flex;
                align-items: center;
                gap: .5rem;
                flex: 1;
                transition: gap var(--car-mode-transition-duration) var(--car-mode-transition-ease);
          }

          .player-volume input[type="range"] {
                flex: 1;
                min-width: 120px;
                accent-color: var(--brand);
                background: transparent;
                transition: width var(--car-mode-transition-duration) var(--car-mode-transition-ease);
          }

          .player-volume input[type="range"][disabled] {
                opacity: .6;
                cursor: not-allowed;
          }

          .player-volume .icon-btn {
                width: 36px;
                height: 36px;
                transition: width var(--car-mode-transition-duration) var(--car-mode-transition-ease),
                          height var(--car-mode-transition-duration) var(--car-mode-transition-ease);
          }

          .mini-player {
                position: fixed;
                right: 18px;
                bottom: 18px;
                transform: translateY(calc(100% + 32px));
                width: min(560px, calc(100% - 36px));
                padding: 14px 16px;
                border-radius: var(--r-lg);
                border: 1px solid color-mix(in oklab, var(--border) 70%, transparent);
                background: color-mix(in oklab, var(--surface) 88%, transparent);
                box-shadow: 0 22px 48px color-mix(in srgb, #000 40%, transparent);
                backdrop-filter: blur(18px) saturate(1.15);
                display: grid;
                gap: 12px;
                opacity: 0;
                pointer-events: none;
                z-index: 40;
                transition: opacity .28s ease, transform .3s ease;
          }

          .mini-player--visible {
                opacity: 1;
                pointer-events: auto;
                transform: translateY(0);
          }

          .mini-player__inner {
                display: grid;
                grid-template-columns: auto 1fr auto;
                align-items: center;
                gap: 12px;
          }

          .mini-player__play {
                display: inline-flex;
                align-items: center;
                gap: .5rem;
                white-space: nowrap;
          }

          .mini-player__play svg {
                width: 18px;
                height: 18px;
          }

          .mini-player__meta {
                min-width: 0;
          }

          .mini-player__meta p {
                margin: 0;
                overflow: hidden;
                text-overflow: ellipsis;
                white-space: nowrap;
          }

          .mini-player__title {
                font-weight: 600;
                font-size: .98rem;
                color: var(--text);
          }

          .mini-player__details {
                font-size: .85rem;
                color: var(--muted);
          }

          .mini-player__status {
                display: flex;
                justify-content: flex-end;
          }

          .mini-player__chip {
                display: inline-flex;
                align-items: center;
                gap: .4rem;
                padding: .35rem .7rem;
                font-size: .72rem;
                font-weight: 600;
          }

          .mini-player__controls {
                display: flex;
                align-items: center;
                gap: .6rem;
          }

          .mini-player__controls input[type="range"] {
                width: 160px;
                accent-color: var(--brand);
                background: transparent;
          }

          .mini-player__controls input[type="range"][disabled] {
                cursor: not-allowed;
          }

          .mini-player__controls .icon-btn {
                width: 36px;
                height: 36px;
          }

          .promo-card .player-volume {
                margin-top: 1.2rem;
                width: 100%;
          }

          [data-car-mode="true"] .hero .wrap {
                grid-template-columns: 1fr;
          }

          [data-car-mode="true"] .hero .eyebrow,
          [data-car-mode="true"] .hero h1,
          [data-car-mode="true"] .hero p {
                opacity: 0;
                transform: translateY(-12px);
                max-height: 0;
                margin: 0;
                pointer-events: none;
                overflow: hidden;
          }

          [data-car-mode="true"] .player-controls {
                flex-direction: column;
                align-items: stretch;
                gap: 1rem;
                max-width: 360px;
          }

          [data-car-mode="true"] .player-controls .btn {
                font-size: 1.15rem;
                padding: 1rem 1.35rem;
                justify-content: center;
                width: 100%;
          }

          [data-car-mode="true"] .player-controls .btn svg {
                width: 26px;
                height: 26px;
          }

          #carModeToggle svg {
                width: 20px;
                height: 20px;
                transition: width var(--car-mode-transition-duration) var(--car-mode-transition-ease),
                          height var(--car-mode-transition-duration) var(--car-mode-transition-ease);
          }

          [data-car-mode="true"] #carModeToggle {
                font-size: 1.15rem;
          }

          [data-car-mode="true"] #carModeToggle svg {
                width: 28px;
                height: 28px;
          }

          [data-car-mode="true"] .player-volume {
                flex-direction: column;
                align-items: stretch;
                gap: 0.9rem;
                font-size: 1.05rem;
                padding: 1.1rem 1.35rem;
          }

          [data-car-mode="true"] .player-volume label {
                font-size: 1rem;
          }

          [data-car-mode="true"] .player-volume-controls {
                flex-direction: column;
                align-items: center;
                gap: 0.9rem;
          }

          [data-car-mode="true"] .player-volume input[type="range"] {
                width: 100%;
                flex: 1;
                min-width: 0;
          }

          [data-car-mode="true"] .player-volume .icon-btn {
                width: 52px;
                height: 52px;
          }

          [data-car-mode="true"] .promo-card h3#trackTitle {
                font-size: clamp(1.6rem, 1.3rem + 1vw, 2.2rem);
          }

          [data-car-mode="true"] #trackMeta {
                font-size: 1.1rem;
          }

          [data-car-mode="true"] .progress {
                height: 12px;
          }

          #carModeUpNext {
                display: flex;
                flex-direction: column;
                gap: 0;
                padding: 0;
                border-radius: var(--r-lg);
                border: 1px solid transparent;
                background: var(--surface-2);
                box-shadow: none;
                opacity: 0;
                transform: translateY(16px);
                max-height: 0;
                pointer-events: none;
                overflow: hidden;
                transition: opacity var(--car-mode-transition-duration) var(--car-mode-transition-ease),
                          transform var(--car-mode-transition-duration) var(--car-mode-transition-ease),
                          max-height var(--car-mode-transition-duration) var(--car-mode-transition-ease),
                          padding var(--car-mode-transition-duration) var(--car-mode-transition-ease),
                          gap var(--car-mode-transition-duration) var(--car-mode-transition-ease),
                          border-color var(--car-mode-transition-duration) var(--car-mode-transition-ease),
                          box-shadow var(--car-mode-transition-duration) var(--car-mode-transition-ease);
          }

          #carModeUpNext .car-mode-section {
                display: flex;
                flex-direction: column;
                gap: .75rem;
          }

          #carModeUpNext .car-mode-chip {
                font-size: .95rem;
                font-weight: 600;
          }

          #carModeUpNext .car-mode-time {
                font-size: 1.1rem;
                color: var(--muted);
          }

          #carModeUpNext .car-mode-countdown {
                font-size: 1.05rem;
                font-weight: 600;
                color: var(--text);
          }

          #carModeUpNext.car-mode-up-next--visible {
                opacity: 1;
                transform: translateY(0);
                max-height: 1600px;
                padding: 2.4rem;
                gap: 2.25rem;
                border-color: var(--border);
                box-shadow: var(--shadow);
                pointer-events: auto;
          }

          #carModeUpNext.car-mode-up-next--visible .car-mode-chip {
                font-size: 1.05rem;
                padding: .45rem .95rem;
          }

          #carModeUpNext.car-mode-up-next--visible h2,
          #carModeUpNext.car-mode-up-next--visible h3 {
                margin: 0;
          }

          #carModeUpNext.car-mode-up-next--visible h2 {
                font-size: clamp(2rem, 1.6rem + 3vw, 3.1rem);
                line-height: 1.1;
          }

          #carModeUpNext.car-mode-up-next--visible h3 {
                font-size: clamp(1.6rem, 1.2rem + 2vw, 2.4rem);
                line-height: 1.15;
          }

          #carModeUpNext.car-mode-up-next--visible .car-mode-time {
                font-size: clamp(1.3rem, 1.1rem + 1vw, 1.8rem);
          }

          #carModeUpNext.car-mode-up-next--visible .car-mode-countdown {
                font-size: clamp(1.2rem, 1rem + .8vw, 1.6rem);
                letter-spacing: .02em;
          }

          [data-car-mode="true"] #upNextCard {
                opacity: 0;
                transform: translateY(16px);
                max-height: 0;
                margin-top: 0;
                padding: 0;
                border-color: transparent;
                box-shadow: none;
                pointer-events: none;
                overflow: hidden;
          }

          [data-car-mode="true"] #upNextCard::before {
                opacity: 0;
          }

          [data-car-mode="true"] #upNextCard .body {
                padding: 0;
                opacity: 0;
          }

          .promo-card {
                position: relative;
                overflow: hidden;
                background-image:
                  var(--promo-texture),
                  linear-gradient(180deg, color-mix(in oklab, var(--surface) 85%, transparent), var(--surface));
                background-repeat: no-repeat;
                background-size: cover, auto;
                border: 1px solid var(--border);
                border-radius: var(--r-lg);
                padding: 18px;
                box-shadow: var(--shadow);
                animation-delay: .25s;
          }

          .promo-card .promo-accent {
                position: absolute;
                top: -30px;
                right: -20px;
                width: clamp(160px, 22vw, 220px);
                opacity: .55;
                pointer-events: none;
                filter: drop-shadow(0 18px 28px rgba(0, 0, 0, .35));
                transition: opacity .3s ease;
                z-index: 0;
          }

          .promo-card .promo-accent[hidden] {
                opacity: 0;
          }

          .promo-card .now {
                position: relative;
                z-index: 1;
          }

          .promo-card h3 {
                margin: .4rem 0;
          }

          .promo-card h3#trackTitle {
                transition: font-size var(--car-mode-transition-duration) var(--car-mode-transition-ease);
          }

          #trackMeta {
                transition: font-size var(--car-mode-transition-duration) var(--car-mode-transition-ease);
          }

          .up-next-card {
                --card-bg: var(--layer-card-bg);
                --card-border: var(--layer-border);
                --card-shadow: 0 26px 60px color-mix(in srgb, #000 40%, transparent);
                --card-body-bg: transparent;
                --card-body-padding: clamp(24px, 5vw, 32px);
                --card-body-gap: clamp(22px, 4vw, 28px);
                margin-top: 18px;
                grid-column: 1 / -1;
                position: relative;
                isolation: isolate;
                animation-delay: .35s;
                max-height: 9999px;
                transition: opacity var(--car-mode-transition-duration) var(--car-mode-transition-ease),
                          transform var(--car-mode-transition-duration) var(--car-mode-transition-ease),
                          max-height var(--car-mode-transition-duration) var(--car-mode-transition-ease),
                          margin var(--car-mode-transition-duration) var(--car-mode-transition-ease),
                          padding var(--car-mode-transition-duration) var(--car-mode-transition-ease),
                          border-color var(--car-mode-transition-duration) var(--car-mode-transition-ease),
                          box-shadow var(--car-mode-transition-duration) var(--car-mode-transition-ease);
          }

          .up-next-card::before {
                content: "";
                position: absolute;
                inset: -40% -30% 40% -30%;
                background: var(--layer-card-overlay);
                filter: blur(28px);
                opacity: .85;
                z-index: 0;
                pointer-events: none;
          }

          .up-next-card .body {
                position: relative;
                z-index: 1;
                display: grid;
                transition: opacity var(--car-mode-transition-duration) var(--car-mode-transition-ease),
                          padding var(--car-mode-transition-duration) var(--car-mode-transition-ease);
          }

          .current-show {
                position: relative;
                display: grid;
                grid-template-columns: minmax(0, 1fr);
                grid-template-rows: auto auto;
                gap: clamp(18px, 4vw, 24px);
                padding: clamp(22px, 5vw, 30px);
                border-radius: calc(var(--r-lg) - 2px);
                background: var(--layer-glass);
                border: 1px solid color-mix(in oklab, var(--layer-border) 85%, transparent);
                box-shadow: 0 20px 48px color-mix(in srgb, #000 35%, transparent);
                backdrop-filter: blur(18px) saturate(1.3);
                overflow: hidden;
                isolation: isolate;
          }

          .current-show::before {
                content: "";
                position: absolute;
                inset: -55% -35% 15% -35%;
                background: radial-gradient(120% 120% at 20% 18%, hsl(var(--brand-h) 96% 66% / .55), transparent 65%);
                filter: blur(32px);
                opacity: .9;
                z-index: 0;
          }

          .current-show > * {
                position: relative;
                z-index: 1;
          }

          .current-show-badge {
                justify-self: start;
                padding: .45rem 1.05rem;
                border-radius: 999px;
                font-size: .8rem;
                letter-spacing: .14em;
                text-transform: uppercase;
                font-weight: 700;
                background: linear-gradient(135deg, var(--brand-300), var(--brand));
                color: #0a030f;
                box-shadow:
                  0 0 0 1px color-mix(in oklab, #fff 65%, transparent),
                  0 0 22px hsl(var(--brand-h) 95% 65% / .45);
          }

          .current-show-text {
                display: grid;
                gap: clamp(8px, 2vw, 12px);
                max-width: 48ch;
          }

          .current-show-title {
                margin: 0;
                font-size: clamp(1.55rem, 1.5vw + 1.1rem, 2.2rem);
                font-weight: 700;
                letter-spacing: -.01em;
                line-height: 1.2;
                text-wrap: balance;
          }

          .current-show-time {
                color: color-mix(in oklab, var(--text) 70%, var(--muted) 30%);
                font-size: clamp(1.05rem, 1vw + .9rem, 1.25rem);
                font-weight: 600;
                line-height: 1.35;
                text-wrap: balance;
          }

          .up-next-head {
                display: flex;
                flex-wrap: wrap;
                align-items: center;
                justify-content: space-between;
                gap: 1rem;
                padding-bottom: 12px;
                border-bottom: 1px solid color-mix(in oklab, var(--layer-border) 55%, transparent);
          }

          .up-next-list {
                list-style: none;
                padding: 0;
                margin: 0;
                display: grid;
                gap: 16px;
                counter-reset: upnext;
          }

          .up-next-item {
                counter-increment: upnext;
                position: relative;
                display: flex;
                align-items: center;
                gap: 16px;
                padding: 16px 18px;
                border-radius: var(--r-md);
                background: color-mix(in oklab, var(--layer-glass) 90%, transparent);
                border: 1px solid color-mix(in oklab, var(--layer-border) 60%, transparent);
                box-shadow: 0 10px 28px color-mix(in srgb, #000 22%, transparent);
                backdrop-filter: blur(12px) saturate(1.15);
                transition: transform .2s ease, box-shadow .25s ease, border-color .2s ease, background .2s ease;
                flex-wrap: wrap;
          }

          .up-next-item:hover,
          .up-next-item:focus-within {
                transform: translateY(-2px);
                border-color: color-mix(in oklab, var(--layer-border) 40%, var(--brand) 20%);
                background: color-mix(in oklab, var(--layer-hover-bg) 85%, transparent);
                box-shadow:
                  0 16px 34px color-mix(in srgb, #000 28%, transparent),
                  0 0 18px hsl(var(--brand-h) 92% 60% / .2);
          }

          .up-next-item:focus-within {
                outline: var(--focus-ring-width) solid var(--focus-ring);
                outline-offset: 4px;
          }

          .recent-item {
                display: flex;
                justify-content: space-between;
                align-items: center;
                gap: .75rem;
                padding: .65rem .9rem;
                border: 1px solid color-mix(in oklab, var(--border) 80%, transparent);
                border-radius: var(--r-sm);
                background: var(--surface-2);
          }

          .recent-item .meta {
                margin-left: auto;
                color: var(--muted);
                text-align: right;
                white-space: nowrap;
          }

          .up-next-item::before {
                content: counter(upnext);
                display: inline-flex;
                align-items: center;
                justify-content: center;
                width: 34px;
                height: 34px;
                border-radius: 999px;
                background: linear-gradient(140deg, var(--brand-300), var(--brand));
                color: #0b040f;
                font-weight: 700;
                font-variant-numeric: tabular-nums;
                box-shadow: 0 0 0 1px color-mix(in oklab, #fff 60%, transparent);
                flex-shrink: 0;
          }

          .up-next-text {
                display: grid;
                gap: 6px;
                flex: 1 1 220px;
                min-width: 0;
          }

          .up-next-title {
                margin: 0;
                font-size: 1.02rem;
                font-weight: 600;
          }

          .up-next-meta {
                color: color-mix(in oklab, var(--muted) 70%, var(--text) 30%);
                font-size: .88rem;
          }

          .up-next-chip {
                background: var(--layer-chip-bg);
                border-color: color-mix(in oklab, var(--layer-border) 55%, transparent);
                color: var(--text);
                font-weight: 600;
                backdrop-filter: blur(10px) saturate(1.1);
                flex-shrink: 0;
          }

	  .now {
		display: grid;
		grid-template-columns: auto 1fr auto;
		gap: 14px;
		align-items: center;
	  }

	  .art {
		width: 68px;
		height: 68px;
		border-radius: 10px;
		overflow: hidden;
		background: linear-gradient(135deg, var(--brand-300), var(--brand));
		display: grid;
		place-items: center;
	  }

	  .art img {
		width: 100%;
		height: 100%;
		object-fit: cover;
		display: none;
	  }

	  .art span {
		font-weight: 800;
		letter-spacing: .5px;
		color: #000;
	  }

	  .track h3 {
		margin: 0;
		font-size: 1.05rem;
	  }

	  .track p {
		margin: .2rem 0 0;
		color: var(--muted);
		font-size: .9rem;
	  }

          @keyframes livePulse {
                0% {
                      transform: scale(1);
                      opacity: 1;
                      box-shadow: 0 0 0 0 rgba(255, 77, 154, .28), 0 0 12px rgba(255, 77, 154, .5);
                }

                55% {
                      transform: scale(1.45);
                      opacity: .35;
                      box-shadow: 0 0 0 8px rgba(255, 77, 154, 0), 0 0 18px rgba(255, 77, 154, .28);
                }

                100% {
                      transform: scale(1);
                      opacity: 1;
                      box-shadow: 0 0 0 0 rgba(255, 77, 154, 0), 0 0 12px rgba(255, 77, 154, .4);
                }
          }

          .live-dot {
                width: 10px;
                height: 10px;
                border-radius: 50%;
                background: #ff4d9a;
                box-shadow: 0 0 0 0 rgba(255, 77, 154, .28), 0 0 10px rgba(255, 77, 154, .32);
                display: inline-block;
                animation: livePulse 1.8s ease-in-out infinite;
                will-change: transform, opacity;
          }

          @media (prefers-reduced-motion: reduce) {
                .live-dot {
                      animation: none;
                      transform: none;
                      opacity: 1;
                      box-shadow: 0 0 0 6px rgba(255, 77, 154, .12);
                }
          }

          .progress {
                height: 6px;
                background: var(--surface-2);
                border-radius: 999px;
                overflow: hidden;
                margin-top: .6rem;
                transition: height var(--car-mode-transition-duration) var(--car-mode-transition-ease);
          }

	  .bar {
		height: 100%;
		width: 0%;
		background: linear-gradient(90deg, var(--brand-300), var(--brand));
		box-shadow: 0 0 12px hsl(var(--brand-h) 100% 60% / .5) inset;
	  }

	  section {
		padding: 34px 0;
	  }

	  section h2 {
		font-size: clamp(1.4rem, 1.1rem + 1.5vw, 2rem);
		margin: 0 0 .6rem;
	  }

	  .sub {
		color: var(--muted);
		margin: 0 0 1rem;
	  }

	  .grid {
		display: grid;
		grid-template-columns: repeat(12, 1fr);
		gap: 16px;
	  }

	  .col-4 {
		grid-column: span 4;
	  }

	  .col-6 {
		grid-column: span 6;
	  }

	  .col-8 {
		grid-column: span 8;
	  }

	  .tabs {
		display: flex;
		gap: 8px;
		border-bottom: 1px solid var(--border);
		margin-bottom: 12px;
	  }

	  .tab {
		padding: .5rem .8rem;
		border: 1px solid var(--border);
		border-bottom: none;
		background: var(--surface);
		border-radius: var(--r-sm) var(--r-sm) 0 0;
		color: var(--muted);
		cursor: pointer;
	  }

	  .tab[aria-selected="true"] {
		color: var(--text);
		background: var(--surface-2);
	  }

	  table {
		width: 100%;
		border-collapse: collapse;
		border: 1px solid var(--border);
		border-radius: var(--r-md);
		overflow: hidden;
		background: var(--surface);
	  }

	  th,
	  td {
		text-align: left;
		padding: 12px 14px;
		border-bottom: 1px solid var(--border);
	  }

	  tr:hover td {
		background: var(--surface-2);
	  }

	  th {
		color: var(--muted);
		font-weight: 600;
	  }

          footer {
                border-top: 1px solid var(--border);
                padding: 28px 0 40px;
                color: var(--muted);
          }

          .footer-grid {
                display: grid;
                grid-template-columns: 1fr auto;
                gap: 16px;
                align-items: center;
          }

          .footer-brand {
                display: flex;
                align-items: center;
                gap: 12px;
                flex-wrap: wrap;
          }

          .footer-easter-trigger {
                display: inline-flex;
                align-items: center;
                background: none;
                border: none;
                color: inherit;
                font: inherit;
                padding: 0;
                margin: 0;
                cursor: pointer;
                text-decoration: underline dotted transparent;
                transition: color .2s ease, text-decoration-color .2s ease;
          }

          .footer-easter-trigger:hover,
          .footer-easter-trigger:focus-visible {
                color: var(--brand-300);
                text-decoration-color: currentColor;
                outline: none;
          }

          .footer-easter-trigger[aria-expanded="true"] {
                color: var(--brand-300);
          }

          .footer-easter-note {
                flex-basis: 100%;
                margin: 4px 0 0;
                font-size: .85rem;
                color: var(--brand-300);
          }

          .footer-logo {
                height: 42px;
                width: auto;
                display: block;
                filter: drop-shadow(0 0 12px hsl(var(--brand-h) 90% 60% / .45));
          }

          .footer-legal {
                grid-column: 1 / -1;
                font-size: .75rem;
                line-height: 1.45;
                color: var(--muted);
                max-width: 920px;
                margin-top: 8px;
                text-align: left;
          }

          .footer-legal p {
                margin: 0 0 .9rem;
          }

          .footer-legal p:last-child {
                margin-bottom: 0;
          }

          .socials {
                display: flex;
                gap: 10px;
          }

          @media (max-width: 900px) {
                .hero .wrap {
                  grid-template-columns: 1fr;
                }

                .up-next-card {
                  grid-column: auto;
                  --card-body-gap: clamp(20px, 6vw, 28px);
                  --card-body-padding: clamp(22px, 7vw, 30px);
                }

                .current-show {
                  padding: clamp(20px, 7vw, 30px);
                }

                .current-show-title {
                  font-size: clamp(1.45rem, 4vw + 1rem, 2.05rem);
                }

                .grid {
                  grid-template-columns: repeat(6, 1fr);
                }

                .col-4,
                .col-6,
                .col-8 {
                  grid-column: span 6;
                }

                .up-next-head {
                  align-items: flex-start;
                  gap: .75rem;
                }

                .up-next-item {
                  align-items: flex-start;
                }

                .logo-img {
                  width: 130px;
                }

                .footer-grid {
                  grid-template-columns: 1fr;
                  justify-items: center;
                  text-align: center;
                }

                .footer-brand {
                  justify-content: center;
                }

                .footer-easter-note {
                  text-align: center;
                }

                .socials {
                  justify-content: center;
                }
          }

          @media (max-width: 760px) {
                nav {
                  display: none;
                  position: absolute;
                  top: 64px;
                  left: 0;
                  right: 0;
                  background: var(--surface);
                  border-bottom: 1px solid var(--border);
                  padding: 10px 0;
                }

                nav.open {
                  display: block;
                }

                nav ul {
                  flex-direction: column;
                }

                .menu-toggle {
                  display: inline-grid;
                }
          }

          @media (max-width: 600px) {
                .mini-player {
                  width: calc(100% - 20px);
                  left: 50%;
                  right: auto;
                  bottom: 14px;
                  transform: translate(-50%, calc(100% + 32px));
                }

                .mini-player--visible {
                  transform: translate(-50%, 0);
                }

                .mini-player__inner {
                  grid-template-columns: 1fr;
                  gap: 10px;
                }

                .mini-player__status {
                  justify-content: flex-start;
                }

                .mini-player__controls {
                  flex-wrap: wrap;
                  width: 100%;
                }

                .mini-player__controls input[type="range"] {
                  flex: 1 1 100%;
                  width: 100%;
                }

                .player-controls {
                  width: 100%;
                }

                .player-volume {
                  flex: 1 1 100%;
                  flex-wrap: wrap;
                }

                .player-volume label {
                  width: 100%;
                }

                .player-volume-controls {
                  width: 100%;
                }

                .player-volume input[type="range"] {
                  width: 100%;
                }

                .up-next-item {
                  display: grid;
                  grid-template-columns: auto 1fr;
                  gap: 10px 12px;
                  align-items: start;
                  padding: 14px 16px;
                }

                .up-next-item::before {
                  margin: 0;
                  align-self: start;
                }

                .up-next-chip {
                  font-size: .78rem;
                  justify-self: start;
                }

                .up-next-text {
                  grid-column: 1 / -1;
                  width: 100%;
                  min-width: 0;
                }

                .current-show {
                  padding: clamp(18px, 8vw, 28px);
                }
          }

	  .skip {
		position: absolute;
		left: -9999px;
		top: auto;
		width: 1px;
		height: 1px;
		overflow: hidden;
	  }

          .skip:focus-visible {
                left: 10px;
                top: 10px;
                width: auto;
                height: auto;
                padding: .6rem .8rem;
                background: var(--surface);
                border: 1px solid var(--border);
                border-radius: var(--r-sm);
                z-index: 50;
          }

          /* Card stays solid on all themes */
          .card {
                background: var(--card-bg, var(--surface));
                border: 1px solid var(--card-border, var(--border));
                border-radius: var(--card-radius, var(--r-lg));
                box-shadow: var(--card-shadow, var(--shadow));
                overflow: clip;
                display: flex;
                flex-direction: column;
                transition: transform .25s ease, box-shadow .3s ease;
          }

          .card:hover,
          .card:focus-within {
                transform: translateY(-6px);
                box-shadow:
                  var(--card-shadow, var(--shadow)),
                  0 20px 40px hsl(var(--brand-h) 95% 55% / .25);
          }

	  /* Square thumbnail area */
	  .card .media {
		aspect-ratio: 1 / 1;
		background: var(--surface-2);
		display: grid;
		place-items: center;
		overflow: hidden;
	  }

	  /* Text area */
          .card .body {
                background: var(--card-body-bg, var(--surface));
                padding: var(--card-body-padding, 14px);
                display: grid;
                gap: var(--card-body-gap, 8px);
          }

	  /* Image + placeholder */
	  .card .media img {
		width: 100%;
		height: 100%;
		display: block;
		object-fit: cover;
		transition: transform .25s ease;
	  }

	  .card .media .placeholder {
		width: 100%;
		height: 100%;
		display: grid;
		place-items: center;
		font-weight: 800;
		font-size: 1.2rem;
		letter-spacing: .3px;
		color: #000;
		background: linear-gradient(135deg, var(--brand-300), var(--brand));
	  }

          /* Hover polish */
          .card:hover .media img {
                transform: scale(1.03);
          }

          @media (prefers-reduced-motion: reduce) {
                .card {
                      transition: none;
                }

                .card:hover,
                .card:focus-within {
                      transform: none;
                      box-shadow: var(--shadow);
                }

                .card .media img { transition: none; }

                .card:hover .media img {
                      transform: none;
                }

                .logo-img,
                #site-nav,
                .header-actions,
                .hero .eyebrow,
                .hero h1,
                .hero p,
                .player-controls,
                .btn,
                #carModeToggle svg,
                .player-volume,
                .player-volume label,
                .player-volume-controls,
                .player-volume input[type="range"],
                .player-volume .icon-btn,
                .promo-card h3#trackTitle,
                #trackMeta,
                .progress,
                #carModeUpNext,
                .up-next-card,
                .up-next-card .body {
                      transition: none !important;
                }
          }

          /* --------------------------- Seasonal Theming --------------------------- */
          #seasonalLayer {
                position: absolute;
                inset: 0;
                pointer-events: none;
                overflow: hidden;
                z-index: 1;
                opacity: 0;
                transition: opacity .6s ease;
          }

          body[data-seasonal-theme] #seasonalLayer {
                opacity: 1;
          }

          #seasonalLayer::before,
          #seasonalLayer::after {
                content: "";
                position: absolute;
                inset: -15%;
                pointer-events: none;
                opacity: 0;
                transition: opacity .6s ease, transform 12s ease;
          }

          body[data-seasonal-theme] #seasonalLayer::before,
          body[data-seasonal-theme] #seasonalLayer::after {
                opacity: 1;
          }

          .seasonal-countdown {
                position: absolute;
                top: clamp(14px, 3vw, 32px);
                right: clamp(16px, 6vw, 56px);
                background: color-mix(in oklab, var(--surface-2) 82%, rgba(0, 0, 0, .45));
                border: 1px solid color-mix(in oklab, var(--border) 60%, rgba(255, 255, 255, .1));
                border-radius: 12px;
                padding: .45rem .9rem;
                font-family: 'Roboto Mono', 'SFMono-Regular', ui-monospace, monospace;
                font-weight: 700;
                font-variant-numeric: tabular-nums;
                letter-spacing: .08em;
                text-transform: uppercase;
                color: var(--text);
                box-shadow: 0 12px 28px rgba(0, 0, 0, .28);
                z-index: 3;
                backdrop-filter: blur(8px) saturate(1.2);
                display: inline-flex;
                align-items: center;
                gap: .6rem;
          }

          .seasonal-countdown[hidden] {
                display: none;
          }

          .seasonal-tagline {
                margin-top: .9rem;
                font-weight: 600;
                letter-spacing: .05em;
                text-transform: uppercase;
                color: var(--brand-300);
                display: inline-flex;
                align-items: center;
                gap: .4rem;
                font-size: .9rem;
          }

          .seasonal-tagline::before {
                content: "✶";
                font-size: 1.05rem;
                opacity: .75;
          }

          .seasonal-tagline[hidden] {
                display: none;
          }

          .seasonal-layer .seasonal-particle {
                position: absolute;
                pointer-events: none;
                will-change: transform, opacity;
          }

          .seasonal-particle--confetti {
                width: 10px;
                height: 18px;
                border-radius: 3px;
                background: var(--confetti-color, #fff);
                top: -24px;
                left: 0;
                opacity: 0;
                animation: seasonalConfetti 7.5s linear infinite;
          }

          .seasonal-particle--sparkle {
                width: 12px;
                height: 12px;
                border-radius: 50%;
                background: radial-gradient(circle, rgba(255, 255, 255, .85) 0%, rgba(255, 255, 255, 0) 70%);
                animation: seasonalSparkle .65s ease-out forwards;
                opacity: 0;
          }

          .seasonal-layer .seasonal-bubble {
                width: 18px;
                height: 18px;
                border-radius: 50%;
                background: radial-gradient(circle, rgba(255, 255, 255, .55) 0%, rgba(255, 255, 255, 0) 70%);
                bottom: -18px;
                left: 0;
                opacity: .7;
                animation: seasonalBubble 16s ease-in infinite;
          }

          @keyframes seasonalConfetti {
                0% { transform: translate3d(var(--confetti-drift, 0px), -110%, 0) rotate(0deg); opacity: 0; }
                8% { opacity: 1; }
                100% { transform: translate3d(var(--confetti-drift, 0px), 220%, 0) rotate(540deg); opacity: 0; }
          }

          @keyframes seasonalSparkle {
                0% { transform: scale(.4); opacity: 0; }
                20% { opacity: 1; }
                100% { transform: scale(1.7); opacity: 0; }
          }

          @keyframes seasonalBubble {
                0% { transform: translate3d(var(--bubble-drift, 0px), 120%, 0) scale(.6); opacity: 0; }
                20% { opacity: .6; }
                100% { transform: translate3d(var(--bubble-drift, 0px), -160%, 0) scale(1.1); opacity: 0; }
          }

          @keyframes seasonalGlowPulse {
                0%, 100% { opacity: .32; }
                50% { opacity: .55; }
          }

          @keyframes valentineHearts {
                0% { transform: translate3d(0, 40px, 0) scale(1); opacity: .35; }
                50% { opacity: .55; }
                100% { transform: translate3d(0, -60px, 0) scale(1.05); opacity: .35; }
          }

          @keyframes easterBubbles {
                0% { transform: translate3d(0, 0, 0); }
                50% { transform: translate3d(-10px, -30px, 0); }
                100% { transform: translate3d(10px, -60px, 0); }
          }

          @keyframes easterBounce {
                0% { transform: translateY(-3px) scale(1.05); }
                100% { transform: translateY(-7px) scale(1.04) rotate(-1deg); }
          }

          @keyframes seasonalPetalsFall {
                0% { transform: translate(-20px, -10%) rotate(0deg); opacity: 0; }
                10% { opacity: .35; }
                100% { transform: translate(20px, 110%) rotate(18deg); opacity: 0; }
          }

          @keyframes seasonalTwinkle {
                0%, 100% { opacity: .45; }
                50% { opacity: .95; }
          }

          @keyframes halloweenFlight {
                0% { transform: translate3d(-10px, 10px, 0) scale(1); }
                50% { transform: translate3d(12px, -14px, 0) scale(1.05); }
                100% { transform: translate3d(-6px, -28px, 0) scale(1.1); }
          }

          @keyframes halloweenBatGlide {
                0% { transform: translate3d(var(--h-start-x, -140px), var(--h-start-y, 12px), 0) scale(.82) rotate(-4deg); opacity: 0; }
                12% { opacity: .92; }
                50% { transform: translate3d(var(--h-mid-x, 40px), var(--h-mid-y, -36px), 0) scale(1.05) rotate(2deg); opacity: 1; }
                86% { opacity: .9; }
                100% { transform: translate3d(var(--h-end-x, 210px), var(--h-end-y, -64px), 0) scale(.9) rotate(-3deg); opacity: 0; }
          }

          @keyframes halloweenLanternFloat {
                0%, 100% { transform: translate3d(0, 0, 0) scale(1); }
                50% { transform: translate3d(0, -12px, 0) scale(1.06); }
          }

          @keyframes halloweenLanternGlow {
                0%, 100% { filter: drop-shadow(0 0 12px rgba(255, 156, 64, .45)); opacity: .88; }
                50% { filter: drop-shadow(0 0 24px rgba(255, 204, 130, .8)); opacity: 1; }
          }

          @keyframes seasonalFlicker {
                0%, 7%, 12%, 18%, 26%, 44%, 52%, 66%, 74%, 82%, 100% { opacity: 1; }
                8% { opacity: .55; }
                10% { opacity: .9; }
                20% { opacity: .38; }
                22% { opacity: .92; }
                30% { opacity: .5; }
                32% { opacity: 1; }
                36% { opacity: .42; }
                38% { opacity: .86; }
                48% { opacity: .58; }
                58% { opacity: .95; }
                70% { opacity: .47; }
                72% { opacity: .88; }
                84% { opacity: .6; }
                88% { opacity: .94; }
          }

          @keyframes listenLivePulse {
                0%, 100% { transform: translateY(-1px) scale(1); box-shadow: 0 0 16px rgba(105, 200, 255, .6), 0 0 34px rgba(255, 76, 230, .35); }
                45% { transform: translateY(-3px) scale(1.04); box-shadow: 0 0 22px rgba(118, 210, 255, .75), 0 0 44px rgba(255, 210, 120, .55); }
          }

          @keyframes fairyLights {
                0% { background-position: 0 0; }
                100% { background-position: -120px 0; }
          }

          @keyframes logoSparkle {
                0%, 100% { filter: drop-shadow(0 0 18px rgba(255, 214, 140, .55)); }
                50% { filter: drop-shadow(0 0 28px rgba(255, 255, 210, .75)); }
          }

          @media (prefers-reduced-motion: reduce) {
                #seasonalLayer,
                #seasonalLayer::before,
                #seasonalLayer::after,
                .seasonal-layer .seasonal-particle,
                .seasonal-layer .seasonal-bubble,
                .seasonal-countdown,
                .seasonal-tagline {
                      animation: none !important;
                      transition-duration: 0.01ms !important;
                }

                body[data-seasonal-theme] .btn.btn-primary.neon {
                      animation: none !important;
                }
          }

          body[data-seasonal-theme="new-year"] #seasonalLayer::before {
                background:
                  radial-gradient(circle at 18% 24%, rgba(90, 220, 255, .4), transparent 62%),
                  radial-gradient(circle at 82% 20%, rgba(255, 210, 92, .35), transparent 65%),
                  linear-gradient(160deg, rgba(4, 9, 32, .95), rgba(10, 16, 45, .92));
          }

          body[data-seasonal-theme="new-year"] #seasonalLayer::after {
                background-image:
                  repeating-linear-gradient(135deg, rgba(0, 255, 247, .12) 0 16px, transparent 16px 32px),
                  repeating-linear-gradient(-135deg, rgba(255, 0, 170, .12) 0 18px, transparent 18px 36px);
                mix-blend-mode: screen;
                animation: seasonalGlowPulse 6s ease-in-out infinite;
                opacity: .45;
          }

          body[data-seasonal-theme="new-year"] .btn.btn-primary.neon {
                box-shadow: 0 0 16px rgba(105, 200, 255, .6), 0 0 34px rgba(255, 76, 230, .35);
                animation: listenLivePulse 1.7s ease-in-out infinite;
          }

          body[data-seasonal-theme="new-year"] .seasonal-countdown {
                background: color-mix(in oklab, #041132 78%, rgba(0, 0, 0, .35));
                border-color: rgba(102, 204, 255, .35);
                text-shadow: 0 0 12px rgba(98, 185, 255, .6);
          }

          body[data-seasonal-theme="new-year"] .neon {
                text-shadow:
                  0 0 18px rgba(94, 200, 255, .6),
                  0 0 42px rgba(255, 0, 204, .35);
          }

          body[data-seasonal-theme="waitangi"] #seasonalLayer::before {
                background:
                  radial-gradient(circle at 30% 80%, rgba(255, 255, 255, .08), transparent 62%),
                  linear-gradient(180deg, rgba(3, 12, 28, .94), rgba(2, 8, 20, .96));
          }

          body[data-seasonal-theme="waitangi"] #seasonalLayer::after {
                background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="400" height="400" viewBox="0 0 400 400" fill="none"><path d="M0 260c90-120 220-120 310 0-90 120-220 120-310 0Z" fill="url(%23grad)" opacity="0.32"/><defs><linearGradient id="grad" x1="0" y1="260" x2="310" y2="260" gradientUnits="userSpaceOnUse"><stop stop-color="%2302142d"/><stop offset="0.5" stop-color="%230b2a52"/><stop offset="1" stop-color="%23fffcfc" stop-opacity="0.22"/></linearGradient></defs></svg>');
                background-size: 520px;
                animation: waitangiWave 48s ease-in-out infinite alternate;
                opacity: .32;
          }

          @keyframes waitangiWave {
                0% { transform: translate3d(0, 0, 0); }
                50% { transform: translate3d(-24px, -18px, 0) scale(1.03); }
                100% { transform: translate3d(-58px, 12px, 0) scale(1); }
          }

          body[data-seasonal-theme="waitangi"] .header {
                background: color-mix(in oklab, rgba(2, 14, 32, .92) 72%, transparent);
          }

          body[data-seasonal-theme="valentines"] #seasonalLayer::before {
                background:
                  radial-gradient(circle at 24% 20%, rgba(255, 126, 197, .45), transparent 64%),
                  radial-gradient(circle at 80% 15%, rgba(166, 118, 255, .35), transparent 62%),
                  linear-gradient(160deg, rgba(24, 4, 32, .94), rgba(43, 6, 58, .92));
          }

          body[data-seasonal-theme="valentines"] #seasonalLayer::after {
                background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="200" height="200" viewBox="0 0 200 200" fill="none"><g opacity="0.35"><path d="M52 68c0-14 12-22 24-22 9 0 16 6 21 12 5-6 12-12 21-12 12 0 24 8 24 22 0 32-45 48-45 48S52 100 52 68Z" fill="url(%23a)"/></g><defs><linearGradient id="a" x1="51" y1="46" x2="121" y2="126" gradientUnits="userSpaceOnUse"><stop stop-color="%23ff7bc0"/><stop offset="1" stop-color="%23a179ff"/></linearGradient></defs></svg>');
                background-size: 240px;
                animation: valentineHearts 26s linear infinite;
          }

          body[data-seasonal-theme="valentines"] .btn {
                box-shadow: 0 0 12px rgba(255, 140, 220, .35);
          }

          body[data-seasonal-theme="valentines"] .btn:hover {
                filter: drop-shadow(0 0 16px rgba(255, 150, 230, .55));
          }

          body[data-seasonal-theme="valentines"] .seasonal-particle--sparkle {
                background: radial-gradient(circle, rgba(255, 188, 232, .9) 0%, rgba(255, 188, 232, 0) 70%);
          }

          body[data-seasonal-theme="easter"] #seasonalLayer::before {
                background:
                  radial-gradient(circle at 15% 85%, rgba(171, 232, 199, .45), transparent 60%),
                  radial-gradient(circle at 75% 18%, rgba(255, 229, 173, .42), transparent 60%),
                  linear-gradient(180deg, rgba(14, 21, 33, .92), rgba(20, 28, 39, .9));
          }

          body[data-seasonal-theme="easter"] #seasonalLayer::after {
                background-image:
                  radial-gradient(8px 12px at 30% 40%, rgba(246, 196, 255, .28), transparent 60%),
                  radial-gradient(6px 6px at 72% 70%, rgba(164, 224, 255, .32), transparent 60%),
                  radial-gradient(10px 10px at 50% 20%, rgba(255, 214, 153, .3), transparent 65%);
                animation: easterBubbles 32s linear infinite;
          }

          body[data-seasonal-theme="easter"] .btn:hover {
                transform: translateY(-3px) scale(1.05);
                animation: easterBounce .75s ease-in-out infinite alternate;
          }

          body[data-seasonal-theme="easter"] .seasonal-layer .seasonal-bubble {
                background: radial-gradient(circle, rgba(255, 255, 255, .65) 0%, rgba(255, 255, 255, 0) 70%);
          }

          body[data-seasonal-theme="anzac"] #seasonalLayer::before {
                background: linear-gradient(165deg, rgba(22, 22, 18, .95), rgba(28, 30, 22, .9));
          }

          body[data-seasonal-theme="anzac"] #seasonalLayer::after {
                background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="200" height="200" viewBox="0 0 200 200" fill="none"><g opacity="0.3"><path d="M130 0c40 70-20 90 40 170-70-20-90 40-170-40 70 20 90-40 170 40-40-70 20-90-40-170Z" fill="%23d44a57"/></g></svg>');
                background-size: 320px;
                animation: seasonalPetalsFall 32s linear infinite;
                opacity: .25;
          }

          body[data-seasonal-theme="anzac"] .logo {
                padding-right: 32px;
          }

          body[data-seasonal-theme="anzac"] .logo::after {
                content: "";
                position: absolute;
                right: -20px;
                width: 28px;
                height: 28px;
                border-radius: 50%;
                background: radial-gradient(circle, #f2505b 0%, #7e161f 70%, #31070b 85%);
                box-shadow: 0 0 14px rgba(163, 20, 31, .35);
          }

          body[data-seasonal-theme="anzac"] .header {
                animation: none;
                box-shadow: none;
                background: color-mix(in oklab, rgba(18, 18, 14, .92) 82%, transparent);
          }

          body[data-seasonal-theme="anzac"] .card:hover,
          body[data-seasonal-theme="anzac"] .card:focus-within,
          body[data-seasonal-theme="anzac"] .btn:hover {
                transform: none;
                box-shadow: var(--shadow);
          }

          body[data-seasonal-theme="matariki"] #seasonalLayer::before {
                background:
                  radial-gradient(circle at 22% 24%, rgba(120, 162, 255, .3), transparent 65%),
                  radial-gradient(circle at 70% 70%, rgba(255, 214, 144, .2), transparent 60%),
                  linear-gradient(180deg, rgba(5, 8, 22, .95), rgba(9, 14, 30, .92));
          }

          body[data-seasonal-theme="matariki"] #seasonalLayer::after {
                background-image:
                  radial-gradient(2px 2px at 12% 18%, rgba(255, 255, 255, .95), transparent 65%),
                  radial-gradient(1.5px 1.5px at 32% 58%, rgba(255, 225, 165, .9), transparent 60%),
                  radial-gradient(2px 2px at 68% 32%, rgba(255, 255, 255, .8), transparent 70%),
                  radial-gradient(1.5px 1.5px at 82% 68%, rgba(255, 220, 140, .85), transparent 65%);
                animation: seasonalTwinkle 7s ease-in-out infinite alternate;
                opacity: .65;
          }

          body[data-seasonal-theme="matariki"] .card:hover,
          body[data-seasonal-theme="matariki"] .btn:hover {
                box-shadow: 0 0 18px rgba(248, 220, 156, .45);
          }

          body[data-seasonal-theme="halloween"] #seasonalLayer::before {
                background:
                  radial-gradient(320px 320px at 22% 24%, rgba(126, 62, 255, .28), transparent 72%),
                  radial-gradient(320px 320px at 78% 16%, rgba(255, 210, 140, .32), transparent 70%),
                  radial-gradient(260px 260px at 72% 22%, rgba(255, 240, 190, .18), transparent 75%),
                  linear-gradient(180deg, rgba(18, 6, 30, .96), rgba(4, 2, 14, .94));
          }

          body[data-seasonal-theme="halloween"] #seasonalLayer::after {
                background-image:
                  radial-gradient(120px 120px at 18% 28%, rgba(114, 72, 255, .18), transparent 70%),
                  url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="360" height="240" viewBox="0 0 360 240" fill="none"><rect width="360" height="240" fill="url(%23grad-night)"/><defs><linearGradient id="grad-night" x1="180" y1="0" x2="180" y2="240" gradientUnits="userSpaceOnUse"><stop offset="0" stop-color="%23080b20" stop-opacity="0"/><stop offset="1" stop-color="%23080b20" stop-opacity="0.85"/></linearGradient><radialGradient id="moon" cx="0" cy="0" r="1" gradientTransform="matrix(0 -38 38 0 276 54)" gradientUnits="userSpaceOnUse"><stop stop-color="%23fff2d1"/><stop offset="1" stop-color="%23ffd27a" stop-opacity="0.2"/></radialGradient><linearGradient id="grad-ground" x1="0" y1="204" x2="0" y2="240" gradientUnits="userSpaceOnUse"><stop stop-color="%23140822" stop-opacity="0.92"/><stop offset="1" stop-color="%23090214" stop-opacity="0.96"/></linearGradient></defs><circle cx="276" cy="54" r="34" fill="url(%23moon)"/><g opacity="0.82" fill="%23ff8b2b"><path d="M92 204c-18-26 6-46 26-44 24 2 28 36 12 50-16 14-44 8-38-6Z"/><path d="M128 198c-6-10-6-22 6-26 18-6 28 10 28 22 0 16-20 26-34 18-10-6-10-10 0-14Z"/><path d="M54 210c-6-12 4-24 20-24 20 0 24 18 18 28-8 10-30 12-38 2Z"/></g><g fill="%23210c2a" opacity="0.9"><path d="M66 176c10-10 26-10 36 0-6 2-20 4-36 0Z"/><path d="M108 168c8-6 22-4 28 2-8 2-18 2-28-2Z"/><path d="M150 182c6-8 20-10 30-4-10 4-20 6-30 4Z"/></g><g fill="%230b0915" opacity="0.75"><path d="M210 118c-10-10 6-22 18-20 10 2 16 10 14 20-16-6-22-6-32 0Z"/><path d="M252 124c-8-12 8-26 22-22 10 2 14 10 12 20-12-4-20-4-34 2Z"/><path d="M192 94c-6-10 6-20 18-18 8 2 12 8 10 16-12-4-16-2-28 2Z"/></g><rect x="0" y="204" width="360" height="36" fill="url(%23grad-ground)"/></svg>');
                background-size: 280px, 420px;
                background-repeat: no-repeat;
                background-position: 20% 16%, center bottom;
                animation: halloweenFlight 36s linear infinite;
                opacity: .55;
          }

          body[data-seasonal-theme="halloween"] .seasonal-layer .halloween-bat {
                width: 72px;
                height: 28px;
                background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="72" height="28" viewBox="0 0 72 28" fill="none"><path fill="%23110b1d" d="M36 6c2-4 6-6 10-6 8 0 14 6 18 10-3-1-6 0-8 2 3 0 6 2 8 6-4-2-8-2-12 0-4 2-6 6-6 10-2-2-4-4-10-4s-8 2-10 4c0-4-2-8-6-10-4-2-8-2-12 0 2-4 5-6 8-6-2-2-5-3-8-2 4-4 10-10 18-10 4 0 8 2 10 6Z"/><circle cx="31" cy="10" r="1.6" fill="%23ffac33"/><circle cx="41" cy="10" r="1.6" fill="%23ffac33"/></svg>');
                background-size: contain;
                background-repeat: no-repeat;
                transform-origin: center;
                animation: halloweenBatGlide var(--h-duration, 24s) linear infinite;
                animation-delay: var(--h-delay, 0s);
                opacity: .9;
          }

          body[data-seasonal-theme="halloween"] .seasonal-layer .halloween-lantern {
                width: 44px;
                height: 48px;
                bottom: -10px;
                background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="44" height="48" viewBox="0 0 44 48" fill="none"><path d="M18 4c0-2 2-4 4-4s4 2 4 4" stroke="%23f6bf5b" stroke-width="2" stroke-linecap="round"/><path d="M22 8c-2-2-6-2-10 0s-6 6-6 12c0 14 8 20 16 20s16-6 16-20c0-6-2-10-6-12s-8-2-10 0Z" fill="url(%23pumpkin)"/><path d="M22 8c-2-2-6-2-10 0s-6 6-6 12c0 14 8 20 16 20s16-6 16-20c0-6-2-10-6-12s-8-2-10 0Z" stroke="%23a3481c" stroke-width="2" stroke-linejoin="round"/><path d="M16 18c0 2 2 4 6 4s6-2 6-4" stroke="%23a3481c" stroke-width="2" stroke-linecap="round"/><ellipse cx="16" cy="22" rx="4" ry="6" fill="%23ff9448" opacity="0.6"/><ellipse cx="28" cy="22" rx="4" ry="6" fill="%23ff9448" opacity="0.6"/><defs><radialGradient id="pumpkin" cx="0" cy="0" r="1" gradientTransform="matrix(0 28 -26 0 22 22)" gradientUnits="userSpaceOnUse"><stop stop-color="%23ffbd63"/><stop offset="1" stop-color="%23ff6d1f"/></radialGradient></defs></svg>');
                background-size: contain;
                background-repeat: no-repeat;
                transform-origin: center bottom;
                animation:
                  halloweenLanternFloat var(--lantern-duration, 7s) ease-in-out infinite,
                  halloweenLanternGlow var(--lantern-glow-duration, 4.5s) ease-in-out infinite;
                animation-delay: var(--lantern-delay, 0s);
          }

          body[data-seasonal-theme="halloween"] .header {
                box-shadow: 0 0 18px rgba(255, 128, 0, .35);
                animation: seasonalFlicker 5.4s linear infinite;
          }

          body[data-seasonal-theme="halloween"] .card:hover {
                transform: rotate(-1.4deg) translateY(-6px) scale(1.02);
                box-shadow: var(--shadow), 0 26px 44px rgba(255, 120, 0, .22);
          }

          body[data-seasonal-theme="halloween"] .btn.btn-primary {
                box-shadow: 0 0 18px rgba(255, 128, 0, .35);
          }

          body[data-seasonal-theme="labour-weekend"] #seasonalLayer::before {
                background:
                  radial-gradient(circle at 25% 80%, rgba(0, 161, 197, .35), transparent 65%),
                  radial-gradient(circle at 75% 20%, rgba(255, 188, 140, .25), transparent 60%),
                  linear-gradient(180deg, rgba(4, 28, 36, .94), rgba(12, 48, 58, .9));
          }

          body[data-seasonal-theme="labour-weekend"] #seasonalLayer::after {
                background-image:
                  linear-gradient(180deg, rgba(255, 224, 168, .16), rgba(0, 0, 0, 0)),
                  url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="200" height="200" viewBox="0 0 200 200" fill="none"><path d="M40 150c35-35 70-35 105 0" stroke="%23f6d9a8" stroke-width="6" stroke-linecap="round"/><path d="m70 70 26 46" stroke="%23ff9a82" stroke-width="10" stroke-linecap="round"/><path d="m122 90-30 52" stroke="%238be1f6" stroke-width="8" stroke-linecap="round"/></svg>');
                background-size: 100% 120%, 360px;
                background-repeat: repeat, no-repeat;
                background-position: 0 100%, 80% 90%;
                animation: labourWave 28s ease-in-out infinite alternate;
          }

          @keyframes labourWave {
                0% { transform: translate3d(0, 0, 0); }
                100% { transform: translate3d(-30px, -20px, 0); }
          }

          body[data-seasonal-theme="labour-weekend"] .btn.btn-primary {
                box-shadow: 0 0 16px rgba(139, 225, 246, .35);
          }

          body[data-seasonal-theme="christmas"] #seasonalLayer::before {
                background:
                  radial-gradient(circle at 20% 30%, rgba(240, 70, 90, .28), transparent 70%),
                  radial-gradient(circle at 80% 20%, rgba(255, 212, 128, .3), transparent 60%),
                  linear-gradient(180deg, rgba(8, 28, 34, .95), rgba(10, 38, 46, .9));
          }

          body[data-seasonal-theme="christmas"] #seasonalLayer::after {
                background-image:
                  radial-gradient(2px 2px at 10% 30%, rgba(255, 255, 255, .9), transparent 70%),
                  radial-gradient(3px 3px at 60% 70%, rgba(214, 240, 255, .85), transparent 70%),
                  radial-gradient(1.5px 1.5px at 85% 40%, rgba(255, 255, 255, .6), transparent 65%);
                animation: christmasSparkle 20s linear infinite;
                opacity: .55;
          }

          body[data-seasonal-theme="christmas"] nav::after {
                content: "";
                position: absolute;
                left: 6%;
                right: 6%;
                bottom: -6px;
                height: 16px;
                background-image: radial-gradient(circle at 8% 50%, rgba(255, 214, 102, .9) 0%, rgba(255, 214, 102, 0) 60%), radial-gradient(circle at 28% 50%, rgba(255, 116, 116, .9) 0%, rgba(255, 116, 116, 0) 60%), radial-gradient(circle at 48% 50%, rgba(128, 216, 255, .9) 0%, rgba(128, 216, 255, 0) 60%), radial-gradient(circle at 68% 50%, rgba(255, 214, 102, .9) 0%, rgba(255, 214, 102, 0) 60%), radial-gradient(circle at 88% 50%, rgba(255, 116, 116, .9) 0%, rgba(255, 116, 116, 0) 60%);
                background-size: 120px 16px;
                background-repeat: repeat-x;
                animation: fairyLights 2.4s linear infinite;
                pointer-events: none;
                filter: drop-shadow(0 0 8px rgba(255, 220, 150, .6));
          }

          body[data-seasonal-theme="christmas"] .logo-img {
                filter: drop-shadow(0 0 18px rgba(255, 214, 140, .55));
                animation: logoSparkle 6s ease-in-out infinite;
          }

          body[data-seasonal-theme="boxing-bridge"] #seasonalLayer::before {
                background:
                  radial-gradient(circle at 22% 18%, rgba(255, 128, 150, .35), transparent 65%),
                  radial-gradient(circle at 82% 22%, rgba(120, 210, 255, .3), transparent 60%),
                  linear-gradient(180deg, rgba(8, 18, 36, .95), rgba(12, 28, 48, .92));
          }

          body[data-seasonal-theme="boxing-bridge"] #seasonalLayer::after {
                background-image:
                  radial-gradient(2px 6px at 20% 20%, rgba(255, 214, 160, .35), transparent 60%),
                  radial-gradient(2px 4px at 60% 60%, rgba(125, 220, 255, .3), transparent 60%),
                  radial-gradient(2px 5px at 80% 40%, rgba(255, 140, 173, .28), transparent 65%);
                animation: bridgeConfetti 28s linear infinite;
                opacity: .45;
          }

          @keyframes bridgeConfetti {
                0% { transform: translate3d(0, 0, 0); }
                100% { transform: translate3d(-20px, 60px, 0); }
          }

          body[data-seasonal-theme="boxing-bridge"] .btn.btn-primary {
                box-shadow: 0 0 18px rgba(255, 199, 140, .35);
          }
	</style>
</head>
<body>
  <a class="skip" href="#main">Skip to content</a>
  <header class="header" role="banner">
    <div class="container row">
      <div class="row" style="gap:12px; align-items:center;">
        <button class="icon-btn menu-toggle" aria-label="Toggle menu" aria-expanded="false">
          <svg viewBox="0 0 24 24" fill="currentColor" aria-hidden="true"><path d="M3 6h18v2H3V6Zm0 5h18v2H3v-2Zm0 5h18v2H3v-2Z"/></svg>
        </button>
        <a class="logo" href="#" aria-label="Amped AI home">
          <img class="logo-img" src="logo.png" alt="Amped AI" />
        </a>
      </div>
      <nav id="site-nav" aria-label="Primary">
        <ul>
          <li><a href="#shows">Shows</a></li>
          <li><a href="#schedule">Schedule</a></li>
          <li><a href="#listen">Listen</a></li>
          <li><a href="#about">About</a></li>
        </ul>
      </nav>
      <div class="header-actions">
        <button id="themeBtn" class="icon-btn" aria-label="Toggle theme" title="Toggle light/dark">
          <svg id="themeIcon" viewBox="0 0 24 24" fill="currentColor" aria-hidden><path fill-rule="evenodd" clip-rule="evenodd" d="M12 3a1 1 0 0 1 1 1v2a1 1 0 1 1-2 0V4a1 1 0 0 1 1-1Zm7 9a7 7 0 1 1-7-7 5 5 0 0 0 0 10 7 7 0 0 1 7-3Z"/></svg>
        </button>
        <a class="btn btn-primary neon" href="#listen">Listen Live</a>
      </div>
    </div>
  </header>

  <main id="main">
    <section class="hero" id="listen">
      <div id="seasonalLayer" class="seasonal-layer" aria-hidden="true"></div>
      <div id="seasonalCountdown" class="seasonal-countdown" role="status" aria-live="polite" hidden></div>
      <div class="container">
        <div class="wrap">
          <div>
            <div class="eyebrow">
              <span class="chip"><span class="live-dot" aria-hidden></span> Live 24/7</span>
              <span class="neon">100% AI Radio</span>
            </div>

            <h1><span>Amped AI</span> — Always on. Always different.</h1>

            <p>
              A new kind of station: AI-generated music, shows, and voices.
              Streaming non-stop with real programming, real hosts, and zero humans behind the mic.
            </p>

            <div id="seasonalTagline" class="seasonal-tagline" hidden></div>

            <div class="cta">
              <div class="player-controls" role="group" aria-label="Player controls">
                <button id="playBtn" class="btn btn-primary" aria-pressed="false">
                  <svg id="playIcon" viewBox="0 0 24 24" fill="currentColor" width="18" height="18" aria-hidden>
                    <path d="m8 5 12 7-12 7V5Z"/>
                  </svg>
                  <span>Play Stream</span>
                </button>
                <button id="carModeToggle" class="btn btn-ghost" type="button" aria-pressed="false" aria-label="Enable car mode" title="Enable car mode">
                  <svg viewBox="0 0 24 24" fill="currentColor" aria-hidden>
                    <path d="M5.2 11.3 6.4 7.8A2 2 0 0 1 8.3 6.5h7.4a2 2 0 0 1 1.9 1.3l1.3 3.5A3 3 0 0 1 22 14v3a1 1 0 0 1-1 1h-1.1a2 2 0 0 1-3.8 0H7.9a2 2 0 0 1-3.8 0H3a1 1 0 0 1-1-1v-3a3 3 0 0 1 3.2-2.7ZM6.6 11h10.8l-.9-2.7a1 1 0 0 0-1-.7H8.5a1 1 0 0 0-1 .7L6.6 11ZM6.5 17a1 1 0 1 0 0-.01V17Zm11 0a1 1 0 1 0 0-.01V17Z"/>
                  </svg>
                  <span>Car Mode</span>
                </button>
                <span id="carModeHint" class="sr-only">Car mode enlarges the player controls, hides secondary content for easier in-car use, and may immediately resume playback when enabled.</span>
              </div>
              <a class="btn btn-ghost" href="#schedule">View Schedule</a>
              <a class="btn btn-ghost" href="#recent">Recently Played</a>
            </div>
          </div>

          <aside class="promo-card" aria-label="Now playing">
            <img id="hostAccent" class="promo-accent" alt="" aria-hidden="true" hidden>
            <div class="now">
              <div class="art">
                <img id="artImg" alt="Album art" src="">
                <span id="artFallback">AMP</span>
              </div>
              <div class="track" aria-live="polite" aria-atomic="true">
                <h3 id="trackTitle">Track Title</h3>
                <p id="trackMeta">Artist • with <strong id="trackHost">Host</strong></p>
                <div class="progress" aria-label="Progress">
                  <div class="bar" id="progressBar" style="width:0%"></div>
                </div>
              </div>
              <div>
                <span class="chip" title="Live">
                  <span class="live-dot" aria-hidden></span>
                  <span id="liveLabel">Live</span>
                </span>
              </div>
            </div>
            <div class="player-volume" role="group" aria-label="Volume controls">
              <label for="volumeControl">Volume</label>
              <div class="player-volume-controls">
                <input id="volumeControl" name="volume" type="range" min="0" max="100" step="1" value="100" aria-valuemin="0" aria-valuemax="100" />
                <button type="button" id="muteBtn" class="icon-btn" aria-pressed="false" aria-label="Mute audio" title="Mute audio">
                  <svg id="muteIcon" viewBox="0 0 24 24" fill="currentColor" aria-hidden>
                    <path d="M4 9v6h4l5 5V4L8 9H4Z"/>
                    <path d="M16 12a4 4 0 0 0-2.3-3.6l.8-1.8A6 6 0 0 1 18 12a6 6 0 0 1-3.5 5.4l-.8-1.8A4 4 0 0 0 16 12Z"/>
                  </svg>
                  <span id="muteText" class="sr-only">Mute audio</span>
                </button>
              </div>
            </div>
            <audio id="player" preload="none" crossorigin="anonymous"></audio>
          </aside>
          <div id="carModeUpNext" class="car-mode-up-next" aria-live="polite" hidden aria-hidden="true">
            <div class="car-mode-section">
              <span class="chip car-mode-chip">On Air</span>
              <h2 id="carModeCurrentTitle" data-fallback="show-loading"></h2>
              <p id="carModeCurrentTime" class="car-mode-time" data-fallback="show-time"></p>
            </div>
            <div class="car-mode-section">
              <span class="chip car-mode-chip">Up Next</span>
              <h3 id="carModeNextTitle" data-fallback="show-loading"></h3>
              <p id="carModeNextTime" class="car-mode-time" data-fallback="show-time"></p>
              <p id="carModeNextCountdown" class="car-mode-countdown" hidden>Starts soon</p>
            </div>
          </div>
          <div class="card up-next-card" id="upNextCard" aria-live="polite">
            <div class="body">
              <div class="current-show" id="currentShow" aria-live="polite">
                <span class="chip up-next-chip current-show-badge">On Air</span>
                <div class="current-show-text">
                  <h3 class="current-show-title" id="currentShowTitle" data-fallback="show-loading"></h3>
                  <span class="current-show-time" id="currentShowTime" data-fallback="show-time"></span>
                </div>
              </div>
              <div class="up-next-head">
                <span class="chip">Up Next</span>
                <span class="meta" id="upNextTzLabel"></span>
              </div>
              <ol id="upNextList" class="up-next-list">
                <li class="meta">Loading schedule…</li>
              </ol>
            </div>
          </div>
        </div>
      </div>
    </section>

    <section id="shows">
      <div class="container">
        <h2 class="neon">Featured Shows</h2>
        <div class="grid" id="showsGrid" aria-live="polite"></div>
      </div>
    </section>

    <section id="schedule">
      <div class="container">
        <h2 class="neon">Schedule</h2>
        <div class="tabs" role="tablist">
          <button class="tab" role="tab" aria-controls="weekdayPanel" aria-selected="true" id="weekdayTab">Weekdays</button>
          <button class="tab" role="tab" aria-controls="weekendPanel" aria-selected="false" id="weekendTab">Weekend</button>
        </div>
        <div id="weekdayPanel" role="tabpanel" aria-labelledby="weekdayTab"></div>
        <div id="weekendPanel" role="tabpanel" aria-labelledby="weekendTab" hidden></div>
      </div>
    </section>

    <section id="recent">
      <div class="container">
        <h2 class="neon">Recently Played</h2>
        <div class="card"><div class="body">
          <ul id="recentList" style="list-style:none;padding:0;margin:0;display:grid;gap:10px"></ul>
        </div></div>
      </div>
    </section>

    <section id="about">
      <div class="container">
        <h2 class="neon">About Amped AI</h2>
        <div class="grid" style="align-items:center">

          <!-- Group photo -->
          <div class="col-6">
            <div class="card">
              <div class="media" style="aspect-ratio:3/2; overflow:hidden; background:var(--surface-2);">
                <img src="GroupPhoto.jpg" alt="Amped AI on-air hosts" width="1200" height="800" loading="lazy" style="width:100%; height:100%; object-fit:cover;">
              </div>
            </div>
          </div>

          <!-- Station Info -->
          <div class="col-6">
            <div class="card">
              <div class="body">
                <p>
                  Amped AI is a fully automated radio station running around the clock.
                  Shows are written by large language models, voiced using advanced text-to-speech,
                  and scheduled with AzuraCast. Every track played is AI-generated music, making the
                  station a complete end-to-end experiment in machine-driven broadcasting.
                </p>
                <p>
                  The goal is simple: see how close AI can get to creating the energy and flow of
                  traditional radio, while opening the door to new kinds of programming that wouldn’t
                  be possible with a fixed human schedule.
                </p>
                <div style="display:flex; gap:8px; flex-wrap:wrap; margin-top:6px;">
                  <span class="chip">Live 24/7</span>
                  <span class="chip">Powered by AzuraCast</span>
                  <span class="chip">AI Hosts</span>
                  <span class="chip">100% AI Music</span>
                </div>
              </div>
            </div>
          </div>

        </div>
      </div>
    </section>

    <section id="ethics" style="margin-top:4rem;">
      <div class="container">
        <div class="card">
          <div class="body" style="text-align:center;">
            <h3 class="neon">Ethics & Transparency</h3>
            <p style="max-width:720px; margin:0 auto;">
              Amped AI is an experiment — a side project, not a full-time job for anyone involved.
              If people enjoy it, great; if not, that’s fine too. The goal isn’t to replace radio DJs or take work away.
              Every show you hear is fully generated using a mix of large language models and ElevenLabs text-to-speech,
              with light human curation to keep things sensible and safe.
            </p>
            <br>
          </div>
        </div>
      </div>
    </section>

    <div id="miniPlayer" class="mini-player" hidden aria-hidden="true">
      <div class="mini-player__inner">
        <button id="miniPlayBtn" class="btn btn-primary mini-player__play" aria-pressed="false">
          <svg id="miniPlayIcon" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true"></svg>
          <span id="miniPlayLabel">Play Stream</span>
        </button>
        <div class="mini-player__meta" aria-live="polite" aria-atomic="true">
          <p id="miniTrackTitle" class="mini-player__title">Track Title</p>
          <p id="miniTrackMeta" class="mini-player__details">Artist • with Host</p>
        </div>
        <div class="mini-player__status">
          <span id="miniLiveChip" class="chip mini-player__chip" hidden>
            <span class="live-dot" aria-hidden="true"></span>
            <span id="miniLiveLabel">Live</span>
          </span>
        </div>
      </div>
      <div class="mini-player__controls" role="group" aria-label="Mini player controls">
        <button type="button" id="miniMuteBtn" class="icon-btn" aria-pressed="false" aria-label="Mute audio" title="Mute audio">
          <svg id="miniMuteIcon" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true"></svg>
          <span id="miniMuteText" class="sr-only">Mute audio</span>
        </button>
        <label class="sr-only" for="miniVolumeControl">Volume</label>
        <input id="miniVolumeControl" name="miniVolume" type="range" min="0" max="100" step="1" value="100" aria-valuemin="0" aria-valuemax="100" aria-valuenow="100" aria-valuetext="100% volume" />
      </div>
    </div>

  </main>

  <footer>
    <div class="container footer-grid">
      <div class="footer-brand">
        <img src="AmpedMediaLogo.png" alt="Amped Media logo" class="footer-logo" width="220" height="80" loading="lazy">
        <span>© <span id="year"></span> Amped Media a TGNZ Networks Project • <button id="footerVersionToggle" class="footer-easter-trigger" type="button" aria-expanded="false" aria-controls="footerSecretNote">V0.4</button></span>
        <p id="footerSecretNote" class="footer-easter-note" hidden aria-hidden="true">🎛️ Midnight maintenance note: the console favours deliberate operators when the station is quiet.</p>
      </div>
      <div class="socials" aria-label="Social links">
        <a class="icon-btn" href="#" aria-label="X / Twitter"><svg viewBox="0 0 24 24" fill="currentColor"><path d="M3 3h3l6.5 8.2L18.5 3H21l-7.4 9.5L21 21h-3l-6.8-8.6L6 21H3l8-10.3L3 3Z"/></svg></a>
        <a class="icon-btn" href="#" aria-label="YouTube"><svg viewBox="0 0 24 24" fill="currentColor"><path d="M23 12s0-3.3-.4-4.9c-.2-.9-.9-1.6-1.8-1.8C18.9 4.8 12 4.8 12 4.8s-6.9 0-8.8.5c-.9.2-1.6.9-1.8 1.8C1 8.7 1 12 1 12s0 3.3.4 4.9c.2.9.9 1.6 1.8 1.8 1.9.5 8.8.5 8.8.5s6.9 0 8.8-.5c.9-.2 1.6-.9 1.8-1.8.4-1.6.4-4.9.4-4.9Zm-13 3.3V8.7l5.8 3.3-5.8 3.3Z"/></svg></a>
        <a class="icon-btn" href="#" aria-label="Instagram"><svg viewBox="0 0 24 24" fill="currentColor"><path d="M7 2h10a5 5 0 0 1 5 5v10a5 5 0 0 1-5 5H7a5 5 0 0 1-5-5V7a5 5 0 0 1 5-5Zm0 2a3 3 0 0 0-3 3v10a3 3 0 0 0 3 3h10a3 3 0 0 0 3-3V7a3 3 0 0 0-3-3H7Zm11 2a1 1 0 1 1 0 2 1 1 0 0 1 0-2ZM12 7a5 5 0 1 1-.001 10.001A5 5 0 0 1 12 7Zm0 2a3 3 0 1 0 0 6 3 3 0 0 0 0-6Z"/></svg></a>
      </div>
      <div class="footer-legal">
        <p>All music and audio content broadcast or produced by Amped AI is generated using artificial intelligence. Any resemblance or similarity between Amped AI–generated works and existing songs, melodies, lyrics, band names, or artist identities—whether real or fictional—is entirely coincidental and unintentional.</p>
        <p>All songs, voices, and performances are created autonomously by artificial intelligence systems without direct human composition or performance. Any names, titles, or creative elements used are original to the AI generation process and are not associated with or endorsed by any existing artists, record labels, or rights holders.</p>
        <p>All voices, lyrics, and performances heard on Amped AI are synthetic and do not represent real individuals unless explicitly stated.</p>
        <p>Reproduction, redistribution, or commercial use of Amped AI–generated material without prior written permission is strictly prohibited.</p>
      </div>
    </div>
  </footer>

<script>
/* =========================================================================
   Amped AI — Frontend Script
   ======================================================================= */

/* ----------------------------- CONFIG ---------------------------------- */
const CONFIG = {
  streamURL: "https://amped-ai1.azuracast.tgnz.net/listen/amped_ai/radio.mp3",
  apiBase:   "https://amped-ai1.azuracast.tgnz.net/api",
  station:   "amped_ai",
  stationId: 1,
  timeZone:  "Pacific/Auckland",
  liveLabel: "Live"
};

const STATION_TZ = CONFIG.timeZone;

/* ----------------------------- SEASONAL THEMES ----------------------------- */
const MS_IN_MINUTE = 60 * 1000;
const MS_IN_HOUR   = 60 * MS_IN_MINUTE;
const MS_IN_DAY    = 24 * MS_IN_HOUR;

const getLocalDateParts = (date, tz) => {
  const formatter = new Intl.DateTimeFormat('en-CA', {
    timeZone: tz,
    year: 'numeric',
    month: '2-digit',
    day: '2-digit'
  });

  const parts = { year: date.getUTCFullYear(), month: date.getUTCMonth() + 1, day: date.getUTCDate() };
  for (const part of formatter.formatToParts(date)) {
    if (part.type === 'year')  parts.year  = Number(part.value);
    if (part.type === 'month') parts.month = Number(part.value);
    if (part.type === 'day')   parts.day   = Number(part.value);
  }
  return parts;
};

const getDateValue = (year, month, day) => Date.UTC(year, month - 1, day);

const getLocalDateValue = (date, tz) => {
  const parts = getLocalDateParts(date, tz);
  return getDateValue(parts.year, parts.month, parts.day);
};

const makeZonedDate = (year, month, day, hour = 0, minute = 0, tz = 'UTC') => {
  const base = Date.UTC(year, month - 1, day, hour, minute);
  const formatter = new Intl.DateTimeFormat('en-US', {
    timeZone: tz,
    timeZoneName: 'shortOffset',
    year: 'numeric',
    month: '2-digit',
    day: '2-digit',
    hour: '2-digit',
    minute: '2-digit',
    hour12: false
  });

  const parts = formatter.formatToParts(new Date(base));
  const tzPart = parts.find((p) => p.type === 'timeZoneName')?.value || 'GMT+0';
  const match = tzPart.match(/GMT([+-])(\d{1,2})(?::(\d{2}))?/);

  let offsetMinutes = 0;
  if (match) {
    const sign = match[1] === '-' ? -1 : 1;
    const hours = Number(match[2] || 0);
    const minutes = Number(match[3] || 0);
    offsetMinutes = sign * (hours * 60 + minutes);
  }

  return new Date(base - offsetMinutes * MS_IN_MINUTE);
};

const calcEasterSunday = (year) => {
  const a = year % 19;
  const b = Math.floor(year / 100);
  const c = year % 100;
  const d = Math.floor(b / 4);
  const e = b % 4;
  const f = Math.floor((b + 8) / 25);
  const g = Math.floor((b - f + 1) / 3);
  const h = (19 * a + b - d - g + 15) % 30;
  const i = Math.floor(c / 4);
  const k = c % 4;
  const l = (32 + 2 * e + 2 * i - h - k) % 7;
  const m = Math.floor((a + 11 * h + 22 * l) / 451);
  const month = Math.floor((h + l - 7 * m + 114) / 31);
  const day = ((h + l - 7 * m + 114) % 31) + 1;
  return { month, day };
};

const MATARIKI_DATES = {
  2023: { month: 7, day: 14 },
  2024: { month: 6, day: 28 },
  2025: { month: 6, day: 20 },
  2026: { month: 7, day: 10 },
  2027: { month: 6, day: 25 },
  2028: { month: 7, day: 14 },
  2029: { month: 7, day: 6 },
  2030: { month: 6, day: 28 }
};

const getLastWeekdayOfMonth = (year, monthIndex, weekday) => {
  const date = new Date(Date.UTC(year, monthIndex + 1, 0));
  const diff = (date.getUTCDay() - weekday + 7) % 7;
  date.setUTCDate(date.getUTCDate() - diff);
  return { year: date.getUTCFullYear(), month: date.getUTCMonth() + 1, day: date.getUTCDate() };
};

const msUntilNextMidnight = (date, tz) => {
  const parts = getLocalDateParts(date, tz);
  const next = makeZonedDate(parts.year, parts.month, parts.day + 1, 0, 1, tz);
  return Math.max(0, next.getTime() - date.getTime());
};

const SEASONAL_THEMES = [
  {
    slug: 'new-year',
    label: "New Year’s Celebration",
    priority: 120,
    getRanges: ({ year }) => [
      { start: getDateValue(year - 1, 12, 30), end: getDateValue(year, 1, 5), data: { targetYear: year } },
      { start: getDateValue(year, 12, 30), end: getDateValue(year + 1, 1, 5), data: { targetYear: year + 1 } }
    ],
    vars: {
      '--brand-h': '285',
      '--brand-s': '100%',
      '--brand-l': '62%',
      '--bg': '#030816',
      '--surface': '#07102a',
      '--surface-2': '#0c1840',
      '--text': '#f4f7ff',
      '--muted': '#9cc6ff',
      '--border': '#1c2f59',
      '--focus-ring': 'hsl(285 88% 72%)',
      '--layer-card-bg': 'linear-gradient(145deg, rgba(12, 22, 52, 0.92), rgba(6, 14, 32, 0.88))',
      '--layer-card-overlay': 'radial-gradient(110% 110% at 26% 18%, rgba(117, 196, 255, .4), transparent 68%)',
      '--layer-border': 'rgba(70, 120, 196, .28)',
      '--layer-hover-bg': 'color-mix(in oklab, #0d1738 82%, transparent)',
      '--layer-glass': 'color-mix(in oklab, #0d1738 80%, transparent)',
      '--promo-texture': 'radial-gradient(circle at 20% 15%, rgba(76, 201, 255, 0.28), transparent 65%)'
    },
    setup: ({ layer, countdownEl, tz, theme }) => {
      const reduce = matchMedia('(prefers-reduced-motion: reduce)').matches;
      let timer = null;

      if (layer && !reduce) {
        const colors = ['#67a9ff', '#ff6bda', '#ffd166', '#8ab6ff'];
        const total = 36;
        const frag = document.createDocumentFragment();
        for (let i = 0; i < total; i += 1) {
          const piece = document.createElement('span');
          piece.className = 'seasonal-particle seasonal-particle--confetti';
          piece.style.left = `${Math.random() * 100}%`;
          piece.style.animationDuration = `${6 + Math.random() * 4}s`;
          piece.style.animationDelay = `${Math.random() * -7}s`;
          piece.style.setProperty('--confetti-drift', `${(Math.random() * 60 - 30).toFixed(2)}px`);
          piece.style.setProperty('--confetti-color', colors[i % colors.length]);
          frag.appendChild(piece);
        }
        layer.appendChild(frag);
      }

      if (countdownEl) {
        const nowParts = getLocalDateParts(new Date(), tz);
        const targetYear = theme?.data?.targetYear || (nowParts.month >= 7 ? nowParts.year + 1 : nowParts.year);
        const target = makeZonedDate(targetYear, 1, 1, 0, 0, tz);

        const updateCountdown = () => {
          const diff = target.getTime() - Date.now();
          if (diff <= 0) {
            countdownEl.hidden = true;
            countdownEl.textContent = '';
            clearInterval(timer);
            timer = null;
            return;
          }

          const totalSeconds = Math.floor(diff / 1000);
          const hours = Math.floor(totalSeconds / 3600);
          const minutes = Math.floor((totalSeconds % 3600) / 60);
          const seconds = totalSeconds % 60;
          countdownEl.hidden = false;
          countdownEl.textContent = `NYE Countdown ${String(hours).padStart(2, '0')}:${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;
        };

        updateCountdown();
        timer = setInterval(updateCountdown, 1000);
      }

      return () => {
        if (layer) layer.innerHTML = '';
        if (timer) clearInterval(timer);
        if (countdownEl) {
          countdownEl.hidden = true;
          countdownEl.textContent = '';
        }
      };
    }
  },
  {
    slug: 'waitangi',
    label: 'Waitangi Day',
    priority: 30,
    getRanges: ({ year }) => [
      { start: getDateValue(year, 2, 3), end: getDateValue(year, 2, 8) }
    ],
    vars: {
      '--brand-h': '210',
      '--brand-s': '88%',
      '--brand-l': '52%',
      '--bg': '#050b1c',
      '--surface': '#081226',
      '--surface-2': '#0c1a32',
      '--text': '#f0f5ff',
      '--muted': '#b0c6e2',
      '--border': '#163052',
      '--focus-ring': 'hsl(210 90% 68%)',
      '--layer-card-bg': 'linear-gradient(150deg, rgba(10, 22, 44, 0.9), rgba(5, 12, 28, 0.9))',
      '--layer-card-overlay': 'radial-gradient(120% 120% at 16% 14%, rgba(255,255,255,.12), transparent 70%)',
      '--promo-texture': 'radial-gradient(circle at 28% 72%, rgba(255,255,255,.08), transparent 65%)'
    }
  },
  {
    slug: 'valentines',
    label: 'Valentine’s Day',
    priority: 35,
    getRanges: ({ year }) => [
      { start: getDateValue(year, 2, 12), end: getDateValue(year, 2, 15) }
    ],
    vars: {
      '--brand-h': '315',
      '--brand-s': '96%',
      '--brand-l': '64%',
      '--bg': '#1a0524',
      '--surface': '#250a34',
      '--surface-2': '#301046',
      '--text': '#ffeefd',
      '--muted': '#f1b7f0',
      '--border': '#3c1b54',
      '--focus-ring': 'hsl(315 88% 72%)',
      '--layer-card-bg': 'linear-gradient(150deg, rgba(40, 8, 60, 0.94), rgba(26, 5, 40, 0.9))',
      '--layer-card-overlay': 'radial-gradient(120% 120% at 26% 18%, rgba(255, 145, 214, .4), transparent 70%)',
      '--layer-border': 'rgba(255, 123, 220, .25)',
      '--promo-texture': 'radial-gradient(circle at 24% 24%, rgba(255, 140, 214, .28), transparent 70%)'
    },
    setup: ({ layer }) => {
      if (!layer) return () => {};
      const reduce = matchMedia('(prefers-reduced-motion: reduce)').matches;
      if (reduce) return () => {};

      let lastSpawn = 0;
      const spawnSparkle = (event) => {
        const now = performance.now();
        if (now - lastSpawn < 40) return;
        lastSpawn = now;
        const rect = layer.getBoundingClientRect();
        if (event.clientX < rect.left || event.clientX > rect.right || event.clientY < rect.top || event.clientY > rect.bottom) {
          return;
        }
        const sparkle = document.createElement('span');
        sparkle.className = 'seasonal-particle seasonal-particle--sparkle';
        sparkle.style.left = `${event.clientX - rect.left}px`;
        sparkle.style.top = `${event.clientY - rect.top}px`;
        layer.appendChild(sparkle);
        setTimeout(() => sparkle.remove(), 650);
      };

      document.addEventListener('pointermove', spawnSparkle);
      return () => {
        document.removeEventListener('pointermove', spawnSparkle);
        layer.innerHTML = '';
      };
    }
  },
  {
    slug: 'easter',
    label: 'Easter Weekend',
    priority: 45,
    getRanges: ({ year }) => {
      const easter = calcEasterSunday(year);
      const easterValue = getDateValue(year, easter.month, easter.day);
      return [
        { start: easterValue - 2 * MS_IN_DAY, end: easterValue + MS_IN_DAY }
      ];
    },
    vars: {
      '--brand-h': '140',
      '--brand-s': '60%',
      '--brand-l': '58%',
      '--bg': '#101826',
      '--surface': '#162032',
      '--surface-2': '#1e2c3f',
      '--text': '#f7fbff',
      '--muted': '#c8e4de',
      '--border': '#2f455c',
      '--focus-ring': 'hsl(140 68% 68%)',
      '--layer-card-bg': 'linear-gradient(160deg, rgba(24, 36, 54, 0.92), rgba(18, 30, 48, 0.9))',
      '--layer-card-overlay': 'radial-gradient(120% 120% at 28% 18%, rgba(180, 232, 210, .35), transparent 72%)',
      '--promo-texture': 'radial-gradient(circle at 32% 22%, rgba(196, 246, 255, .2), transparent 68%)'
    }
  },
  {
    slug: 'anzac',
    label: 'ANZAC Day',
    priority: 50,
    getRanges: ({ year }) => [
      { start: getDateValue(year, 4, 22), end: getDateValue(year, 4, 26) }
    ],
    vars: {
      '--brand-h': '2',
      '--brand-s': '72%',
      '--brand-l': '45%',
      '--bg': '#11120f',
      '--surface': '#1a1c16',
      '--surface-2': '#23241d',
      '--text': '#f5f2eb',
      '--muted': '#cabfa5',
      '--border': '#3a3b30',
      '--focus-ring': 'hsl(2 70% 48%)',
      '--layer-card-bg': 'linear-gradient(150deg, rgba(32, 33, 27, 0.92), rgba(22, 22, 18, 0.9))',
      '--layer-card-overlay': 'radial-gradient(120% 120% at 22% 16%, rgba(178, 42, 54, .32), transparent 70%)',
      '--promo-texture': 'radial-gradient(circle at 80% 20%, rgba(178, 42, 54, .18), transparent 70%)'
    }
  },
  {
    slug: 'matariki',
    label: 'Matariki',
    priority: 60,
    tagline: 'Ngā whetū o Matariki shine bright tonight',
    getRanges: ({ year }) => {
      const ranges = [];
      const addRange = (y) => {
        const info = MATARIKI_DATES[y];
        if (!info) return;
        const center = getDateValue(y, info.month, info.day);
        ranges.push({
          start: center - 3 * MS_IN_DAY,
          end: center + 3 * MS_IN_DAY,
          data: { anchorYear: y, anchorMonth: info.month, anchorDay: info.day }
        });
      };
      addRange(year);
      addRange(year - 1);
      addRange(year + 1);
      return ranges;
    },
    vars: {
      '--brand-h': '220',
      '--brand-s': '75%',
      '--brand-l': '58%',
      '--bg': '#06091a',
      '--surface': '#0b1028',
      '--surface-2': '#11183a',
      '--text': '#f4f7ff',
      '--muted': '#c6d2f5',
      '--border': '#202b5b',
      '--focus-ring': 'hsl(220 82% 66%)',
      '--layer-card-bg': 'linear-gradient(150deg, rgba(12, 18, 40, 0.94), rgba(6, 10, 28, 0.92))',
      '--layer-card-overlay': 'radial-gradient(120% 120% at 30% 18%, rgba(210, 198, 134, .35), transparent 70%)',
      '--promo-texture': 'radial-gradient(circle at 60% 18%, rgba(255, 214, 144, .25), transparent 65%)'
    }
  },
  {
    slug: 'halloween',
    label: 'Halloween',
    priority: 70,
    getRanges: ({ year }) => [
      { start: getDateValue(year, 10, 27), end: getDateValue(year, 11, 1) }
    ],
    vars: {
      '--brand-h': '290',
      '--brand-s': '80%',
      '--brand-l': '52%',
      '--bg': '#0d0616',
      '--surface': '#150b26',
      '--surface-2': '#1d1033',
      '--text': '#f5edff',
      '--muted': '#d0b6ff',
      '--border': '#2f1b4c',
      '--focus-ring': 'hsl(290 88% 68%)',
      '--layer-card-bg': 'linear-gradient(150deg, rgba(28, 10, 42, 0.94), rgba(12, 4, 26, 0.94))',
      '--layer-card-overlay': 'radial-gradient(120% 120% at 26% 18%, rgba(255, 132, 30, .4), transparent 70%)',
      '--promo-texture': 'radial-gradient(circle at 82% 24%, rgba(255, 136, 34, .28), transparent 65%)'
    },
    setup: ({ layer }) => {
      const AudioCtx = window.AudioContext || window.webkitAudioContext;
      const reduce = matchMedia('(prefers-reduced-motion: reduce)').matches;
      const createdElements = [];
      let audioCtx = null;

      if (layer) {
        const frag = document.createDocumentFragment();

        const spawnBat = () => {
          const bat = document.createElement('span');
          bat.className = 'seasonal-particle halloween-bat';
          bat.style.top = `${8 + Math.random() * 52}%`;
          bat.style.left = `${Math.random() * 80}%`;
          bat.style.setProperty('--h-start-x', `${-80 - Math.random() * 80}px`);
          bat.style.setProperty('--h-start-y', `${Math.random() * 24 - 12}px`);
          bat.style.setProperty('--h-mid-x', `${Math.random() * 120 - 20}px`);
          bat.style.setProperty('--h-mid-y', `${-20 - Math.random() * 40}px`);
          bat.style.setProperty('--h-end-x', `${140 + Math.random() * 120}px`);
          bat.style.setProperty('--h-end-y', `${-20 - Math.random() * 60}px`);
          bat.style.setProperty('--h-duration', `${20 + Math.random() * 10}s`);
          bat.style.setProperty('--h-delay', `${Math.random() * -18}s`);
          frag.appendChild(bat);
          createdElements.push(bat);
        };

        const spawnLantern = (leftPercent) => {
          const lantern = document.createElement('span');
          lantern.className = 'seasonal-particle halloween-lantern';
          lantern.style.left = `${leftPercent}%`;
          lantern.style.setProperty('--lantern-duration', `${6 + Math.random() * 3}s`);
          lantern.style.setProperty('--lantern-glow-duration', `${4 + Math.random() * 2}s`);
          lantern.style.setProperty('--lantern-delay', `${Math.random() * -5}s`);
          frag.appendChild(lantern);
          createdElements.push(lantern);
        };

        for (let i = 0; i < 6; i += 1) {
          spawnBat();
        }

        spawnLantern(12);
        spawnLantern(46);
        spawnLantern(78);

        layer.appendChild(frag);
      }

      const ensureContext = () => {
        if (!AudioCtx) return null;
        if (!audioCtx) audioCtx = new AudioCtx();
        if (audioCtx?.state === 'suspended') {
          audioCtx.resume().catch(() => {});
        }
        return audioCtx;
      };

      const playHoverSound = () => {
        const ctx = ensureContext();
        if (!ctx) return;
        const osc = ctx.createOscillator();
        const gain = ctx.createGain();
        osc.type = 'triangle';
        osc.frequency.value = 520 + Math.random() * 140;
        gain.gain.setValueAtTime(0.0001, ctx.currentTime);
        gain.gain.exponentialRampToValueAtTime(0.05, ctx.currentTime + 0.04);
        gain.gain.exponentialRampToValueAtTime(0.0001, ctx.currentTime + 0.28);
        osc.connect(gain).connect(ctx.destination);
        osc.start();
        osc.stop(ctx.currentTime + 0.32);
      };

      const targets = Array.from(document.querySelectorAll('.card, .btn, .icon-btn'));
      const handler = () => {
        if (reduce) return;
        try {
          playHoverSound();
        } catch (err) {
          /* ignore */
        }
      };

      targets.forEach((el) => el.addEventListener('mouseenter', handler));
      return () => {
        targets.forEach((el) => el.removeEventListener('mouseenter', handler));
        if (layer) {
          createdElements.forEach((el) => el.remove());
        }
        if (audioCtx) {
          try { audioCtx.close(); } catch (err) { /* ignore */ }
          audioCtx = null;
        }
      };
    }
  },
  {
    slug: 'labour-weekend',
    label: 'Labour Weekend',
    priority: 80,
    getRanges: ({ year }) => {
      const monday = getLastWeekdayOfMonth(year, 9, 1);
      if (!monday) return [];
      const mondayValue = getDateValue(monday.year, monday.month, monday.day);
      return [
        { start: mondayValue - 3 * MS_IN_DAY, end: mondayValue }
      ];
    },
    vars: {
      '--brand-h': '182',
      '--brand-s': '88%',
      '--brand-l': '60%',
      '--bg': '#082026',
      '--surface': '#10303a',
      '--surface-2': '#17404b',
      '--text': '#f4fbfd',
      '--muted': '#b8e8f0',
      '--border': '#22525d',
      '--focus-ring': 'hsl(182 78% 62%)',
      '--layer-card-bg': 'linear-gradient(150deg, rgba(20, 52, 60, 0.9), rgba(10, 32, 38, 0.92))',
      '--layer-card-overlay': 'radial-gradient(120% 120% at 28% 16%, rgba(255, 186, 150, .34), transparent 70%)',
      '--promo-texture': 'radial-gradient(circle at 18% 78%, rgba(140, 226, 232, .24), transparent 68%)'
    }
  },
  {
    slug: 'christmas',
    label: 'Christmas Period',
    priority: 100,
    getRanges: ({ year }) => [
      { start: getDateValue(year, 12, 10), end: getDateValue(year, 12, 26) }
    ],
    vars: {
      '--brand-h': '350',
      '--brand-s': '82%',
      '--brand-l': '58%',
      '--bg': '#06141b',
      '--surface': '#10242c',
      '--surface-2': '#18323c',
      '--text': '#f8fbff',
      '--muted': '#c7dae6',
      '--border': '#20414a',
      '--focus-ring': 'hsl(350 88% 62%)',
      '--layer-card-bg': 'linear-gradient(150deg, rgba(22, 46, 54, 0.94), rgba(10, 24, 30, 0.9))',
      '--layer-card-overlay': 'radial-gradient(120% 120% at 26% 18%, rgba(255, 184, 148, .42), transparent 70%)',
      '--promo-texture': 'radial-gradient(circle at 72% 18%, rgba(255, 214, 150, .3), transparent 66%)'
    }
  },
  {
    slug: 'boxing-bridge',
    label: 'Boxing Day → New Year Bridge',
    priority: 110,
    getRanges: ({ year }) => [
      { start: getDateValue(year - 1, 12, 26), end: getDateValue(year, 1, 1) },
      { start: getDateValue(year, 12, 26), end: getDateValue(year + 1, 1, 1) }
    ],
    vars: {
      '--brand-h': '315',
      '--brand-s': '78%',
      '--brand-l': '58%',
      '--bg': '#081022',
      '--surface': '#111b30',
      '--surface-2': '#18253c',
      '--text': '#f7faff',
      '--muted': '#c0cbe6',
      '--border': '#23324a',
      '--focus-ring': 'hsl(315 78% 64%)',
      '--layer-card-bg': 'linear-gradient(150deg, rgba(20, 32, 52, 0.94), rgba(10, 18, 36, 0.92))',
      '--layer-card-overlay': 'radial-gradient(120% 120% at 28% 16%, rgba(255, 176, 156, .38), transparent 68%)',
      '--promo-texture': 'radial-gradient(circle at 24% 22%, rgba(120, 210, 255, .24), transparent 68%)'
    }
  }
];

const applySeasonalTheme = (() => {
  const root = document.documentElement;
  const body = document.body;
  const layer = document.getElementById('seasonalLayer');
  const countdownEl = document.getElementById('seasonalCountdown');
  const taglineEl = document.getElementById('seasonalTagline');

  let appliedVars = [];
  let appliedClasses = [];
  let cleanup = null;

  return (themeState) => {
    if (cleanup) {
      try { cleanup(); } catch (err) { console.warn('Unable to dispose seasonal theme', err); }
      cleanup = null;
    }

    appliedClasses.forEach((cls) => body.classList.remove(cls));
    appliedClasses = [];

    appliedVars.forEach((prop) => root.style.removeProperty(prop));
    appliedVars = [];

    if (layer) {
      layer.innerHTML = '';
      delete layer.dataset.theme;
    }

    body.removeAttribute('data-seasonal-theme');

    if (countdownEl) {
      countdownEl.hidden = true;
      countdownEl.textContent = '';
    }

    if (taglineEl) {
      taglineEl.hidden = true;
      taglineEl.textContent = '';
    }

    if (!themeState) return;

    body.dataset.seasonalTheme = themeState.slug;
    if (layer) layer.dataset.theme = themeState.slug;

    if (Array.isArray(themeState.classes)) {
      for (const cls of themeState.classes) {
        if (!cls) continue;
        body.classList.add(cls);
        appliedClasses.push(cls);
      }
    }

    if (themeState.vars && typeof themeState.vars === 'object') {
      for (const [prop, value] of Object.entries(themeState.vars)) {
        if (value == null) continue;
        root.style.setProperty(prop, value);
        appliedVars.push(prop);
      }
    }

    if (themeState.tagline && taglineEl) {
      taglineEl.textContent = themeState.tagline;
      taglineEl.hidden = false;
    }

    if (typeof themeState.setup === 'function') {
      try {
        const result = themeState.setup({
          layer,
          countdownEl,
          taglineEl,
          tz: STATION_TZ,
          theme: themeState,
          makeZonedDate,
          getLocalDateParts
        });
        if (typeof result === 'function') {
          cleanup = result;
        } else if (result && typeof result.destroy === 'function') {
          cleanup = () => result.destroy();
        }
      } catch (err) {
        console.warn('Unable to initialise seasonal theme', themeState.slug, err);
      }
    }
  };
})();

const resolveSeasonalTheme = (date, tz) => {
  const value = getLocalDateValue(date, tz);
  const parts = getLocalDateParts(date, tz);
  let active = null;

  for (const theme of SEASONAL_THEMES) {
    let ranges = [];
    try {
      ranges = typeof theme.getRanges === 'function'
        ? theme.getRanges({ date, tz, year: parts.year, parts })
        : [];
    } catch (err) {
      console.warn('Unable to evaluate seasonal theme range', theme.slug, err);
      continue;
    }

    if (!Array.isArray(ranges)) continue;
    for (const range of ranges) {
      if (!range) continue;
      const start = range.start;
      const end = range.end;
      if (!Number.isFinite(start) || !Number.isFinite(end)) continue;
      if (value >= start && value <= end) {
        if (!active || (theme.priority ?? 0) > (active.priority ?? 0)) {
          active = {
            ...theme,
            range: { start, end },
            data: range.data || {},
            year: parts.year
          };
        }
      }
    }
  }

  return active;
};

const seasonalThemeController = (() => {
  let active = null;
  let midnightTimer = null;

  const scheduleNext = (reference = new Date()) => {
    if (midnightTimer) clearTimeout(midnightTimer);
    const delay = msUntilNextMidnight(reference, STATION_TZ) + 2000;
    midnightTimer = setTimeout(() => {
      evaluate();
    }, Math.max(60 * 1000, delay));
  };

  const evaluate = () => {
    const now = new Date();
    const next = resolveSeasonalTheme(now, STATION_TZ);
    const nextSlug = next?.slug || '';
    const currentSlug = active?.slug || '';

    if (nextSlug !== currentSlug) {
      applySeasonalTheme(next || null);
      active = next || null;
    } else if (!nextSlug && currentSlug) {
      applySeasonalTheme(null);
      active = null;
    }

    scheduleNext(now);
  };

  return {
    start() {
      evaluate();
      document.addEventListener('visibilitychange', () => {
        if (document.visibilityState === 'visible') {
          evaluate();
        }
      });
    },
    reapplyActiveTheme() {
      if (active) {
        applySeasonalTheme(active);
      }
    },
    getActiveTheme() {
      return active;
    }
  };
})();

const SHOW_LOADING_FALLBACK = 'Live: Amped AI (fetching details…)';
const SHOW_TIME_LOADING_FALLBACK = 'Fetching schedule…';

const primeShowFallbackHeadings = () => {
  try {
    document.querySelectorAll('[data-fallback="show-loading"]').forEach((el) => {
      el.textContent = SHOW_LOADING_FALLBACK;
    });
    document.querySelectorAll('[data-fallback="show-time"]').forEach((el) => {
      el.textContent = SHOW_TIME_LOADING_FALLBACK;
    });
  } catch (err) {
    console.warn('Unable to prime show fallback headings', err);
  }
};

primeShowFallbackHeadings();

// Visible shows on the homepage grid
const SHOWS = [
  { title: "Amped Mornings with Miki",      time: "Weekdays 5–9 AM",   image: "AMWM.png", imageText: "MIKI", desc: "Wake-ups, headlines, and feel-good anthems." },
  { title: "The Amped Drive Home with Jax", time: "Weekdays 3–7 PM",   image: "ADHJ.png", imageText: "JAX",  desc: "Commutes with momentum — throwbacks + new drops." },
  { title: "Midnight Flow with Sam Carter", time: "Nightly 11 PM–2 AM", image: "MFSC.png", imageText: "SAM", desc: "Late-night downtempo and calm talk." }
];

const HOST_THEMES = {
  autodj: {
    label: 'AutoDJ',
    aliases: ['auto', 'automation', 'radio-bot', 'amp'],
    darkVars: {
      '--brand-h': '330',
      '--brand-s': '100%',
      '--brand-l': '60%',
      '--bg': '#08090d',
      '--surface': '#11141c',
      '--surface-2': '#181d28',
      '--text': '#f7f9fe',
      '--muted': '#aab4c8',
      '--border': '#323c50',
      '--focus-ring': 'hsl(var(--brand-h) 92% 68%)'
    },
    lightVars: {
      '--brand-h': '330',
      '--brand-s': '92%',
      '--brand-l': '58%',
      '--bg': '#fff7fb',
      '--surface': '#ffeef9',
      '--surface-2': '#f7deed',
      '--text': '#160713',
      '--muted': '#6f3f5c',
      '--border': '#e4bcd8',
      '--focus-ring': 'hsl(var(--brand-h) 88% 44%)'
    },
    accentSvg: 'data:image/svg+xml;utf8,<svg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%20280%20220%22><defs><linearGradient%20id=%22g%22%20x1=%220%%22%20y1=%220%%22%20x2=%22100%%22%20y2=%22100%%22><stop%20offset=%220%%22%20stop-color=%22%23ff4db8%22/><stop%20offset=%22100%%22%20stop-color=%22%23ff8a1f%22/></linearGradient></defs><path%20fill=%22url(%23g)%22%20d=%22M30%200h190l60%20120-80%20100H40L0%20120z%22/></svg>',
    texture: 'radial-gradient(circle at 18% 18%, rgba(255, 77, 184, 0.22), transparent 62%)'
  },
  miki: {
    label: 'Miki',
    aliases: ['miki-rivers', 'miki-show', 'amped-mornings-with-miki'],
    darkVars: {
      '--brand-h': '195',
      '--brand-s': '100%',
      '--brand-l': '58%',
      '--bg': '#04121d',
      '--surface': '#0c1f2e',
      '--surface-2': '#122c3d',
      '--text': '#f4fbff',
      '--muted': '#9ec4dc',
      '--border': '#174158',
      '--focus-ring': 'hsl(var(--brand-h) 92% 66%)'
    },
    lightVars: {
      '--brand-h': '195',
      '--brand-s': '96%',
      '--brand-l': '52%',
      '--bg': '#f1f9ff',
      '--surface': '#e6f3ff',
      '--surface-2': '#d6e9fa',
      '--text': '#031a26',
      '--muted': '#3f6f8d',
      '--border': '#b5daef',
      '--focus-ring': 'hsl(var(--brand-h) 88% 46%)'
    },
    accentSvg: 'data:image/svg+xml;utf8,<svg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%20260%20200%22><defs><linearGradient%20id=%22g%22%20x1=%2220%%22%20y1=%220%%22%20x2=%22100%%22%20y2=%2280%%22><stop%20offset=%220%%22%20stop-color=%22%2325d6ff%22/><stop%20offset=%22100%%22%20stop-color=%22%238c4dff%22/></linearGradient></defs><path%20fill=%22url(%23g)%22%20d=%22M0%2040%20120%200l140%2080-80%20120H40z%22/><circle%20cx=%2270%22%20cy=%22110%22%20r=%2226%22%20fill=%22rgba(255,255,255,0.45)%22/><circle%20cx=%22170%22%20cy=%2270%22%20r=%2218%22%20fill=%22rgba(255,255,255,0.36)%22/></svg>',
    texture: 'radial-gradient(circle at 75% 20%, rgba(37, 214, 255, 0.18), transparent 58%)'
  },
  jax: {
    label: 'Jax',
    aliases: ['jax-drive', 'jax-miki', 'the-amped-drive-home-with-jax', 'amped-ai-with-jax-miki'],
    darkVars: {
      '--brand-h': '25',
      '--brand-s': '100%',
      '--brand-l': '64%',
      '--bg': '#14070c',
      '--surface': '#1d0d14',
      '--surface-2': '#28131d',
      '--text': '#fff7fa',
      '--muted': '#d6aeb8',
      '--border': '#3f1d27',
      '--focus-ring': 'hsl(var(--brand-h) 90% 66%)'
    },
    lightVars: {
      '--brand-h': '25',
      '--brand-s': '98%',
      '--brand-l': '58%',
      '--bg': '#fff6f2',
      '--surface': '#ffebe3',
      '--surface-2': '#ffdcd0',
      '--text': '#30100b',
      '--muted': '#935b4c',
      '--border': '#f3c3b0',
      '--focus-ring': 'hsl(var(--brand-h) 84% 46%)'
    },
    accentSvg: 'data:image/svg+xml;utf8,<svg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%20260%20200%22><defs><linearGradient%20id=%22g%22%20x1=%220%%22%20y1=%220%%22%20x2=%22100%%22%20y2=%22100%%22><stop%20offset=%220%%22%20stop-color=%22%23ffd166%22/><stop%20offset=%22100%%22%20stop-color=%22%23ff006e%22/></linearGradient></defs><path%20fill=%22url(%23g)%22%20d=%22M30%2020h170l60%2090-120%2090L0%20140z%22/><path%20fill=%22rgba(255,255,255,0.35)%22%20d=%22m80%2040%20120%2040-50%2080-130-40z%22/></svg>',
    texture: 'radial-gradient(circle at 82% 22%, rgba(255, 0, 110, 0.18), transparent 60%)'
  },
  sam: {
    label: 'Sam',
    aliases: ['sam-carter', 'midnight-flow', 'midnight-flow-with-sam-carter'],
    darkVars: {
      '--brand-h': '250',
      '--brand-s': '88%',
      '--brand-l': '60%',
      '--bg': '#050615',
      '--surface': '#0b0f22',
      '--surface-2': '#141a34',
      '--text': '#f1f4ff',
      '--muted': '#a3abd4',
      '--border': '#1b2040',
      '--focus-ring': 'hsl(var(--brand-h) 86% 66%)'
    },
    lightVars: {
      '--brand-h': '250',
      '--brand-s': '82%',
      '--brand-l': '58%',
      '--bg': '#f4f6ff',
      '--surface': '#e8ecff',
      '--surface-2': '#dde2ff',
      '--text': '#141a3f',
      '--muted': '#4d5b96',
      '--border': '#c5ccf2',
      '--focus-ring': 'hsl(var(--brand-h) 78% 46%)'
    },
    accentSvg: 'data:image/svg+xml;utf8,<svg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%20260%20200%22><defs><linearGradient%20id=%22g%22%20x1=%2220%%22%20y1=%220%%22%20x2=%22100%%22%20y2=%22100%%22><stop%20offset=%220%%22%20stop-color=%22%233a86ff%22/><stop%20offset=%22100%%22%20stop-color=%22%238338ec%22/></linearGradient></defs><path%20fill=%22url(%23g)%22%20d=%22M0%2060%20140%200l120%20120-100%2080H40z%22/><path%20fill=%22rgba(255,255,255,0.4)%22%20d=%22M40%20120c40-30%2090-40%20140-10l-20%2060-120%2020z%22/></svg>',
    texture: 'radial-gradient(circle at 20% 30%, rgba(58, 134, 255, 0.18), transparent 55%)'
  },
  live: {
    label: 'Live',
    aliases: ['live', 'special-guest', 'guest'],
    darkVars: {
      '--brand-h': '335',
      '--brand-s': '100%',
      '--brand-l': '58%',
      '--bg': '#15040e',
      '--surface': '#220615',
      '--surface-2': '#2f081c',
      '--text': '#fff0f6',
      '--muted': '#f39abb',
      '--border': '#451029',
      '--focus-ring': 'hsl(var(--brand-h) 94% 66%)'
    },
    lightVars: {
      '--brand-h': '335',
      '--brand-s': '96%',
      '--brand-l': '56%',
      '--bg': '#fff3f8',
      '--surface': '#ffe4ef',
      '--surface-2': '#ffd5e5',
      '--text': '#360f1f',
      '--muted': '#9c3f63',
      '--border': '#f3b4cc',
      '--focus-ring': 'hsl(var(--brand-h) 88% 44%)'
    },
    accentSvg: 'data:image/svg+xml;utf8,<svg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%20260%20200%22><defs><radialGradient%20id=%22g%22%20cx=%2250%%22%20cy=%2240%%22%20r=%2275%%22><stop%20offset=%220%%22%20stop-color=%22%23ff006e%22/><stop%20offset=%22100%%22%20stop-color=%22%23f72585%22/></radialGradient></defs><path%20fill=%22url(%23g)%22%20d=%22M20%200h200l40%20120-120%2080L0%20140z%22/><circle%20cx=%2290%22%20cy=%2280%22%20r=%2224%22%20fill=%22rgba(255,255,255,0.35)%22/></svg>',
    texture: 'radial-gradient(circle at 12% 25%, rgba(247, 37, 133, 0.22), transparent 60%)'
  }
};

const HOST_THEME_STORAGE_KEY = 'amped-active-host';
const DEFAULT_HOST_SLUG = 'autodj';
let lastScheduleSlug = DEFAULT_HOST_SLUG;

const UP_NEXT_LIMIT = 4;
const MINUTE_MS = 60 * 1000;
const DAY_MS = 24 * 60 * MINUTE_MS;

const WEEKDAY_SHELL_SLOTS = [
  { title: 'Amped Mornings with Miki',      startMinutes:  5 * 60,      endMinutes:  9 * 60 },
  { title: 'Amped AI with Jax & Miki',      startMinutes:  9 * 60,      endMinutes: 16 * 60 + 45 },
  { title: 'The Amped Drive Home with Jax', startMinutes: 16 * 60 + 45, endMinutes: 22 * 60 },
  { title: 'Midnight Flow with Sam Carter', startMinutes: 22 * 60,      endMinutes: 29 * 60 }
];

/* ------------------------------ HELPERS -------------------------------- */
const $  = (sel, root = document) => root.querySelector(sel);
const $$ = (sel, root = document) => [...root.querySelectorAll(sel)];
const setText = (el, txt) => { if (el) el.textContent = txt; };
const show   = (el, display = "") => { if (el) el.style.display = display; };
const hide   = el => { if (el) el.style.display = "none"; };
const debounce = (fn, wait = 120) => {
  let timer;
  return (...args) => {
    clearTimeout(timer);
    timer = setTimeout(() => fn.apply(undefined, args), wait);
  };
};

/* --------------------------- HOST TAKEOVERS --------------------------- */
const slugifyHost = (value = '') => {
  return String(value)
    .toLowerCase()
    .replace(/[^a-z0-9]+/g, '-')
    .replace(/^-+|-+$/g, '')
    || DEFAULT_HOST_SLUG;
};

const resolveHostThemeSlug = (hostName, { asSlug = false } = {}) => {
  if (!hostName) return DEFAULT_HOST_SLUG;
  if (asSlug) return HOST_THEMES[hostName] ? hostName : DEFAULT_HOST_SLUG;

  const slug = slugifyHost(hostName);
  if (HOST_THEMES[slug]) return slug;

  for (const [key, theme] of Object.entries(HOST_THEMES)) {
    if (key === slug) return key;
    const aliases = theme.aliases || [];
    if (aliases.includes(slug)) return key;
  }

  for (const [key, theme] of Object.entries(HOST_THEMES)) {
    const aliases = theme.aliases || [];
    if (slug.includes(key)) return key;
    if (aliases.some(alias => slug.includes(alias))) return key;
  }

  for (const part of slug.split('-')) {
    if (HOST_THEMES[part]) return part;
  }

  return DEFAULT_HOST_SLUG;
};

const applyHostSkin = (() => {
  let lastSlug = '';

  const setRootVars = (theme = {}) => {
    const root = document.documentElement;
    const rootStyle = root.style;
    const mode = root.getAttribute('data-theme') === 'light' ? 'light' : 'dark';
    const variantKey = mode === 'light' ? 'lightVars' : 'darkVars';

    const defaultTheme = HOST_THEMES[DEFAULT_HOST_SLUG] || {};
    const baseVars = defaultTheme[variantKey]
      || defaultTheme.darkVars
      || defaultTheme.lightVars
      || {};
    const activeVars = theme[variantKey]
      || theme.darkVars
      || theme.lightVars
      || {};

    const merged = { ...baseVars, ...activeVars };
    for (const [prop, value] of Object.entries(merged)) {
      if (value == null) rootStyle.removeProperty(prop);
      else rootStyle.setProperty(prop, value);
    }
  };

  const setAccentAssets = (slug, { accentSvg, texture }) => {
    const accentEl = document.getElementById('hostAccent');
    const promoCard = document.querySelector('.promo-card');

    document.documentElement.dataset.hostTheme = slug;

    const textureValue = texture || HOST_THEMES[DEFAULT_HOST_SLUG]?.texture || 'none';
    document.documentElement.style.setProperty('--promo-texture', textureValue || 'none');

    if (promoCard) promoCard.setAttribute('data-host', slug);
    if (!accentEl) return;

    if (accentSvg) {
      accentEl.src = accentSvg;
      accentEl.hidden = false;
    } else {
      accentEl.hidden = true;
      accentEl.removeAttribute('src');
    }
  };

  return (hostName, opts = {}) => {
    const slug = resolveHostThemeSlug(hostName, { asSlug: opts.asSlug });
    if (!slug) return;
    if (slug === lastSlug && !opts.force) return;

    const theme = HOST_THEMES[slug] || HOST_THEMES[DEFAULT_HOST_SLUG];
    setRootVars(theme);
    setAccentAssets(slug, {
      accentSvg: theme?.accentSvg ?? HOST_THEMES[DEFAULT_HOST_SLUG]?.accentSvg,
      texture: theme?.texture ?? HOST_THEMES[DEFAULT_HOST_SLUG]?.texture
    });

    seasonalThemeController.reapplyActiveTheme();

    lastSlug = slug;

    if (!opts.skipPersist) {
      try {
        localStorage.setItem(HOST_THEME_STORAGE_KEY, slug);
      } catch (err) {
        console.warn('Unable to persist host theme', err);
      }
    }
  };
})();

const applyHostSkinDebounced = debounce((host) => applyHostSkin(host), 180);

function hydrateHostSkinFromStorage() {
  let stored;
  try {
    stored = localStorage.getItem(HOST_THEME_STORAGE_KEY);
  } catch (err) {
    console.warn('Unable to read stored host theme', err);
  }

  if (stored && HOST_THEMES[stored]) {
    applyHostSkin(stored, { asSlug: true, skipPersist: true, force: true });
    return;
  }

  applyHostSkin(DEFAULT_HOST_SLUG, { asSlug: true, skipPersist: true, force: true });
}

hydrateHostSkinFromStorage();

const toDate = (value) => {
  if (!value && value !== 0) return null;
  if (value instanceof Date) return Number.isNaN(value.getTime()) ? null : value;
  if (typeof value === 'number') {
    const ms = value > 1e12 ? value : value * 1000;
    const d = new Date(ms);
    return Number.isNaN(d.getTime()) ? null : d;
  }
  const d = new Date(value);
  return Number.isNaN(d.getTime()) ? null : d;
};

const getTimeZoneShortName = (tz) => {
  const parts = new Intl.DateTimeFormat('en-US', { timeZone: tz, timeZoneName: 'short' })
    .formatToParts(new Date());
  return parts.find(p => p.type === 'timeZoneName')?.value || tz;
};

const getOffsetPart = (date, tz) => {
  const parts = new Intl.DateTimeFormat('en-US', { timeZone: tz, timeZoneName: 'shortOffset' }).formatToParts(date);
  const value = parts.find(p => p.type === 'timeZoneName')?.value || 'GMT+00';
  const match = value.match(/GMT([+\-])(\d{1,2})(?::?(\d{2}))?/);
  return match ? `${match[1]}${match[2].padStart(2, '0')}:${(match[3] || '00').padStart(2, '0')}` : '+00:00';
};

const getOffsetInfo = (date, tz) => {
  const offset = getOffsetPart(date, tz);
  const match = offset.match(/([+\-])(\d{2}):(\d{2})/);
  const sign = (match?.[1] === '-') ? -1 : 1;
  const minutes = match ? sign * ((Number(match[2]) || 0) * 60 + (Number(match[3]) || 0)) : 0;
  return { offset, minutes };
};

const getStationStartOfDay = (tz, referenceDate = new Date()) => {
  const dayParts = new Intl.DateTimeFormat('en-GB', { timeZone: tz, year: 'numeric', month: '2-digit', day: '2-digit' })
    .formatToParts(referenceDate)
    .reduce((acc, part) => (acc[part.type] = part.value, acc), {});
  const baseUTC = Date.UTC(Number(dayParts.year), Number(dayParts.month) - 1, Number(dayParts.day));
  const midnightUTC = new Date(baseUTC);
  const offset = getOffsetInfo(midnightUTC, tz);
  const startLocal = new Date(baseUTC - offset.minutes * MINUTE_MS);
  return { startLocal, parts: dayParts, offset };
};

const formatZonedISO = (date, tz) => {
  const { offset } = getOffsetInfo(date, tz);
  const parts = new Intl.DateTimeFormat('en-GB', {
    timeZone: tz,
    year: 'numeric',
    month: '2-digit',
    day: '2-digit',
    hour: '2-digit',
    minute: '2-digit',
    second: '2-digit',
    hour12: false
  }).formatToParts(date).reduce((acc, part) => (acc[part.type] = part.value, acc), {});
  return `${parts.year}-${parts.month}-${parts.day}T${parts.hour}:${parts.minute}:${parts.second || '00'}${offset}`;
};

const updateUpNextTimeZoneLabel = (tz) => {
  const label = $('#upNextTzLabel');
  if (label) label.textContent = `Station time • ${getTimeZoneShortName(tz)}`;
};

const renderUpNextList = (items, tz) => {
  const list = $('#upNextList');
  if (!list) return false;

  updateUpNextTimeZoneLabel(tz);

  if (!Array.isArray(items) || !items.length) {
    list.innerHTML = '<li class="meta">Schedule unavailable.</li>';
    return false;
  }

  list.innerHTML = '';
  for (const item of items) {
    const li = document.createElement('li');
    li.className = 'up-next-item';

    const badge = document.createElement('span');
    badge.className = 'chip up-next-chip';
    badge.textContent = `${fmt.dayShort(item.start, tz)} ${fmt.hm(item.start, tz)}`;

    const textWrap = document.createElement('div');
    textWrap.className = 'up-next-text';

    const title = document.createElement('p');
    title.className = 'up-next-title';
    title.textContent = item.title;

    const meta = document.createElement('span');
    meta.className = 'up-next-meta';
    meta.textContent = `${fmt.hm(item.start, tz)} – ${fmt.hm(item.end, tz)}`;

    textWrap.append(title, meta);
    li.append(badge, textWrap);
    list.appendChild(li);
  }
  return true;
};

const normalizeScheduleEvent = (ev) => {
  if (!ev) return null;

  const startDate = toDate(ev?.start ?? ev?.start_at ?? ev?.start_timestamp ?? ev?.start_time ?? ev?.startDate);
  if (!startDate) return null;

  let endDate = toDate(ev?.end ?? ev?.end_at ?? ev?.end_timestamp ?? ev?.end_time ?? ev?.endDate);
  if (!endDate || endDate <= startDate) {
    const duration = Number(ev?.duration ?? ev?.length ?? ev?.length_seconds ?? ev?.playout_duration ?? ev?.duration_seconds ?? ev?.minutes ?? 0);
    const fallback = Number.isFinite(duration) && duration > 0 ? duration * 1000 : 60 * MINUTE_MS;
    endDate = new Date(startDate.getTime() + fallback);
  }

  return {
    title: String(ev?.title || ev?.name || 'Show'),
    start: startDate,
    end: endDate
  };
};

const getUpcomingEventsFromSchedule = (events, tz, limit = UP_NEXT_LIMIT) => {
  const now = Date.now();
  const upcoming = [];

  for (const ev of events || []) {
    const item = normalizeScheduleEvent(ev);
    if (!item) continue;
    if (item.start.getTime() <= now) continue;
    upcoming.push(item);
  }

  upcoming.sort((a, b) => a.start - b.start);
  return upcoming.slice(0, limit);
};

const getCurrentEventFromSchedule = (events) => {
  const now = Date.now();
  let current = null;

  for (const ev of events || []) {
    const item = normalizeScheduleEvent(ev);
    if (!item) continue;
    if (item.start.getTime() <= now && item.end.getTime() > now) {
      if (!current || item.start > current.start) {
        current = item;
      }
    }
  }

  return current;
};

const buildShellFallbackEvents = (tz, limit = UP_NEXT_LIMIT) => {
  const { startLocal } = getStationStartOfDay(tz);
  const now = Date.now();
  const events = [];

  for (let day = 0; day < 5 && events.length < limit * 2; day++) {
    for (const slot of WEEKDAY_SHELL_SLOTS) {
      const start = new Date(startLocal.getTime() + day * DAY_MS + slot.startMinutes * MINUTE_MS);
      const end = new Date(startLocal.getTime() + day * DAY_MS + slot.endMinutes * MINUTE_MS);
      if (start.getTime() > now) {
        events.push({ title: slot.title, start, end });
      }
    }
  }

  events.sort((a, b) => a.start - b.start);
  return events.slice(0, limit);
};

const getCurrentShellSlot = (tz) => {
  const { startLocal } = getStationStartOfDay(tz);
  const now = Date.now();
  const dayOffsets = [0, -1];

  for (const dayOffset of dayOffsets) {
    const dayStart = new Date(startLocal.getTime() + dayOffset * DAY_MS);
    for (const slot of WEEKDAY_SHELL_SLOTS) {
      const start = new Date(dayStart.getTime() + slot.startMinutes * MINUTE_MS);
      const end = new Date(dayStart.getTime() + slot.endMinutes * MINUTE_MS);
      if (start.getTime() <= now && end.getTime() > now) {
        return { title: slot.title, start, end };
      }
    }
  }

  return null;
};

const updateCurrentShowUI = (event, tz) => {
  const titleEl = $('#currentShowTitle');
  const timeEl = $('#currentShowTime');
  if (!titleEl || !timeEl) return false;

  if (!event) {
    setText(titleEl, SHOW_LOADING_FALLBACK);
    setText(timeEl, SHOW_TIME_LOADING_FALLBACK);
    return false;
  }

  setText(titleEl, event.title || SHOW_LOADING_FALLBACK);

  if (event.start && event.end) {
    setText(timeEl, `${fmt.hm(event.start, tz)} – ${fmt.hm(event.end, tz)}`);
  } else {
    setText(timeEl, SHOW_TIME_LOADING_FALLBACK);
  }

  return true;
};

const updateCurrentShowFromEvents = (events, tz) => {
  const current = getCurrentEventFromSchedule(events);
  if (current) {
    const slug = resolveHostThemeSlug(current.title);
    lastScheduleSlug = slug;
    applyHostSkin(slug, { asSlug: true, force: true });
    updateCurrentShowUI(current, tz);
    return current;
  }

  const shellSlot = getCurrentShellSlot(tz);
  if (shellSlot) {
    const slug = resolveHostThemeSlug(shellSlot.title);
    lastScheduleSlug = slug;
    applyHostSkin(slug, { asSlug: true, force: true });
  }
  updateCurrentShowUI(shellSlot, tz);
  return shellSlot;
};

const renderCarModeUpNext = (current, next, tz) => {
  const container = $('#carModeUpNext');
  const currentTitleEl = $('#carModeCurrentTitle');
  const currentTimeEl = $('#carModeCurrentTime');
  const nextTitleEl = $('#carModeNextTitle');
  const nextTimeEl = $('#carModeNextTime');
  const countdownEl = $('#carModeNextCountdown');
  if (!container) return;

  const formatRange = (event) => {
    if (!event?.start || !event?.end) return SHOW_TIME_LOADING_FALLBACK;
    return `${fmt.hm(event.start, tz)} – ${fmt.hm(event.end, tz)}`;
  };

  if (currentTitleEl) {
    setText(currentTitleEl, current?.title || SHOW_LOADING_FALLBACK);
  }
  if (currentTimeEl) {
    const range = current?.start && current?.end ? formatRange(current) : SHOW_TIME_LOADING_FALLBACK;
    setText(currentTimeEl, range);
  }

  if (nextTitleEl) {
    setText(nextTitleEl, next?.title || SHOW_LOADING_FALLBACK);
  }
  if (nextTimeEl) {
    if (next?.start && next?.end) {
      setText(nextTimeEl, `${fmt.dayShort(next.start, tz)} ${formatRange(next)}`);
    } else {
      setText(nextTimeEl, SHOW_TIME_LOADING_FALLBACK);
    }
  }

  if (!countdownEl) return;

  const formatCountdown = (ms) => {
    const totalMinutes = Math.round(ms / MINUTE_MS);
    if (totalMinutes <= 0) return '';
    const hours = Math.floor(totalMinutes / 60);
    const minutes = totalMinutes % 60;
    if (hours > 0) {
      const hourLabel = `${hours} hr${hours === 1 ? '' : 's'}`;
      const minuteLabel = minutes > 0 ? ` ${minutes} min` : '';
      return `Starts in ${hourLabel}${minuteLabel}`;
    }
    return `Starts in ${totalMinutes} min`;
  };

  if (next?.start instanceof Date) {
    const diffLabel = formatCountdown(next.start.getTime() - Date.now());
    if (diffLabel) {
      setText(countdownEl, diffLabel);
      countdownEl.removeAttribute('hidden');
    } else {
      countdownEl.setAttribute('hidden', '');
      countdownEl.textContent = '';
    }
  } else {
    countdownEl.setAttribute('hidden', '');
    countdownEl.textContent = '';
  }
};

const updateUpNextFromSchedule = (events, tz) => {
  const current = updateCurrentShowFromEvents(events, tz);

  const upcoming = getUpcomingEventsFromSchedule(events, tz);
  const next = upcoming[0] || null;
  renderCarModeUpNext(current, next, tz);
  if (!upcoming.length) return false;
  return renderUpNextList(upcoming, tz);
};

const renderUpNextFallback = (tz) => {
  const fallbackEvents = buildShellFallbackEvents(tz);
  const current = updateCurrentShowFromEvents(fallbackEvents, tz);
  const next = fallbackEvents[0] || null;
  renderCarModeUpNext(current, next, tz);
  renderUpNextList(fallbackEvents, tz);
};

/** Format helpers with target TZ */
const fmt = {
  dayShort(d, tz) { return new Intl.DateTimeFormat('en-US', { timeZone: tz, weekday: 'short' }).format(new Date(d)); },
  hm(d, tz)       { return new Intl.DateTimeFormat(undefined, { timeZone: tz, hour: '2-digit', minute: '2-digit' }).format(new Date(d)); },
  time(t)         { return isNaN(+t) ? "" : new Date(t * 1000).toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' }); },
};

/* ------------------------------ HEADER/UI ------------------------------ */
function initHeaderUI() {
  const nav = $('#site-nav');
  const menuBtn = $('.menu-toggle');

  menuBtn?.addEventListener('click', () => {
    const open = nav.classList.toggle('open');
    menuBtn.setAttribute('aria-expanded', String(open));
    menuBtn.setAttribute('aria-controls', 'site-nav');
  });

  const themeBtn  = $('#themeBtn');
  const themeIcon = $('#themeIcon');

  const setTheme = (mode) => {
    document.documentElement.setAttribute('data-theme', mode);
    localStorage.setItem('amped-theme', mode);
    themeBtn?.setAttribute('aria-pressed', mode === 'dark' ? 'true' : 'false');
    if (themeIcon) {
      themeIcon.innerHTML = mode === 'dark'
        ? '<path fill-rule="evenodd" clip-rule="evenodd" d="M12 3a1 1 0 0 1 1 1v2a1 1 0 1 1-2 0V4a1 1 0 0 1 1-1Zm7 9a7 7 0 1 1-7-7 5 5 0 0 0 0 10 7 7 0 0 1 7-3Z"/>'
        : '<path d="M17.6 15.6A7 7 0 0 1 8.4 6.4 7 7 0 1 0 17.6 15.6Z"/>';
    }

    const activeHost = document.documentElement.dataset.hostTheme || DEFAULT_HOST_SLUG;
    applyHostSkin(activeHost, { asSlug: true, force: true, skipPersist: true });
  };

  themeBtn?.addEventListener('click', () => {
    const cur = document.documentElement.getAttribute('data-theme') || 'dark';
    setTheme(cur === 'dark' ? 'light' : 'dark');
  });

  const initialTheme = localStorage.getItem('amped-theme')
    || (matchMedia('(prefers-color-scheme: light)').matches ? 'light' : 'dark');
  setTheme(initialTheme);

  setText($('#year'), new Date().getFullYear());

  // Smooth in-page scrolling + close nav on navigate
  document.addEventListener('click', (e) => {
    const a = e.target.closest('a[href^="#"]');
    if (!a) return;
    const id = a.getAttribute('href').slice(1);
    const el = document.getElementById(id);
    if (el) {
      e.preventDefault();
      const reduce = matchMedia('(prefers-reduced-motion: reduce)').matches;
      el.scrollIntoView({ behavior: reduce ? 'auto' : 'smooth', block: 'start' });
      nav?.classList.remove('open');
      menuBtn?.setAttribute('aria-expanded', 'false');
    }
  });
}

/* ---------------------------- CAR MODE -------------------------------- */
function initCarModeToggle() {
  const toggleBtn = $('#carModeToggle');
  const root = document.documentElement;
  if (!toggleBtn || !root) return;

  const heroSection = document.querySelector('.hero');
  const CAR_MODE_TRANSITION_MS = 450;
  const reduceMotion = (() => {
    try {
      return matchMedia('(prefers-reduced-motion: reduce)').matches;
    } catch (err) {
      return false;
    }
  })();
  const runAfterFrame = typeof requestAnimationFrame === 'function'
    ? (fn) => requestAnimationFrame(fn)
    : (fn) => setTimeout(fn, 16);

  const STORAGE_KEY = 'amped-car-mode';
  const textSpan = toggleBtn.querySelector('span');

  const animateHeroHeightChange = (beforeHeight, afterHeight) => {
    if (!heroSection) return;
    if (!Number.isFinite(beforeHeight) || !Number.isFinite(afterHeight)) return;
    if (Math.abs(afterHeight - beforeHeight) < 1) return;

    heroSection.style.height = `${beforeHeight}px`;
    heroSection.style.overflow = 'hidden';
    heroSection.offsetHeight;
    heroSection.style.transition = `height var(--car-mode-transition-duration) var(--car-mode-transition-ease)`;
    heroSection.style.height = `${afterHeight}px`;

    const cleanup = () => {
      heroSection.style.height = '';
      heroSection.style.transition = '';
      heroSection.style.overflow = '';
    };

    heroSection.addEventListener('transitionend', cleanup, { once: true });
    heroSection.addEventListener('transitioncancel', cleanup, { once: true });
    setTimeout(cleanup, CAR_MODE_TRANSITION_MS + 150);
  };

  const maintainTogglePosition = (beforeRect, afterRect, scrollBefore) => {
    if (!beforeRect || !afterRect) return;
    const delta = afterRect.top - beforeRect.top;
    if (Math.abs(delta) < 1) return;
    try {
      window.scrollTo({ top: scrollBefore + delta });
    } catch (err) {
      window.scrollTo(0, scrollBefore + delta);
    }
  };

  const setState = (active, { emit = true } = {}) => {
    const next = active ? 'true' : 'false';
    root.setAttribute('data-car-mode', next);
    toggleBtn.setAttribute('aria-pressed', active ? 'true' : 'false');
    const label = active ? 'Disable car mode' : 'Enable car mode';
    toggleBtn.setAttribute('aria-label', label);
    toggleBtn.setAttribute('title', label);
    if (textSpan) {
      textSpan.textContent = active ? 'Car Mode On' : 'Car Mode';
    }
    try {
      localStorage.setItem(STORAGE_KEY, next);
    } catch (err) {
      /* ignore */
    }
    if (emit) {
      document.dispatchEvent(new CustomEvent('car-mode-change', { detail: { active } }));
    }
  };

  const setStateSmooth = (active) => {
    const currentActive = root.getAttribute('data-car-mode') === 'true';
    if (currentActive === active) return;

    const heroHeightBefore = heroSection?.getBoundingClientRect?.().height ?? 0;
    const toggleRectBefore = toggleBtn.getBoundingClientRect();
    const scrollBefore = window.scrollY;

    setState(active);

    runAfterFrame(() => {
      const heroHeightAfter = heroSection?.getBoundingClientRect?.().height ?? 0;
      const toggleRectAfter = toggleBtn.getBoundingClientRect();

      if (!reduceMotion) {
        animateHeroHeightChange(heroHeightBefore, heroHeightAfter);
      }

      maintainTogglePosition(toggleRectBefore, toggleRectAfter, scrollBefore);
    });
  };

  toggleBtn.addEventListener('click', () => {
    const current = root.getAttribute('data-car-mode') === 'true';
    setStateSmooth(!current);
  });

  const stored = (() => {
    try {
      return localStorage.getItem(STORAGE_KEY) === 'true';
    } catch (err) {
      return false;
    }
  })();

  setState(stored, { emit: false });
}

/* ------------------------------ SHOW GRID ------------------------------ */
function renderShows() {
  const grid = document.getElementById('showsGrid');
  if (!grid) return;
  grid.innerHTML = '';

  for (const show of SHOWS) {
    const card = document.createElement('article');
    card.className = 'card col-4';

    const hasImg = Boolean(show.image);
    const media = hasImg
      ? `<img src="${show.image}" alt="${show.title} artwork" loading="lazy" />`
      : `<div class="placeholder">${(show.imageText || show.title.slice(0, 3)).toUpperCase()}</div>`;

    card.innerHTML = `
      <div class="media">${media}</div>
      <div class="body">
        <h3>${show.title}</h3>
        <div class="meta">${show.time}</div>
        <p>${show.desc || ''}</p>
      </div>
    `;
    grid.appendChild(card);
  }
}

/* ------------------------------ SCHEDULE ------------------------------- */
const getScheduleTimeCaptionText = (tz) => {
  const shortName = getTimeZoneShortName(tz);
  const label = shortName && shortName !== tz ? `${shortName} (${tz})` : shortName || tz;
  return `All times in ${label}`;
};

const getScheduleTimeCaptionHtml = (tz) => `<caption class="meta">${getScheduleTimeCaptionText(tz)}</caption>`;

function renderScheduleShell() {
  const weekdayPanel = document.getElementById('weekdayPanel');
  const weekendPanel = document.getElementById('weekendPanel');
  const weekdayTab   = $('#weekdayTab');
  const weekendTab   = $('#weekendTab');
  const tz = STATION_TZ;
  const captionHtml = getScheduleTimeCaptionHtml(tz);
  const captionText = getScheduleTimeCaptionText(tz);

  if (weekdayPanel) {
    weekdayPanel.innerHTML = `
      <table>
        ${captionHtml}
        <thead><tr><th>Day</th><th style="width:180px">Time</th><th>Program</th></tr></thead>
        <tbody>
          <tr><td>Mon–Fri</td><td>05:00–09:00</td><td>Amped Mornings with Miki</td></tr>
          <tr><td>Mon–Fri</td><td>09:00–16:45</td><td>Amped AI with Jax & Miki</td></tr>
          <tr><td>Mon–Fri</td><td>16:45–22:00</td><td>The Amped Drive Home with Jax</td></tr>
          <tr><td>Mon–Fri</td><td>22:00–05:00</td><td>Midnight Flow with Sam Carter</td></tr>
        </tbody>
      </table>`;
  }
  if (weekendPanel) weekendPanel.innerHTML = `<div class="meta">Weekend view loads from API.</div><p class="meta">${captionText}</p>`;

  function setTab(isWeekend) {
    weekdayTab?.setAttribute('aria-selected', String(!isWeekend));
    weekendTab?.setAttribute('aria-selected', String(isWeekend));
    if (weekdayPanel) weekdayPanel.hidden = isWeekend;
    if (weekendPanel) weekendPanel.hidden = !isWeekend;
  }
  weekdayTab?.addEventListener('click', () => setTab(false));
  weekendTab?.addEventListener('click', () => setTab(true));
  setTab(false);
}

async function tryPopulateScheduleFromScheduleAPI() {
  const tz = STATION_TZ;
  const daysOrder = ['Sun','Mon','Tue','Wed','Thu','Fri','Sat'];

  const { startLocal } = getStationStartOfDay(tz);
  const endLocal = new Date(startLocal.getTime() + 7 * DAY_MS);

  const url = `${CONFIG.apiBase}/station/${CONFIG.stationId}/schedule`
    + `?start=${encodeURIComponent(formatZonedISO(startLocal, tz))}`
    + `&end=${encodeURIComponent(formatZonedISO(endLocal, tz))}`
    + `&timeZone=${encodeURIComponent(tz)}`;

  try {
    const res = await fetch(url);
    if (!res.ok) throw new Error(`Schedule request failed: ${res.status}`);

    const items = await res.json();
    if (!Array.isArray(items) || !items.length) {
      console.warn('schedule API returned no items');
      return [];
    }

    const buckets = new Map(); // key: "title__HH:MM–HH:MM" -> { title, time, days:Set }
    for (const ev of items) {
      const title  = ev.title || ev.name || 'Show';
      const startT = fmt.hm(ev.start, tz);
      const endT   = fmt.hm(ev.end,   tz);
      const key    = `${title}__${startT}–${endT}`;

      if (!buckets.has(key)) buckets.set(key, { title, time: `${startT}–${endT}`, days: new Set() });
      buckets.get(key).days.add(fmt.dayShort(ev.start, tz));
    }

    const compressDays = (set) => {
      const arr = daysOrder.filter(d => set.has(d));
      if (!arr.length) return '';
      const idx = arr.map(d => daysOrder.indexOf(d)).sort((a,b)=>a-b);
      const ranges = [];
      let s = idx[0], prev = idx[0];
      for (let i = 1; i < idx.length; i++) {
        if (idx[i] === prev + 1) { prev = idx[i]; continue; }
        ranges.push([s, prev]); s = prev = idx[i];
      }
      ranges.push([s, prev]);
      const toLabel = ([a,b]) => a === b ? daysOrder[a] : `${daysOrder[a]}–${daysOrder[b]}`;
      return ranges.map(toLabel).join(', ');
    };

    const rowsWeekday = [];
    const rowsWeekend = [];
    for (const b of buckets.values()) {
      const label = compressDays(b.days);
      const row = `<tr><td>${label}</td><td style="width:180px">${b.time}</td><td>${b.title}</td></tr>`;
      const hasWeekend = b.days.has('Sat') || b.days.has('Sun');
      const hasWeekday = ['Mon','Tue','Wed','Thu','Fri'].some(d => b.days.has(d));
      if (hasWeekday) rowsWeekday.push(row);
      if (hasWeekend) rowsWeekend.push(row);
    }

    const mkTable = (rows, tzString) => `
      <table>
        ${getScheduleTimeCaptionHtml(tzString)}
        <thead><tr><th>Day</th><th style="width:180px">Time</th><th>Program</th></tr></thead>
        <tbody>${rows.sort().join('')}</tbody>
      </table>`;

    if (rowsWeekday.length) $('#weekdayPanel').innerHTML = mkTable(rowsWeekday, tz);
    if (rowsWeekend.length) $('#weekendPanel').innerHTML  = mkTable(rowsWeekend, tz);
    return items;
  } catch (e) {
    console.warn('schedule fetch failed', e);
    throw e;
  }
}

/* ------------------------------ PLAYER --------------------------------- */
function initPlayer() {
  const player   = $('#player');
  const playBtn  = $('#playBtn');
  const playIcon = $('#playIcon');
  const playLabel = playBtn?.querySelector('span');
  const volumeSlider = $('#volumeControl');
  const muteBtn      = $('#muteBtn');
  const muteIcon     = $('#muteIcon');
  const muteText     = $('#muteText');
  const miniPlayerEl = $('#miniPlayer');
  const miniPlayBtn  = $('#miniPlayBtn');
  const miniPlayIcon = $('#miniPlayIcon');
  const miniPlayLabel = $('#miniPlayLabel');
  const miniVolumeSlider = $('#miniVolumeControl');
  const miniMuteBtn  = $('#miniMuteBtn');
  const miniMuteIcon = $('#miniMuteIcon');
  const miniMuteText = $('#miniMuteText');
  const upNextCard   = $('#upNextCard');
  const carModeUpNext = $('#carModeUpNext');
  const carModeHint  = $('#carModeHint');
  const carModeHintId = carModeHint?.id || null;
  const CAR_MODE_TRANSITION_MS = 450;
  let carModeUpNextTimer = null;
  let carModeUpNextFrame = null;
  const reduceMotion = (() => {
    try {
      return matchMedia('(prefers-reduced-motion: reduce)').matches;
    } catch (err) {
      return false;
    }
  })();
  const CAR_MODE_AUTOPLAY_KEY = 'amped-car-mode-autoplay';
  const isCarModeActive = () => document.documentElement.getAttribute('data-car-mode') === 'true';
  let carModeAutoPlayOptIn = (() => {
    try {
      return localStorage.getItem(CAR_MODE_AUTOPLAY_KEY) === 'true';
    } catch (err) {
      return false;
    }
  })();
  let carModeAutoPlaySuppressed = false;

  const playControls = [];
  if (playBtn && playIcon && playLabel) {
    playControls.push({ button: playBtn, iconEl: playIcon, labelEl: playLabel });
  }
  if (miniPlayBtn && miniPlayIcon && miniPlayLabel) {
    playControls.push({ button: miniPlayBtn, iconEl: miniPlayIcon, labelEl: miniPlayLabel });
  }

  const muteControls = [];
  if (muteBtn && muteIcon) {
    muteControls.push({ button: muteBtn, iconEl: muteIcon, textEl: muteText });
  }
  if (miniMuteBtn && miniMuteIcon) {
    muteControls.push({ button: miniMuteBtn, iconEl: miniMuteIcon, textEl: miniMuteText });
  }

  const volumeSliders = [volumeSlider, miniVolumeSlider].filter(Boolean);

  if (!player || !playControls.length) return;

  const ICON_PLAY   = '<path d="m8 5 12 7-12 7V5Z"/>';
  const ICON_PAUSE  = '<path d="M7 5h5v14H7V5Zm7 0h5v14h-5V5Z"/>';
  const ICON_VOLUME = '<path d="M4 9v6h4l5 5V4L8 9H4Z"/><path d="M16 12a4 4 0 0 0-2.3-3.6l.8-1.8A6 6 0 0 1 18 12a6 6 0 0 1-3.5 5.4l-.8-1.8A4 4 0 0 0 16 12Z"/>';
  const ICON_MUTED  = '<path d="M4 9v6h4l5 5V4L8 9H4Z"/><path d="m19 9-1.4-1.4-2.1 2.1-2.1-2.1-1.4 1.4 2.1 2.1-2.1 2.1 1.4 1.4 2.1-2.1 2.1 2.1 1.4-1.4-2.1-2.1L19 9Z"/>';
  const ICON_SPINNER = '<path fill="none" stroke="currentColor" stroke-linecap="round" stroke-width="2" d="M12 4a8 8 0 1 1-5.657 13.657"/>';

  const VOLUME_STORAGE_KEY = 'amped-volume';
  const MUTE_STORAGE_KEY   = 'amped-muted';
  const DEFAULT_VOLUME     = 1;
  const clamp = (val, min, max) => Math.min(max, Math.max(min, val));

  player.preload = 'none';

  let storedVolume = Number(localStorage.getItem(VOLUME_STORAGE_KEY));
  if (!Number.isFinite(storedVolume)) storedVolume = DEFAULT_VOLUME;
  storedVolume = clamp(storedVolume, 0, 1);
  player.volume = storedVolume;

  let lastNonZeroVolume = storedVolume > 0 ? storedVolume : DEFAULT_VOLUME;

  player.muted = localStorage.getItem(MUTE_STORAGE_KEY) === 'true';

  let heroInView = true;
  let miniVisible = false;
  let miniHideTimer = null;

  const updateMiniSafeArea = () => {
    if (!miniPlayerEl || !miniVisible) {
      document.body.style.removeProperty('--mini-player-safe-area');
      return;
    }

    const rect = miniPlayerEl.getBoundingClientRect();
    const padding = Math.ceil(rect.height + 24);
    document.body.style.setProperty('--mini-player-safe-area', `${padding}px`);
  };

  const setMiniVisibility = (visible) => {
    if (!miniPlayerEl) return;
    if (miniVisible === visible) return;
    miniVisible = visible;
    if (visible) {
      if (miniHideTimer) {
        clearTimeout(miniHideTimer);
        miniHideTimer = null;
      }
      miniPlayerEl.removeAttribute('hidden');
      miniPlayerEl.setAttribute('aria-hidden', 'false');
      requestAnimationFrame(() => {
        miniPlayerEl.classList.add('mini-player--visible');
        requestAnimationFrame(updateMiniSafeArea);
      });
    } else {
      miniPlayerEl.classList.remove('mini-player--visible');
      miniPlayerEl.setAttribute('aria-hidden', 'true');
      updateMiniSafeArea();
      miniHideTimer = window.setTimeout(() => {
        if (!miniVisible) miniPlayerEl.setAttribute('hidden', '');
        miniHideTimer = null;
      }, 280);
    }
  };

  const updateMiniVisibility = () => {
    if (!miniPlayerEl) return;
    const shouldShow = !heroInView && !isCarModeActive();
    setMiniVisibility(shouldShow);
  };

  if (miniPlayerEl) {
    const heroSection = document.querySelector('#listen');
    window.addEventListener('resize', () => {
      if (miniVisible) updateMiniSafeArea();
    });
    const applyHeroVisibility = (inView) => {
      heroInView = inView;
      updateMiniVisibility();
    };
    if (heroSection) {
      if ('IntersectionObserver' in window) {
        const observer = new IntersectionObserver((entries) => {
          const entry = entries[0];
          if (!entry) return;
          applyHeroVisibility(entry.isIntersecting);
        }, { threshold: 0.35 });
        observer.observe(heroSection);
      } else {
        const checkHeroInView = () => {
          const rect = heroSection.getBoundingClientRect();
          const inView = rect.bottom > 0 && rect.top < window.innerHeight;
          applyHeroVisibility(inView);
        };
        window.addEventListener('scroll', checkHeroInView, { passive: true });
        window.addEventListener('resize', checkHeroInView);
        checkHeroInView();
      }
    }
    miniPlayerEl.setAttribute('aria-hidden', 'true');
    setMiniVisibility(false);
  }

  const applyVolumeUI = () => {
    const volPercent = Math.round(player.volume * 100);
    volumeSliders.forEach((slider) => {
      slider.value = String(volPercent);
      slider.setAttribute('aria-valuenow', String(volPercent));
      const valueText = player.muted ? `Muted, ${volPercent}% volume` : `${volPercent}% volume`;
      slider.setAttribute('aria-valuetext', valueText);
      if (player.muted) {
        slider.disabled = true;
        slider.setAttribute('aria-disabled', 'true');
      } else {
        slider.disabled = false;
        slider.removeAttribute('aria-disabled');
      }
    });

    const label = player.muted ? 'Unmute audio' : 'Mute audio';
    muteControls.forEach(({ button, iconEl, textEl }) => {
      button.setAttribute('aria-pressed', player.muted ? 'true' : 'false');
      button.setAttribute('aria-label', label);
      button.setAttribute('title', label);
      if (textEl) textEl.textContent = label;
      if (iconEl) iconEl.innerHTML = player.muted ? ICON_MUTED : ICON_VOLUME;
    });
  };

  applyVolumeUI();

  const handleVolumeInput = (event) => {
    const slider = event.currentTarget;
    if (!slider) return;
    const value = clamp(Number(slider.value) / 100, 0, 1);
    if (player.muted && value > 0) {
      player.muted = false;
    }
    player.volume = value;
  };

  volumeSliders.forEach((slider) => {
    slider.addEventListener('input', handleVolumeInput);
  });

  const handleMuteToggle = () => {
    const shouldMute = !player.muted;
    if (shouldMute) {
      if (player.volume > 0) {
        lastNonZeroVolume = player.volume;
      }
      player.muted = true;
    } else {
      const restoreVolume = lastNonZeroVolume > 0 ? lastNonZeroVolume : DEFAULT_VOLUME;
      if (player.volume === 0) {
        player.volume = restoreVolume;
      }
      player.muted = false;
    }
  };

  muteControls.forEach(({ button }) => {
    button.addEventListener('click', handleMuteToggle);
  });

  player.addEventListener('volumechange', () => {
    if (player.volume > 0) {
      lastNonZeroVolume = player.volume;
    }
    try {
      localStorage.setItem(VOLUME_STORAGE_KEY, player.volume.toString());
      localStorage.setItem(MUTE_STORAGE_KEY, player.muted ? 'true' : 'false');
    } catch (err) {
      /* ignore */
    }
    applyVolumeUI();
  });

  const setLiveSrc = () => {
    player.src = `${CONFIG.streamURL}?ts=${Date.now()}`;
    player.load();
  };

  const updatePlayControls = ({ label, iconMarkup, pressed, busy }) => {
    playControls.forEach(({ button, iconEl, labelEl }) => {
      button.disabled = Boolean(busy);
      if (busy) {
        button.setAttribute('aria-busy', 'true');
        button.setAttribute('aria-disabled', 'true');
      } else {
        button.removeAttribute('aria-busy');
        button.removeAttribute('aria-disabled');
      }
      button.setAttribute('aria-pressed', pressed ? 'true' : 'false');
      button.setAttribute('title', label);
      button.setAttribute('aria-label', label);
      if (labelEl) labelEl.textContent = label;
      if (iconEl) iconEl.innerHTML = iconMarkup;
    });
  };

  const toPlayUI = () => {
    updatePlayControls({ label: 'Play Stream', iconMarkup: ICON_PLAY, pressed: false, busy: false });
  };

  const toPauseUI = () => {
    updatePlayControls({ label: 'Pause Stream', iconMarkup: ICON_PAUSE, pressed: true, busy: false });
  };

  const toConnectingUI = () => {
    updatePlayControls({ label: 'Connecting…', iconMarkup: ICON_SPINNER, pressed: false, busy: true });
  };

  toPlayUI();

  const mediaSession = ('mediaSession' in navigator) ? navigator.mediaSession : null;
  const setMediaSessionPlaybackState = (state) => {
    if (!mediaSession) return;
    try { mediaSession.playbackState = state; }
    catch (err) { /* ignore */ }
  };

  const startPlayback = async ({ showAlert = true } = {}) => {
    if (!CONFIG.streamURL) {
      if (showAlert) alert('Add your stream URL in CONFIG.streamURL first.');
      setMediaSessionPlaybackState('none');
      return false;
    }

    toConnectingUI();
    setLiveSrc();
    try {
      await player.play();
      toPauseUI();
      setMediaSessionPlaybackState('playing');
      if (isCarModeActive()) {
        carModeAutoPlayOptIn = true;
        carModeAutoPlaySuppressed = false;
        try {
          localStorage.setItem(CAR_MODE_AUTOPLAY_KEY, 'true');
        } catch (err) {
          /* ignore */
        }
      }
      return true;
    } catch (e) {
      console.warn(e);
      toPlayUI();
      setMediaSessionPlaybackState('paused');
      return false;
    }
  };

  const stopPlayback = ({ manual = false } = {}) => {
    player.pause();
    player.removeAttribute('src');
    player.load();
    toPlayUI();
    setMediaSessionPlaybackState('paused');
    if (manual && isCarModeActive()) {
      carModeAutoPlaySuppressed = true;
    }
  };

  const attemptCarModeAutoStart = (active, { requireOptIn = true } = {}) => {
    if (!active) return;
    if (!CONFIG.streamURL) return;
    if (carModeAutoPlaySuppressed) return;
    if (requireOptIn && !carModeAutoPlayOptIn) return;
    if (!player.paused && player.src) return;
    void startPlayback({ showAlert: false });
  };

  const handlePlayToggle = async () => {
    if (player.paused || !player.src) {
      await startPlayback();
    } else {
      stopPlayback({ manual: true });
    }
  };

  playControls.forEach(({ button }) => {
    button.addEventListener('click', handlePlayToggle);
  });

  if (mediaSession) {
    const safeActionHandler = (action, handler) => {
      try { mediaSession.setActionHandler(action, handler); }
      catch (err) { /* ignore unsupported */ }
    };

    const updateMediaSessionMetadata = ({ title, artist, host, artwork }) => {
      const metaInit = {
        title: title || 'Unknown Title',
        artist: artist || '',
        album: host ? `with ${host}` : '',
        artwork: artwork ? [{ src: artwork, sizes: '512x512' }] : []
      };
      try { mediaSession.metadata = new MediaMetadata(metaInit); }
      catch (err) { /* ignore */ }
    };

    window.__updateMediaSessionMetadata = updateMediaSessionMetadata;

    safeActionHandler('play', () => {
      if (player.paused || !player.src) {
        void startPlayback({ showAlert: false });
      } else {
        setMediaSessionPlaybackState('playing');
      }
    });
    safeActionHandler('pause', () => {
      if (!player.paused || player.readyState > 0) {
        stopPlayback({ manual: true });
      } else {
        setMediaSessionPlaybackState('paused');
      }
    });
    safeActionHandler('stop', () => { stopPlayback({ manual: true }); });
    safeActionHandler('seekto', () => { /* Live stream: no seeking supported */ });

    setMediaSessionPlaybackState(player.paused ? 'paused' : 'playing');
  } else {
    window.__updateMediaSessionMetadata = null;
  }

  // Debounced auto-recover to prevent repeat/stutter loops
  let waitingTimer = null;
  let recovering = false;
  let lastRecoverAt = 0;
  const RECOVER_COOLDOWN = 30000; // ms

  const scheduleRecover = (reason, delay = 1500) => {
    if (player.paused) return; // only recover if user expects playback
    const now = Date.now();
    if (recovering || (now - lastRecoverAt) < RECOVER_COOLDOWN) return;
    recovering = true;
    setTimeout(() => {
      lastRecoverAt = Date.now();
      const wasPlaying = !player.paused;
      player.src = `${CONFIG.streamURL}?ts=${Date.now()}`;
      player.load();
      if (wasPlaying) player.play().catch(()=>{});
      recovering = false;
    }, delay);
  };

  player.addEventListener('playing', () => {
    toPauseUI();
    setMediaSessionPlaybackState('playing');
  });

  player.addEventListener('error', () => {
    toPlayUI();
    setMediaSessionPlaybackState('paused');
    scheduleRecover('error', 1200);
  });

  player.addEventListener('stalled', () => scheduleRecover('stalled', 1200));

  // If we sit in "waiting" for a few seconds, try a gentle recover
  player.addEventListener('waiting', () => {
    clearTimeout(waitingTimer);
    waitingTimer = setTimeout(() => scheduleRecover('waiting', 1500), 4000);
  });
  player.addEventListener('playing', () => { clearTimeout(waitingTimer); });
  player.addEventListener('timeupdate', () => { clearTimeout(waitingTimer); });

  const setCarModeUpNextVisibility = (active) => {
    if (!carModeUpNext) return;
    carModeUpNext.setAttribute('aria-hidden', active ? 'false' : 'true');
    clearTimeout(carModeUpNextTimer);
    carModeUpNextTimer = null;
    if (carModeUpNextFrame !== null) {
      cancelAnimationFrame(carModeUpNextFrame);
      carModeUpNextFrame = null;
    }
    if (active) {
      carModeUpNext.removeAttribute('hidden');
      carModeUpNext.classList.remove('car-mode-up-next--visible');
      void carModeUpNext.offsetWidth;
      carModeUpNextFrame = requestAnimationFrame(() => {
        carModeUpNext.classList.add('car-mode-up-next--visible');
        carModeUpNextFrame = null;
      });
    } else {
      carModeUpNext.classList.remove('car-mode-up-next--visible');
      if (reduceMotion) {
        carModeUpNext.setAttribute('hidden', '');
      } else if (!carModeUpNext.hasAttribute('hidden')) {
        carModeUpNextTimer = setTimeout(() => {
          carModeUpNext.setAttribute('hidden', '');
          carModeUpNextTimer = null;
        }, CAR_MODE_TRANSITION_MS);
      }
    }
  };

  const applyCarModeAccessibility = (active, { focusControl = false } = {}) => {
    const controls = [playBtn, volumeSlider, muteBtn, miniPlayBtn, miniVolumeSlider, miniMuteBtn].filter(Boolean);
    controls.forEach(ctrl => {
      if (!ctrl) return;
      if (active && carModeHintId) {
        ctrl.setAttribute('aria-describedby', carModeHintId);
      } else if (carModeHintId && ctrl.getAttribute('aria-describedby') === carModeHintId) {
        ctrl.removeAttribute('aria-describedby');
      }
    });
    if (upNextCard) {
      upNextCard.setAttribute('aria-hidden', active ? 'true' : 'false');
    }
    setCarModeUpNextVisibility(active);
    if (focusControl && active) {
      try {
        playBtn.focus({ preventScroll: true });
      } catch (err) {
        /* ignore */
      }
    }
    updateMiniVisibility();
  };

  document.addEventListener('car-mode-change', (event) => {
    const active = Boolean(event?.detail?.active);
    applyCarModeAccessibility(active, { focusControl: true });
    if (active) {
      attemptCarModeAutoStart(active, { requireOptIn: false });
    }
  });

  const initialCarMode = document.documentElement.getAttribute('data-car-mode') === 'true';
  applyCarModeAccessibility(initialCarMode);
  if (initialCarMode && carModeAutoPlayOptIn) {
    attemptCarModeAutoStart(initialCarMode, { requireOptIn: true });
  }
  updateMiniVisibility();
}


/* ----------------------- NOW PLAYING / RECENTS ------------------------- */
function initNowPlaying() {
  const titleEl     = $('#trackTitle');
  const metaEl      = $('#trackMeta');
  const barEl       = $('#progressBar');
  const artImg      = $('#artImg');
  const artFallback = $('#artFallback');
  const recentList  = $('#recentList');
  const liveLabelEl = $('#liveLabel');
  const miniTitleEl = $('#miniTrackTitle');
  const miniMetaEl  = $('#miniTrackMeta');
  const miniLiveLabel = $('#miniLiveLabel');
  const miniLiveChip  = $('#miniLiveChip');

  const NOW_PLAYING_CACHE_KEY = 'amped-now-playing';
  const NOW_PLAYING_CACHE_TTL = 60 * 1000;

  if (!titleEl || !metaEl || !barEl) return;

  // Smooth progress (respect reduced motion)
  const reduce = matchMedia('(prefers-reduced-motion: reduce)').matches;
  if (!reduce) barEl.style.transition = 'width 0.9s linear';

  let elapsed = 0, duration = 1;

  const pushMediaSessionMetadata = (info) => {
    if (typeof window.__updateMediaSessionMetadata === 'function') {
      window.__updateMediaSessionMetadata(info);
    }
  };

  const updateProgress = () => {
    const pct = Math.min(100, Math.round((elapsed / Math.max(1, duration)) * 100));
    barEl.style.width = pct + '%';
  };

  const toHistoryEntries = (history) => {
    if (!Array.isArray(history)) return [];
    return history.slice(0, 8).map((item) => {
      const title = item?.title ?? item?.song?.title ?? 'Unknown';
      const artist = item?.artist ?? item?.song?.artist ?? '—';
      const playedAt = item?.played_at ?? item?.playedAt ?? item?.timestamp ?? null;
      return {
        title,
        artist,
        played_at: playedAt
      };
    });
  };

  const renderRecentHistory = (history) => {
    if (!recentList) return;
    const entries = toHistoryEntries(history);
    if (!entries.length) {
      recentList.innerHTML = '<li class="meta">No history yet.</li>';
      return;
    }
    recentList.innerHTML = entries.map((item) => {
      const time = fmt.time(item.played_at);
      const timeText = time ? `&nbsp;${time}` : '';
      return `<li class="recent-item"><span><strong>${item.title}</strong> — ${item.artist}</span><span class="meta">${timeText}</span></li>`;
    }).join('');
  };

  const persistNowPlayingCache = (state = {}) => {
    const entries = toHistoryEntries(state.history);
    const payload = {
      title: state.title || 'Unknown Title',
      artist: state.artist || 'Unknown Artist',
      host: state.host || '',
      hostSlug: state.hostSlug || resolveHostThemeSlug(state.host || ''),
      scheduleSlug: state.scheduleSlug || lastScheduleSlug || DEFAULT_HOST_SLUG,
      artUrl: state.artUrl || '',
      isLive: Boolean(state.isLive),
      history: entries,
      elapsed: Number.isFinite(state.elapsed) ? state.elapsed : 0,
      duration: Number.isFinite(state.duration) ? state.duration : 1,
      updatedAt: Number.isFinite(state.updatedAt) ? state.updatedAt : Date.now()
    };
    try {
      localStorage.setItem(NOW_PLAYING_CACHE_KEY, JSON.stringify(payload));
    } catch (err) {
      console.warn('Unable to persist now playing cache', err);
    }
  };

  const readNowPlayingCache = () => {
    let raw = null;
    try {
      raw = localStorage.getItem(NOW_PLAYING_CACHE_KEY);
    } catch (err) {
      console.warn('Unable to read now playing cache', err);
      return null;
    }
    if (!raw) return null;
    try {
      const parsed = JSON.parse(raw);
      if (!parsed || typeof parsed !== 'object') return null;
      if (!Number.isFinite(parsed.updatedAt)) return null;
      if ((Date.now() - parsed.updatedAt) > NOW_PLAYING_CACHE_TTL) return null;
      return parsed;
    } catch (err) {
      console.warn('Unable to parse now playing cache', err);
      return null;
    }
  };

  const renderNowPlayingState = (state = {}, { persist = false, fromCache = false } = {}) => {
    const hostName = state.host || '';
    const hostSlug = state.hostSlug || resolveHostThemeSlug(hostName);
    const scheduleSlug = state.scheduleSlug || lastScheduleSlug || DEFAULT_HOST_SLUG;
    lastScheduleSlug = scheduleSlug || DEFAULT_HOST_SLUG;

    const artUrl = state.artUrl || state.artwork || '';
    const isLive = Boolean(state.isLive);
    const isAutomation = (hostSlug || DEFAULT_HOST_SLUG) === DEFAULT_HOST_SLUG;
    const hostLabel = hostName || HOST_THEMES[hostSlug]?.label || HOST_THEMES[DEFAULT_HOST_SLUG]?.label || 'AutoDJ';

    if (!isAutomation) {
      if (fromCache) {
        applyHostSkin(hostSlug, { asSlug: true, force: true });
      } else {
        applyHostSkinDebounced(hostLabel);
      }
    } else {
      applyHostSkin(lastScheduleSlug, { asSlug: true, force: fromCache });
    }

    setText(titleEl, state.title || 'Unknown Title');

    metaEl.replaceChildren();
    const artistSpan = document.createElement('span');
    artistSpan.textContent = state.artist || 'Unknown Artist';
    metaEl.append(artistSpan);
    if (!isAutomation) {
      const sep = document.createTextNode(' • ');
      const withText = document.createTextNode(isLive ? 'live with ' : 'with ');
      const hostStrong = document.createElement('strong');
      hostStrong.textContent = hostLabel;
      metaEl.append(sep, withText, hostStrong);
    }

    if (miniTitleEl) {
      const titleText = state.title || 'Unknown Title';
      miniTitleEl.textContent = titleText;
      miniTitleEl.setAttribute('title', titleText);
    }
    if (miniMetaEl) {
      const metaText = metaEl.textContent || '';
      miniMetaEl.textContent = metaText;
      miniMetaEl.setAttribute('title', metaText);
    }

    const liveChip = liveLabelEl?.closest('.chip');
    const showLiveChip = isLive && !isAutomation;
    if (liveChip) liveChip.hidden = !showLiveChip;
    setText(liveLabelEl, showLiveChip ? CONFIG.liveLabel : '');
    if (miniLiveChip) miniLiveChip.hidden = !showLiveChip;
    if (miniLiveLabel) setText(miniLiveLabel, showLiveChip ? CONFIG.liveLabel : '');

    if (artUrl) {
      artImg.src = artUrl;
      show(artImg, 'block');
      hide(artFallback);
    } else {
      artImg.removeAttribute('src');
      hide(artImg);
      show(artFallback);
    }

    pushMediaSessionMetadata({
      title: state.title || 'Unknown Title',
      artist: state.artist || 'Unknown Artist',
      host: hostLabel,
      artwork: artUrl
    });

    const entries = toHistoryEntries(state.history);
    renderRecentHistory(entries);

    elapsed = Number.isFinite(state.elapsed) ? state.elapsed : 0;
    duration = Number.isFinite(state.duration) && state.duration > 0 ? state.duration : 1;
    updateProgress();

    if (persist) {
      persistNowPlayingCache({
        ...state,
        host: hostLabel,
        hostSlug,
        scheduleSlug: lastScheduleSlug,
        artUrl,
        isLive,
        history: entries,
        elapsed,
        duration,
        updatedAt: state.updatedAt
      });
    }
  };

  const hydrateNowPlayingFromCache = () => {
    const cached = readNowPlayingCache();
    if (!cached) return false;
    const hydrated = { ...cached };
    if (Number.isFinite(cached.updatedAt) && Number.isFinite(cached.elapsed)) {
      const ageSec = Math.floor((Date.now() - cached.updatedAt) / 1000);
      if (ageSec > 0) {
        const baseDuration = Number.isFinite(cached.duration) && cached.duration > 0 ? cached.duration : 1;
        const baseElapsed = Number.isFinite(cached.elapsed) ? cached.elapsed : 0;
        hydrated.duration = baseDuration;
        hydrated.elapsed = Math.min(baseDuration, baseElapsed + ageSec);
      }
    }
    renderNowPlayingState(hydrated, { persist: false, fromCache: true });
    return true;
  };

  async function fetchNowPlaying() {
    try {
      let data;
      const r1 = await fetch(`${CONFIG.apiBase}/nowplaying/${CONFIG.station}`);
      if (r1.ok) {
        data = await r1.json();
      } else {
        const r2 = await fetch(`${CONFIG.apiBase}/nowplaying`);
        const list = await r2.json();
        data = Array.isArray(list) ? list.find(s => (s.station?.shortcode || '') === CONFIG.station) : null;
      }
      if (!data) throw new Error('No station data');

      const np     = data.now_playing || {};
      const song   = np.song || {};
      const isLive = (data.live && data.live.is_live) || false;
      const host   = isLive ? (data.live.streamer_name || 'Live') : (data.playing_next?.artist || 'AutoDJ');
      const hostSlug = resolveHostThemeSlug(host);
      const artUrl = song.art || song.artwork || '';
      const history = toHistoryEntries(data.song_history);
      renderNowPlayingState({
        title: song.title || 'Unknown Title',
        artist: song.artist || 'Unknown Artist',
        host,
        hostSlug,
        artUrl,
        isLive,
        history,
        elapsed: Number(np.elapsed ?? 0),
        duration: Number(np.duration ?? 1) || 1,
        scheduleSlug: lastScheduleSlug,
        updatedAt: Date.now()
      }, { persist: true });
    } catch (err) {
      // gentle fallback
      const dummy = [
        { title: 'Signal Test', artist: 'Amped AI', host: 'AutoDJ', seconds: 180 },
        { title: 'Neon City',   artist: 'Amped AI', host: 'AutoDJ', seconds: 200 }
      ][Math.floor(Math.random() * 2)];
      const hostSlug = resolveHostThemeSlug(dummy.host);
      renderNowPlayingState({
        title: dummy.title,
        artist: dummy.artist,
        host: dummy.host,
        hostSlug,
        artUrl: '',
        isLive: false,
        history: [],
        elapsed: 0,
        duration: dummy.seconds,
        scheduleSlug: lastScheduleSlug,
        updatedAt: Date.now()
      }, { persist: true });
    }
  }

  // Timers
  setInterval(() => {
    if (duration > 0) {
      elapsed = Math.min(duration, elapsed + 1);
      updateProgress();
    }
  }, 1000);

  hydrateNowPlayingFromCache();
  setInterval(fetchNowPlaying, 15000);
  fetchNowPlaying();
}

/* ------------------------------ EASTER EGGS ------------------------------ */
function initConsoleEasterEgg() {
  if (typeof window === 'undefined' || !window.console || typeof window.console.log !== 'function') {
    return;
  }

  const secretBoothState = getSecretBoothState();
  const bannerStyle = [
    'background: linear-gradient(90deg, #ff4db8, #7b5dff)',
    'color: #08090d',
    'font-size: 16px',
    'font-weight: 700',
    'padding: 6px 12px',
    'border-radius: 8px',
    'box-shadow: 0 0 22px rgba(123, 93, 255, .45)'
  ].join('; ');

  const bodyStyle = 'color: #aab4c8; font-size: 13px; line-height: 1.5;';
  const accentStyle = 'color: #ff4db8; font-weight: 700; text-shadow: 0 0 12px rgba(255, 77, 184, .6);';

  secretBoothState.styles = { body: bodyStyle, accent: accentStyle };

  window.console.log('%cAmped AI // Maintenance Console', bannerStyle);
  window.console.log(
    '%cDiagnostics console online. This maintenance console watches the late-night backup booth.',
    bodyStyle
  );
  window.console.log(
    '%cTo test the line, run %campedWave()%c twice in a row. Each call sends a quick signal to wake the booth.',
    bodyStyle,
    accentStyle,
    bodyStyle
  );
  window.console.log(
    '%cOnce both signals land, call %centerBooth()%c and finish with one more %campedWave()%c to close the check.',
    bodyStyle,
    accentStyle,
    bodyStyle,
    accentStyle,
    bodyStyle
  );
  setSecretBoothOverlayStory('Late shift booth idle. Quick line checks keep the backup channel ready.');

  if (typeof window.ampedWave !== 'function') {
    window.ampedWave = () => {
      const state = getSecretBoothState();
      const styles = state.styles || {};
      const transmissions = [
        'Test tone acknowledged.',
        'Signal received. Levels remain steady.',
        'Status unchanged. Booth stays in standby.'
      ];

      const before = state.progress;
      registerSecretBoothStep('wave');
      const after = state.progress;

      window.console.log('%cLine check signal sent.', styles.accent || '');

      if (after === 1 && before <= 1) {
        window.console.log('%cFirst signal logged. Run ampedWave() again to verify the return path.', styles.body || '');
        setSecretBoothOverlayStory('First signal stored. Send another ampedWave() to confirm the line.');
        return 'First signal recorded — repeat ampedWave() to confirm.';
      }

      if (after === 2 && before <= 2) {
        window.console.log('%cSecond signal confirmed. enterBooth() will open the monitor feed.', styles.body || '');
        setSecretBoothOverlayStory('Line confirmed. Call enterBooth() to open the monitor feed.');
        return 'Second signal accepted — run enterBooth() next.';
      }

      if (before === 2 && after === 1) {
        window.console.log('%cThe booth expected enterBooth() before another signal. Request access, then finish the loop.', styles.body || '');
        setSecretBoothOverlayStory('Monitor request pending. Run enterBooth() before sending more signals.');
        return 'Sequence paused — call enterBooth() before continuing.';
      }

      if (after === 0 && before > 0) {
        window.console.log('%cSequence lost. Start again with ampedWave().', styles.body || '');
        setSecretBoothOverlayStory('Sequence reset. Begin again with a fresh signal check.');
        return transmissions[Math.floor(Math.random() * transmissions.length)];
      }

      return transmissions[Math.floor(Math.random() * transmissions.length)];
    };
  }

  if (typeof window.enterBooth !== 'function') {
    window.enterBooth = () => {
      const state = getSecretBoothState();
      const styles = state.styles || {};
      const before = state.progress;

      registerSecretBoothStep('enter');
      const after = state.progress;

      if (!(after > before)) {
        window.console.log('%cTwo ampedWave() calls need to land before enterBooth() will respond.', styles.body || '');
        setSecretBoothOverlayStory('Monitor request logged early. Run ampedWave() twice before trying again.');
        return 'Request deferred — send two ampedWave() calls first.';
      }

      const sequence = [
        { text: 'Maintenance override accepted.', style: styles.accent || '' },
        { text: 'Monitor bus set to low gain.', style: styles.body || '' },
        { text: 'Room tone measured — levels in range.', style: styles.body || '' },
        { text: 'Diagnostics channel standing by.', style: styles.accent || '' },
        { text: 'Awaiting final confirmation…', style: styles.body || '' }
      ];

      sequence.forEach((step, index) => {
        window.setTimeout(() => window.console.log('%c' + step.text, step.style), index * 320);
      });

      const visualDelay = sequence.length * 320 + 180;
      window.setTimeout(() => {
        const statusUpdates = [
          'Meters steady.',
          'Talkback return clean.',
          'Channel ready.'
        ];

        let index = 0;
        const timer = window.setInterval(() => {
          window.console.log('%c' + statusUpdates[index % statusUpdates.length], styles.body || '');
          index += 1;
          if (index === statusUpdates.length * 2) {
            window.clearInterval(timer);
            window.console.log('%cLink open. Send one more ampedWave() to close out the check.', styles.accent || '');
          }
        }, 420);
      }, visualDelay);

      setSecretBoothOverlayStory('Access granted. Finish with one more ampedWave() to wrap the test.');
      return 'Maintenance channel listening — complete the loop with ampedWave().';
    };
  }
}

const secretBoothSequence = ['wave', 'wave', 'enter', 'wave'];

function getSecretBoothState() {
  if (typeof window === 'undefined') {
    return {
      expected: secretBoothSequence,
      progress: 0,
      overlay: null,
      resetTimer: null,
      styles: null
    };
  }

  if (!window.__ampedSecretBoothState) {
    window.__ampedSecretBoothState = {
      expected: secretBoothSequence,
      progress: 0,
      overlay: null,
      resetTimer: null,
      styles: null
    };
  }

  return window.__ampedSecretBoothState;
}

function registerSecretBoothStep(step) {
  const state = getSecretBoothState();
  const expected = state.expected;

  if (!Array.isArray(expected) || expected.length === 0) {
    return;
  }

  if (step === expected[state.progress]) {
    state.progress += 1;
  } else if (step === expected[0]) {
    state.progress = 1;
  } else {
    state.progress = 0;
  }

  if (state.progress >= expected.length) {
    state.progress = 0;
    activateSecretBoothScene();
  }
}

function activateSecretBoothScene() {
  if (typeof window === 'undefined' || typeof document === 'undefined') {
    return;
  }

  const state = getSecretBoothState();
  const overlay = ensureSecretBoothOverlay();

  if (!overlay || !document.body) {
    return;
  }

  window.clearTimeout(state.resetTimer);
  document.body.classList.add('secret-booth-active');

  if (state.styles && window.console && typeof window.console.log === 'function') {
    window.console.log('%cBackup booth link confirmed. Running indicator sweep.', state.styles.accent);
    window.console.log('%cAmbient lighting will fade after a short cycle.', state.styles.body);
    window.console.log('%cCheck logged for the overnight report.', state.styles.body);
  }

  setSecretBoothOverlayStory('Secret Booth active. Backup booth check logged for the overnight report.');

  state.resetTimer = window.setTimeout(() => {
    document.body.classList.remove('secret-booth-active');
  }, 16000);
}

function setSecretBoothOverlayStory(text) {
  const state = getSecretBoothState();
  if (typeof document === 'undefined') {
    return;
  }

  let overlay = state.overlay && document.body && document.body.contains(state.overlay)
    ? state.overlay
    : null;

  if (!overlay) {
    overlay = ensureSecretBoothOverlay();
  }

  if (!overlay) {
    if (typeof document !== 'undefined') {
      document.addEventListener('DOMContentLoaded', () => setSecretBoothOverlayStory(text), { once: true });
    }
    return;
  }

  const storyEl = overlay.querySelector('.secret-booth-overlay__story');
  if (storyEl) {
    storyEl.textContent = text;
  }
}

function ensureSecretBoothOverlay() {
  const state = getSecretBoothState();

  if (state.overlay && document.body.contains(state.overlay)) {
    return state.overlay;
  }

  if (!document.body) {
    document.addEventListener('DOMContentLoaded', ensureSecretBoothOverlay, { once: true });
    return null;
  }

  const overlay = document.createElement('div');
  overlay.className = 'secret-booth-overlay';
  overlay.setAttribute('aria-hidden', 'true');
  overlay.innerHTML = `
    <div class="secret-booth-overlay__badge">
      <span class="secret-booth-overlay__label">maintenance link</span>
      <span class="secret-booth-overlay__status">channel live</span>
      <p class="secret-booth-overlay__story">Late shift booth idle. Calibration pings keep the mix aligned for tomorrow.</p>
    </div>
  `;

  document.body.appendChild(overlay);
  state.overlay = overlay;
  return overlay;
}

function initFooterEasterEgg() {
  const trigger = document.getElementById('footerVersionToggle');
  const note = document.getElementById('footerSecretNote');
  if (!trigger || !note) return;

  const hideNote = () => {
    if (!note.hasAttribute('hidden')) {
      note.setAttribute('hidden', '');
      note.setAttribute('aria-hidden', 'true');
      trigger.setAttribute('aria-expanded', 'false');
      document.removeEventListener('keydown', handleEscape, true);
    }
  };

  const handleEscape = (event) => {
    if (event.key === 'Escape') {
      hideNote();
      trigger.focus();
    }
  };

  const toggle = () => {
    const isHidden = note.hasAttribute('hidden');
    if (isHidden) {
      note.removeAttribute('hidden');
      note.setAttribute('aria-hidden', 'false');
      trigger.setAttribute('aria-expanded', 'true');
      document.addEventListener('keydown', handleEscape, true);
    } else {
      hideNote();
    }
  };

  trigger.addEventListener('click', (event) => {
    event.preventDefault();
    toggle();
  });

  trigger.addEventListener('keydown', (event) => {
    if (event.key === 'Enter' || event.key === ' ') {
      event.preventDefault();
      toggle();
    }
  });
}

/* ------------------------------ INIT ----------------------------------- */
function init() {
  initHeaderUI();
  seasonalThemeController.start();
  initCarModeToggle();
  renderShows();
  renderScheduleShell();
  const tz = STATION_TZ;
  updateUpNextTimeZoneLabel(tz);
  tryPopulateScheduleFromScheduleAPI()
    .then(items => {
      if (!Array.isArray(items) || !items.length || !updateUpNextFromSchedule(items, tz)) {
        renderUpNextFallback(tz);
      }
    })
    .catch(() => renderUpNextFallback(tz));
  initPlayer();
  initNowPlaying();
  initFooterEasterEgg();
}

initConsoleEasterEgg();

document.readyState !== 'loading'
  ? init()
  : document.addEventListener('DOMContentLoaded', init);
</script>


</body>
</html>
